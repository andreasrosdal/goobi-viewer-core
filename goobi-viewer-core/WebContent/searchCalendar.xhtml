<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html" 
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner"
                xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components" 
                xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
                template="/resources/themes/#{navigationHelper.theme}/template.html"> 

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPage('searchcalendar', false, true)}" />
            <f:event type="preRenderView" listener="#{navigationHelper.addStaticLinkToBreadcrumb(msg.searchCalendar,1)}" />
            <f:event type="preRenderView" listener="#{searchBean.resetSearchParameters}" />
        </f:metadata>
    </ui:define>

    <ui:define name="content">
        <f:view contentType="text/html" encoding="utf-8">
            <div id="searchTimeline" class="page-wrapp">
                <h:form id="searchCalendarForm" prependId="false">
                    <div class="search-calendar">
                        <!-- SEARCH CALENDAR TITLE -->
                        <div class="search-calendar__title">
                            <h2>
                                <h:outputText value="#{msg.searchCalendar}" />
                            </h2>
                        </div>

                        <!-- SEARCH CALENDAR INPUT -->
                        <button type="button" id="toggleSearchCalendarInput" class="search-calendar__toggle btn hidden-md hidden-lg">
                            <i class="fa fa-search" aria-hidden="true"></i>
                            <i class="fa fa-caret-down" aria-hidden="true"></i>
                        </button>
                        
                        <div class="search-calendar__input">
                            <div class="form-horizontal">
                                <div class="form-group">
                                    <label for="selectyear" class="col-sm-4 control-label">#{msg.selectYear}</label>
                                    <div class="col-sm-8">
                                        <div class="custom-control custom-control--select">
                                            <h:selectOneMenu id="selectyear" styleClass="form-control" value="#{calendarBean.selectYear}" immediate="true" onchange="submit();">
                                                <f:selectItem itemDisabled="true" itemLabel="#{msg.select}" />
                                                <f:selectItems var="year" itemLabel="#{year.name}, #{msg.currentHits}: #{year.hits}"
                                                    itemValue="#{year.name}" value="#{calendarBean.allActiveYears}" />
                                            </h:selectOneMenu>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="selectcollection" class="col-sm-4 control-label">#{msg.collection}</label>
                                    <div class="col-sm-8">
                                        <div class="custom-control custom-control--select">
                                            <h:selectOneMenu id="selectcollection" styleClass="form-control" value="#{calendarBean.collection}" onchange="submit();">
                                                <f:selectItem itemLabel="#{msg.allCollections}" itemValue="" />
                                                <f:selectItems var="item" value="#{searchBean.allCollections}" itemValue="#{item.one}"
                                                    itemLabel="#{item.two}" />
                                            </h:selectOneMenu>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SEARCH CALENDAR RESET -->
                            <div class="search-calendar__reset">
                                <h:commandLink styleClass="btn" value="#{msg.reset}" action="#{searchBean.resetSearchAction}" />
                            </div>
                        </div>


                        <!-- SEARCH CALENDAR MONTHS -->
                        <h:panelGroup rendered="#{calendarBean.currentYear.hits gt calendarBean.countOfIncompleteData}">
                            <div class="search-calendar__months">
                                <div class="row">
                                    <ui:repeat var="month" value="#{calendarBean.monthList}">
                                        <div class="col-xs-12 col-sm-6 col-md-4">
                                            <div class="search-calendar__month">
                                                <!-- MONTH TITLE -->
                                                <div class="search-calendar__month-title">
                                                    <h:outputText value="#{msg[month.name]}" />
                                                </div>
                                                
                                                <!-- MONTH DAYS -->
                                                <div class="search-calendar__month-days clearfix">
                                                    <span>#{msg.Monday}</span>
                                                    <span>#{msg.Tuesday}</span>
                                                    <span>#{msg.Wednsday}</span>
                                                    <span>#{msg.Thursday}</span>
                                                    <span>#{msg.Friday}</span>
                                                    <span>#{msg.Saturday}</span>
                                                    <span>#{msg.Sunday}</span>
                                                </div>
                                                
                                                <!-- MONTH WEEKS -->
                                                <ui:repeat var="week" value="#{month.weeksOfMonth}">
                                                    <div class="search-calendar__month-week clearfix">
                                                        <ui:repeat var="day" value="#{week.daysOfWeek}">
                                                            <h:panelGroup rendered="#{day.name != ''}">
                                                                <div
                                                                    class="search-calendar__month-day #{day.hits != 0 and day.name == calendarBean.currentDay.name and month.name == calendarBean.currentMonth.name ? 'active' : ''}">
                                                                    <h:panelGroup rendered="#{day.hits == 0}">
                                                                        <span>#{day.name}</span>
                                                                    </h:panelGroup>
                                                                    <h:commandLink value="#{day.name}" title="#{msg.currentHits}: #{day.hits}"
                                                                        rendered="#{day.hits != 0 and !(day.name == calendarBean.currentDay.name and month.name == calendarBean.currentMonth.name)}">
                                                                        <f:setPropertyActionListener target="#{calendarBean.currentMonth}" value="#{month}" />
                                                                        <f:setPropertyActionListener target="#{calendarBean.currentDay}" value="#{day}" />
                                                                    </h:commandLink>
                                                                    <h:commandLink value="#{day.name}" title="#{msg.currentHits}: #{day.hits}"
                                                                        rendered="#{day.hits != 0 and day.name == calendarBean.currentDay.name and month.name == calendarBean.currentMonth.name}">
                                                                        <f:setPropertyActionListener target="#{calendarBean.currentMonth}" value="#{month}" />
                                                                        <f:setPropertyActionListener target="#{calendarBean.currentDay}" value="#{day}" />
                                                                    </h:commandLink>
                                                                </div>
                                                            </h:panelGroup>
                                                            <h:panelGroup rendered="#{day.name == ''}">
                                                                <div class="search-calendar__month-day-empty"></div>
                                                            </h:panelGroup>
                                                        </ui:repeat>
                                                    </div>
                                                </ui:repeat>
                                            </div>
                                        </div>
                                    </ui:repeat>
                                </div>
                            </div>
                        </h:panelGroup>

                        <!-- SEARCH CALENDAR ACTION -->
                        <div class="search-calendar__action">
                            <h:panelGroup rendered="#{calendarBean.selectYear != null}">
                                <h:panelGroup rendered="#{calendarBean.countOfIncompleteData != 0}">
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <div class="search-calendar__incomplete">
                                                <h:outputText value="#{msg.incompleteData}: " />
                                                <h:commandLink title="#{msg.incompleteData}" value="#{calendarBean.countOfIncompleteData}"
                                                    action="#{calendarBean.searchForIncompleteData}" styleClass="label label-warning" />
                                            </div>
                                        </div>
                                    </div>
                                </h:panelGroup>
                                <div class="row">
                                    <div class="col-xs-8 col-sm-9">
                                        <h:outputText value="#{msg.currentSelection}: " />
                                        <h:outputText value="#{calendarBean.currentDay.name}. " rendered="#{calendarBean.currentDay != null}" />
                                        <h:outputText value="#{msg[calendarBean.currentMonth.name]} " rendered="#{calendarBean.currentMonth != null}" />
                                        <h:outputText value="#{calendarBean.selectYear} " />
                                    </div>
                                    <div class="col-xs-4 col-sm-3">
                                        <h:commandButton title="#{msg.search}" styleClass="btn pull-right" value="#{msg.search}"
                                            action="#{calendarBean.searchCalendar}" rendered="#{calendarBean.selectYear != null}">
                                            <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="3" />
                                        </h:commandButton>
                                    </div>
                                </div>
                            </h:panelGroup>
                        </div>
                    </div>
                    
                    <script type="text/javascript">
                        $( '#toggleSearchCalendarInput' ).on( 'click', function() {
                            $( this ).find( '.fa-caret-down' ).toggleClass( 'fa-caret-up' );
                            $( '.search-calendar__input' ).slideToggle( 'fast' );
                        } );
                    </script>
                </h:form>
            </div>
        </f:view>
    </ui:define>

    <ui:define name="sidebar">             
        <h:panelGroup rendered="#{browseBean.browsingMenuEnabled}">
            <widgetComponent:widget_browsing />
        </h:panelGroup>
        
        <widgetComponent:widget_bookshelves addToBookshelfDisplay="false" />        

        <h:panelGroup rendered="#{userBean.loggedIn}">
        	<widgetComponent:widget_mySearches />
        </h:panelGroup>
        
        <c:forEach var="module" items="#{configurationBean.modules}">
            <c:forEach var="contribution" items="#{module.sidebarContributions}">
                <ui:include src="/#{contribution}" />
            </c:forEach>
        </c:forEach>
        
        <widgetComponent:widget_user />
    </ui:define>

    <ui:define name="rssFeed">
        <ui:include src="/resources/includes/rssFeed.xhtml" />
    </ui:define>

    <ui:define name="breadcrumbs">
        <ui:include src="/resources/includes/breadcrumbs.xhtml" />
    </ui:define>
</ui:composition>
