<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:composite="http://xmlns.jcp.org/jsf/composite">

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{metadataBean.loadMetadata}" />
        </f:metadata>
    </ui:define>

    <composite:interface>
        <composite:attribute name="pageType" required="false" />
        <composite:attribute name="widget" type="de.intranda.digiverso.presentation.model.cms.CMSSidebarElement" required="true" />
    </composite:interface>

    <composite:implementation>
        <div id="widgetViews" class="widget">
        	<h:form id="widgetViewsForm">
                <h3>#{msg.view}</h3>
				<ul>
					<h:panelGroup rendered="#{activeDocumentBean.overviewPage != null}">
						<li class="#{navigationHelper.currentPage == 'overview' ? 'active' : ''}">
							<h:outputLink value="#{navigationHelper.overviewActiveUrl}#{activeDocumentBean.logPart}">
								<h:outputText value="#{msg.viewOverview}" />
							</h:outputLink>
						</li>
					</h:panelGroup>

					<h:panelGroup rendered="#{!activeDocumentBean.anchor and activeDocumentBean.viewManager.hasPages and !activeDocumentBean.viewManager.filesOnly and navigationHelper.imageActiveUrl != null}">
						<li class="#{navigationHelper.currentPage == 'image' ? 'active' : ''}">
							<h:outputLink value="#{navigationHelper.imageActiveUrl}#{activeDocumentBean.logPart}">
								<h:outputText value="#{msg[activeDocumentBean.viewManager.currentPage.pageLinkLabel]}" />
							</h:outputLink>
						</li>
					</h:panelGroup>

					<h:panelGroup rendered="#{!activeDocumentBean.anchor and activeDocumentBean.viewManager.hasPages and !activeDocumentBean.viewManager.filesOnly and navigationHelper.previewActiveUrl != null}">
						<li class="#{navigationHelper.currentPage == 'preview' ? 'active' : ''}">
							<h:outputLink value="#{navigationHelper.previewActiveUrl}#{activeDocumentBean.logPart}">
								<h:outputText value="#{msg.viewPreview}" />
							</h:outputLink>
						</li>
					</h:panelGroup>

					<h:panelGroup rendered="#{fn:length(activeDocumentBean.viewManager.calendarItems) > 0}">
						<li class="#{navigationHelper.currentPage == 'calendar' ? 'active' : ''}">
							<h:outputLink value="#{navigationHelper.calendarActiveUrl}#{activeDocumentBean.logPart}">
								<h:outputText value="#{msg.calendar}" />
							</h:outputLink>
						</li>
					</h:panelGroup>
					
                    <h:panelGroup rendered="#{navigationHelper.tocActiveUrl != null and !activeDocumentBean.viewManager.filesOnly and !activeDocumentBean.viewManager.activeDocument.lidoRecord}">
                        <li class="#{navigationHelper.currentPage == 'toc' ? 'active' : ''}">
                            <h:outputLink value="#{navigationHelper.tocActiveUrl}#{activeDocumentBean.logPart}">
                                <h:outputText value="#{msg.tocAnchor}" rendered="#{activeDocumentBean.anchor}" />
                                <h:outputText value="#{msg.toc}" rendered="#{!activeDocumentBean.anchor}" />
                            </h:outputLink>
                        </li>
                    </h:panelGroup>

					<h:panelGroup rendered="#{!activeDocumentBean.anchor and activeDocumentBean.viewManager.hasPages and !activeDocumentBean.viewManager.filesOnly and navigationHelper.thumbsActiveUrl != null}">
						<li class="#{navigationHelper.currentPage == 'thumbs' ? 'active' : ''}">
							<h:outputLink value="#{navigationHelper.thumbsActiveUrl}#{activeDocumentBean.thumbPart}">
								<h:outputText value="#{msg.thumbGal}" />
							</h:outputLink>
						</li>
					</h:panelGroup>

					<h:panelGroup rendered="#{!activeDocumentBean.group and navigationHelper.metadataActiveUrl != null}">
						<li class="#{navigationHelper.currentPage == 'metadata' ? 'active' : ''}">
							<h:outputLink value="#{navigationHelper.metadataActiveUrl}#{activeDocumentBean.logPart}">
								<h:outputText rendered="#{!activeDocumentBean.viewManager.activeDocument.lidoRecord}" value="#{msg.bibData}" />
								<h:outputText rendered="#{activeDocumentBean.viewManager.activeDocument.lidoRecord}" value="#{msg.metadata}" />
							</h:outputLink>
						</li>
					</h:panelGroup>

					<h:panelGroup rendered="#{!activeDocumentBean.anchor and activeDocumentBean.viewManager.activeDocument.fulltextAvailable and !activeDocumentBean.viewManager.filesOnly and navigationHelper.fulltextActiveUrl != null}">
						<li class="#{navigationHelper.currentPage == 'fulltext' ? 'active' : ''}">
							<h:outputLink value="#{navigationHelper.fulltextActiveUrl}/#{activeDocumentBean.persistentIdentifier}/#{activeDocumentBean.imageToShow}/">
								<h:outputText value="#{msg.fulltext}" />
							</h:outputLink>
						</li>
					</h:panelGroup>
					
                    <h:panelGroup rendered="#{activeDocumentBean.viewManager.activeDocument.getMetadataValue('MD_LOCATION_URL_EXTERNALFULLTEXT') != null}">
                        <li class="">
                            <h:outputLink value="#{activeDocumentBean.viewManager.activeDocument.getMetadataValue('MD_LOCATION_URL_EXTERNALFULLTEXT')}"
                                 target="_blank">
                                <h:outputText value="#{msg.fulltextExternal}" />
                            </h:outputLink>
                        </li>
                    </h:panelGroup>
                    
                    <h:panelGroup rendered="#{activeDocumentBean.viewManager.activeDocument.nerAvailable}">
                        <li class="#{navigationHelper.currentPage == 'nerfacetting' ? 'active' : ''}">
                            <h:outputLink value="#{request.contextPath}/ner/#{activeDocumentBean.persistentIdentifier}/">
                                <h:outputText value="#{msg.widgetNerFacetting}" />
                            </h:outputLink>
                        </li>
                    </h:panelGroup>

					<h:panelGroup rendered="#{!activeDocumentBean.anchor and activeDocumentBean.viewManager.linkForDFGViewer != null}">
						<li>
							<h:outputLink value="#{activeDocumentBean.viewManager.linkForDFGViewer}" target="_blank">
								#{msg.dfgViewerLink}
							</h:outputLink>
						</li>
					</h:panelGroup>

					<h:panelGroup rendered="#{activeDocumentBean.viewManager.opacUrl != null}">
						<li>
							<h:outputLink value="#{activeDocumentBean.viewManager.opacUrl}" target="_blank">
								#{msg.opacLink}
							</h:outputLink>
						</li>
					</h:panelGroup>
					
                    <h:panelGroup rendered="#{activeDocumentBean.viewManager.activeDocument.getMetadataValue('MD_LOCATION_URL_EXTERNALRESOLVER') != null}">
                        <li class="">
<!--                             <h:outputLink value="#{activeDocumentBean.viewManager.activeDocument.getMetadataValue('MD_LOCATION_URL_EXTERNALRESOLVER')}" -->
<!--                                  target="_blank"> -->
<!--                                 <h:outputText value="#{msg.externalRepository}" /> -->
<!--                             </h:outputLink> -->
                            <a href="#{activeDocumentBean.viewManager.activeDocument.getMetadataValue('MD_LOCATION_URL_EXTERNALRESOLVER')}" target="_blank">
                                #{msg.externalRepository}
                            </a>
                        </li>
                    </h:panelGroup>
					
				</ul>
	        </h:form>
		</div>
    </composite:implementation>
</ui:composition>