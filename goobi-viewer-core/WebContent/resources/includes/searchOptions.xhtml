<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:h="http://xmlns.jcp.org/jsf/html" 
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:composite="http://xmlns.jcp.org/jsf/composite"
                xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner" 
                xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components" xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"> 

    <composite:interface />

    <composite:implementation>
        <h:form id="searchForm" prependId="false">
            <h:panelGroup id="searchgroup" layout="block">
                <div id="searchgroup_controls">
                    <h:commandLink id="btnSearchStd" value="#{msg.searchRegular}" disabled="#{searchBean.activeSearchType == 0}">
                        <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="0" />
                    </h:commandLink>
                    <h:commandLink id="btnSearchAdv" value="#{msg.searchAdvanced}" disabled="#{searchBean.activeSearchType == 1}"
                        rendered="#{configurationBean.advancedSearchEnabled}">
                        <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="1" />
                    </h:commandLink>
                    <h:commandLink id="btnSearchTime" value="#{msg.searchTimeline}" disabled="#{searchBean.activeSearchType == 2}"
                        rendered="#{configurationBean.timelineSearchEnabled}">
                        <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="2" />
                    </h:commandLink>
                    <h:commandLink id="btnSearchCal" value="#{msg.searchCalendar}" disabled="#{searchBean.activeSearchType == 3}"
                        rendered="#{configurationBean.calendarSearchEnabled}">
                        <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="3" />
                    </h:commandLink>
                </div>

                <!-- search standard -->
                <h:panelGroup id="searchgroupstandard" class="search-wrapp" rendered="#{searchBean.activeSearchType == 0}" layout="block">
                    <div class="search-title">
                        <h3>
                            <h:outputText rendered="#{!searchBean.searchInDcFlag}" value="#{msg.searchGlobalDescription}" />
                            <h:panelGroup rendered="#{searchBean.searchInDcFlag}">
                                <h:outputText value="#{msg.searchInDC}: " styleClass="searchInDC" />
                                <h:outputText value="#{msg[searchBean.currentCollection]}" styleClass="searchInDC" />
                            </h:panelGroup>
                        </h3>
                    </div>
                    
                    <!-- standard search input -->
                    <div class="search-input">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="standard-search-label">#{msg.searchQuery}:</div>
                            </div>
                            <div class="col-md-9">
                                <p:autoComplete completeMethod="#{searchBean.autocomplete}" value="#{searchBean.searchString}" maxResults="50">
                                    <f:passThroughAttribute name="placeholder" value="#{msg.searchFieldDemoText}" />
                                </p:autoComplete>
                            </div>
                        </div>
                    </div>

					<h:panelGroup rendered="#{fn:length(searchBean.searchFilters) > 1}">
                    	<div class="search-filter">
							<h3>#{msg.searchIn}:</h3>
							<h:selectOneRadio value="#{searchBean.currentSearchFilterString}"
								id="search_radio_group">
								<f:ajax event="valueChange" />
								<f:selectItems value="#{searchBean.searchFilters}" var="filter"
									itemValue="#{filter.label}" itemLabel="#{msg[filter.label]}" />
							</h:selectOneRadio>
						</div>
					</h:panelGroup>

					<!-- standard search reset -->
					<div class="search-reset">
						<h:commandLink id="searchStdResetButton" styleClass="btn" value="#{msg.reset}" action="#{searchBean.resetSearchAction}" />
						<h:commandButton type="submit" action="#{searchBean.searchSimple}" styleClass="btn" value="#{msg.search}">
							<f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="0" />
						</h:commandButton>
					</div>
				</h:panelGroup>

                <!-- search advanced -->
                <h:panelGroup id="searchgroupadvanced" class="search-wrapp" rendered="#{searchBean.activeSearchType == 1}" layout="block">
                    <div class="search-title">
                        <h3>
                            <h:outputText value="#{msg.searchAdvanced_description}" />
                        </h3>
                    </div>

                    <div class="search-input">
                        <h:panelGrid columns="3">
                            <c:forEach var="queryItem" items="#{searchBean.advancedQueryItems}" varStatus="status">
                                <h:column>
                                    <h:selectOneMenu id="advsearch_field_#{status.count}" value="#{queryItem.field}"
                                        valueChangeListener="#{queryItem.selectOneMenuListener}">
                                        <f:selectItems value="#{searchBean.advancedSearchAllowedFields}" var="field" itemValue="#{field}"
                                            itemLabel="#{msg[field]}" />
                                        <f:ajax render="advsearch_operator_#{status.count} advsearch_value_group_#{status.count}" />
                                        <!--                                         <f:ajax render="searchForm" /> -->
                                    </h:selectOneMenu>
                                </h:column>
                                <h:column>
                                    <h:selectOneMenu id="advsearch_operator_#{status.count}" value="#{queryItem.operator}">
                                        <f:selectItems value="#{queryItem.searchItemOperators}" var="operator" itemValue="#{operator}"
                                            itemLabel="#{msg[operator]}" />
                                    </h:selectOneMenu>
                                </h:column>
                                <h:column id="advsearch_value_col_#{status.count}">
                                    <h:panelGroup id="advsearch_value_group_#{status.count}">
                                        <h:inputText id="advsearch_value_text_#{status.count}" rendered="#{!queryItem.displaySelectItems}"
                                            value="#{queryItem.value}">
                                            <f:passThroughAttribute name="placeholder" value="#{msg.searchFieldDemoText}" />
                                        </h:inputText>
                                        <h:selectOneMenu id="advsearch_value_select_#{status.count}" rendered="#{queryItem.displaySelectItems}"
                                            value="#{queryItem.value}">
                                            <c:forEach var="item" items="#{queryItem.selectItems}">
                                                <f:selectItem itemValue="#{item.one}" itemLabel="#{item.two}" />
                                            </c:forEach>
                                        </h:selectOneMenu>
                                    </h:panelGroup>
                                </h:column>
                            </c:forEach>
                        </h:panelGrid>
                    </div>

                    <div class="search-filter">
                        <h3>#{msg.countsFor}:</h3>

                        <h:selectOneRadio value="#{searchBean.advancedSearchOperator}" id="advsearch_radio_group">
                            <f:ajax event="valueChange" />
                            <f:selectItem itemValue="0" itemLabel="#{msg.searchAdvanced_allConditions}" />
                            <f:selectItem itemValue="1" itemLabel="#{msg.searchAdvanced_anyCondition}" />
                        </h:selectOneRadio>
                    </div>

                    <div class="search-action">
                        <h:commandLink id="advSearchResetBtn" styleClass="btn" value="#{msg.reset}" action="#{searchBean.resetSearchAction}" />
                        <h:commandButton value="#{msg.search}" id="advsearch_butt" styleClass="btn" action="#{searchBean.searchAdvanced}">
                            <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="1" />
                        </h:commandButton>
                    </div>
                </h:panelGroup>
                
                <!-- search timeline -->
                <h:panelGroup id="searchgrouptimeline" styleClass="search-wrapp" rendered="#{searchBean.activeSearchType == 2}" layout="block">
                    <div class="search-title">
                        <h3>
                            <h:outputText value="#{msg.searchTimeline}" />
                        </h3>
                    </div>

                    <div class="search-input">
						<div class="form-horizontal">
							<div class="form-group">
								<label for="yearStart" class="col-sm-3 control-label">#{msg.yearStart}</label>
								<div class="col-sm-9">
                                    <h:inputText id="yearStart" styleClass="form-control" value="#{calendarBean.yearStart}" />
								</div>
							</div>
							<div class="form-group">
								<label for="yearEnd" class="col-sm-3 control-label">#{msg.yearEnd}</label>
								<div class="col-sm-9">
                                    <h:inputText id="yearEnd" styleClass="form-control" value="#{calendarBean.yearEnd}" />
								</div>
							</div>
							<div class="form-group">
								<label for="collection" class="col-sm-3 control-label">#{msg.collection}</label>
								<div class="col-sm-9">
                                    <h:selectOneMenu id="collection" styleClass="form-control" value="#{calendarBean.collection}">
                                        <f:selectItem itemLabel="#{msg.allCollections}" itemValue="" />
                                        <f:selectItems var="item" value="#{searchBean.allCollections}" itemValue="#{item.one}" itemLabel="#{item.two}" />
                                    </h:selectOneMenu>
								</div>
							</div>
						</div>
                    </div>

                    <div class="search-reset">
                        <h:commandLink id="timelineSearchResetBtn" styleClass="btn" value="#{msg.reset}" action="#{searchBean.resetSearchAction}" />
                        <h:commandButton title="#{msg.limitSearch}" value="#{msg.limitSearch}" action="#{calendarBean.limitSearch}" styleClass="btn" />
                    </div>

                    <div id="yearbox" class="search-output">
                        <ui:repeat var="row" value="#{calendarBean.rowList}" varStatus="rowindex">
                            <div class="yearline">
                                <ui:repeat var="year" value="#{row.itemList}">
                                    <div class="year">
                                        <h:outputText value="#{year.name}" title="#{msg.nohits}" rendered="#{year.hits == 0}" />
                                        <h:commandLink value="#{year.name}" title="#{msg.currentHits}: #{year.hits}"
                                            rendered="#{year.hits != 0 and year != calendarBean.currentYear}">
                                            <f:setPropertyActionListener target="#{calendarBean.currentYear}" value="#{year}" />
                                            <f:setPropertyActionListener target="#{calendarBean.rowIndex}" value="#{rowindex.index}" />
                                        </h:commandLink>
                                        <h:commandLink styleClass="year-active" title="#{msg.currentHits}: #{year.hits}" value="#{year.name}"
                                            rendered="#{year.hits != 0 and year == calendarBean.currentYear}">
                                            <f:setPropertyActionListener target="#{calendarBean.currentYear}" value="#{year}" />
                                            <f:setPropertyActionListener target="#{calendarBean.rowIndex}" value="#{rowindex.index}" />
                                        </h:commandLink>
                                    </div>
                                </ui:repeat>
                            </div>

                            <h:panelGroup rendered="#{calendarBean.rowIndex == rowindex.index and calendarBean.monthRow.selected}">
                                <div class="monthline">
                                    <ui:repeat var="month" value="#{calendarBean.monthRow.itemList}">
                                        <div class="month">
                                            <h:outputText value="#{month.name}" title="#{msg.nohits}" rendered="#{month.hits == 0}" />
                                            <h:commandLink value="#{month.name}" title="#{msg.currentHits}: #{month.hits}"
                                                rendered="#{month.hits != 0 and month != calendarBean.currentMonth}">

                                                <f:setPropertyActionListener target="#{calendarBean.currentMonth}" value="#{month}" />
                                            </h:commandLink>
                                            <h:commandLink styleClass="month-active" value="#{month.name}" title="#{msg.currentHits}: #{month.hits}"
                                                rendered="#{month.hits != 0 and month == calendarBean.currentMonth}">
                                                <f:setPropertyActionListener target="#{calendarBean.currentMonth}" value="#{month}" />
                                            </h:commandLink>
                                        </div>
                                    </ui:repeat>
                                </div>
                            </h:panelGroup>

                            <h:panelGroup
                                rendered="#{calendarBean.rowIndex == rowindex.index and calendarBean.monthRow.selected and calendarBean.dayRow.selected}">
                                <div class="dayline">
                                    <ui:repeat var="day" value="#{calendarBean.dayRow.itemList}">
                                        <div class="day">
                                            <h:outputText value="#{day.name}" title="#{msg.nohits}" rendered="#{day.hits == 0}" />
                                            <h:commandLink value="#{day.name}" title="#{msg.currentHits}: #{day.hits}"
                                                rendered="#{day.hits != 0 and day.name != calendarBean.currentDay.name}">
                                                <f:setPropertyActionListener target="#{calendarBean.currentDay}" value="#{day}" />
                                            </h:commandLink>
                                            <h:commandLink styleClass="day-active" value="#{day.name}" title="#{msg.currentHits}: #{day.hits}"
                                                rendered="#{day.hits != 0 and day.name == calendarBean.currentDay.name}">
                                                <f:setPropertyActionListener target="#{calendarBean.currentDay}" value="#{day}" />
                                            </h:commandLink>
                                            <h:outputText value="#{msg[day.dayOfWeek]}" />
                                        </div>
                                    </ui:repeat>
                                </div>
                            </h:panelGroup>
                        </ui:repeat>
                    </div>
                    
                    <div class="clearfix"></div>

					<div class="search-action">
						<h:panelGroup rendered="#{calendarBean.currentYear != null}">
							<h:panelGroup
								rendered="#{calendarBean.countOfIncompleteData != 0}">
								<div class="row">
									<div class="col-md-12">
										<h:outputText value="#{msg.incompleteData}: " />
										<h:commandLink title="#{calendarBean.countOfIncompleteData}"
											value="#{calendarBean.countOfIncompleteData}"
											action="#{calendarBean.searchForIncompleteData}" />
									</div>
								</div>
							</h:panelGroup>
							<div class="row">
								<div class="col-md-9">
									<h:outputText value="#{msg.currentSelection}: " />
									<h:outputText value="#{calendarBean.currentDay.name}. "
										rendered="#{calendarBean.currentDay != null}" />
									<h:outputText value="#{msg[calendarBean.currentMonth.name]} "
										rendered="#{calendarBean.currentMonth != null}" />
									<h:outputText value="#{calendarBean.currentYear.name} " />
								</div>
								<div class="col-md-3">
									<h:commandButton title="#{msg.search}" value="#{msg.search}"
										action="#{calendarBean.searchTimeline}" styleClass="btn"
										rendered="#{calendarBean.currentYear != null}">
										<f:setPropertyActionListener
											target="#{searchBean.activeSearchType}" value="2" />
									</h:commandButton>
								</div>
							</div>
						</h:panelGroup>
					</div>
				</h:panelGroup>

                <!-- search calendar -->
                <h:panelGroup id="searchgroupcalendar" styleClass="search-wrapp" rendered="#{searchBean.activeSearchType == 3}" layout="block">
                    <div class="search-title">
                        <h3>
                            <h:outputText value="#{msg.searchCalendar}" />
                        </h3>
                    </div>

                    <div class="search-input yearselection">
                        <div class="form form-vertical">
                            <div class="form-row">
                                <div class="form-label">
                                    <h:outputLabel for="selectyear" value="#{msg.selectYear}" />
                                </div>
                                <div class="form-input">
                                    <h:selectOneMenu id="selectyear" value="#{calendarBean.selectYear}" immediate="true" onchange="submit();">
                                        <f:selectItem itemDisabled="true" itemLabel="#{msg.select}" />
                                        <f:selectItems var="year" itemLabel="#{year.name}, #{msg.currentHits}: #{year.hits}" itemValue="#{year.name}"
                                            value="#{calendarBean.allActiveYears}" />
                                    </h:selectOneMenu>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-label">
                                    <h:outputLabel for="selectcollection" value="#{msg.collection}" />
                                </div>
                                <div class="form-input">
                                    <h:selectOneMenu id="selectcollection" value="#{calendarBean.collection}" onchange="submit();">
                                        <f:selectItem itemLabel="#{msg.allCollections}" itemValue="" />
                                        <f:selectItems var="item" value="#{searchBean.allCollections}" itemValue="#{item.one}"
                                            itemLabel="#{item.two}" />
                                    </h:selectOneMenu>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- calendar search reset -->
                    <div class="search-reset">
                        <h:commandLink id="calendarSearchResetBtn" styleClass="btn" value="#{msg.reset}" action="#{searchBean.resetSearchAction}" />
                    </div>

                    <div id="currentyear" class="search-output">
                        <ui:repeat var="month" value="#{calendarBean.monthList}">
                            <div class="calendar-year-month-box div-table">
                                <span><h:outputText value="#{msg[month.name]}" /></span>
                                <div class="div-table-row">
                                    <div class="div-table-cell div-table-head">#{msg.Monday}</div>
                                    <div class="div-table-cell div-table-head">#{msg.Tuesday}</div>
                                    <div class="div-table-cell div-table-head">#{msg.Wednsday}</div>
                                    <div class="div-table-cell div-table-head">#{msg.Thursday}</div>
                                    <div class="div-table-cell div-table-head">#{msg.Friday}</div>
                                    <div class="div-table-cell div-table-head">#{msg.Saturday}</div>
                                    <div class="div-table-cell div-table-head">#{msg.Sunday}</div>
                                </div>
                                <ui:repeat var="week" value="#{month.weeksOfMonth}">
                                    <div class="div-table-row">
                                        <ui:repeat var="day" value="#{week.daysOfWeek}">
                                            <h:panelGroup styleClass="div-table-cell" layout="block" rendered="#{day.name != ''}">
                                                <h:outputText value="#{day.name}" rendered="#{day.hits == 0}" />
                                                <h:commandLink value="#{day.name}" title="#{msg.currentHits}: #{day.hits}"
                                                    rendered="#{day.hits != 0 and !(day.name == calendarBean.currentDay.name and month.name == calendarBean.currentMonth.name)}">
                                                    <f:setPropertyActionListener target="#{calendarBean.currentMonth}" value="#{month}" />
                                                    <f:setPropertyActionListener target="#{calendarBean.currentDay}" value="#{day}" />
                                                </h:commandLink>
                                                <h:commandLink styleClass="day-active" value="#{day.name}" title="#{msg.currentHits}: #{day.hits}"
                                                    rendered="#{day.hits != 0 and day.name == calendarBean.currentDay.name and month.name == calendarBean.currentMonth.name}">
                                                    <f:setPropertyActionListener target="#{calendarBean.currentMonth}" value="#{month}" />
                                                    <f:setPropertyActionListener target="#{calendarBean.currentDay}" value="#{day}" />
                                                </h:commandLink>
                                            </h:panelGroup>
                                            <h:panelGroup styleClass="div-table-cell-empty" layout="block" rendered="#{day.name == ''}">
                                            </h:panelGroup>
                                        </ui:repeat>
                                    </div>
                                </ui:repeat>
                            </div>
                        </ui:repeat>
                    </div>

                    <div class="search-action">
                        <h:panelGroup rendered="#{calendarBean.selectYear != null}" layout="block" styleClass="div-table">
                            <h:panelGroup styleClass="div-table-row" layout="block" rendered="#{calendarBean.countOfIncompleteData != 0}">
                                <div class="div-table-cell">
                                    <h:outputText value="#{msg.incompleteData}: " />
                                </div>
                                <div class="div-table-cell">
                                    <h:commandLink title="#{calendarBean.countOfIncompleteData}" value="#{calendarBean.countOfIncompleteData}"
                                        action="#{calendarBean.searchForIncompleteData}" />
                                </div>

                            </h:panelGroup>
                            <div class="div-table-row">
                                <div class="div-table-cell">
                                    <h:outputText value="#{msg.currentSelection}: " />
                                </div>
                                <div class="div-table-cell">
                                    <h:outputText value="#{calendarBean.currentDay.name}. " rendered="#{calendarBean.currentDay != null}" />
                                    <h:outputText value="#{msg[calendarBean.currentMonth.name]} " rendered="#{calendarBean.currentMonth != null}" />
                                    <h:outputText value="#{calendarBean.selectYear} " />
                                </div>
                                <h:commandButton title="#{msg.search}" value="#{msg.search}" action="#{calendarBean.searchCalendar}" styleClass="btn"
                                    rendered="#{calendarBean.selectYear != null}">
                                    <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="3" />
                                </h:commandButton>
                            </div>
                        </h:panelGroup>
                    </div>
                </h:panelGroup>
            </h:panelGroup>
        </h:form>
    </composite:implementation>
</ui:composition>
