<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:p="http://primefaces.org/ui" 
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner" 
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets">
    
    <!-- USER LOGIN -->
    <div id="userLogin" class="user-login">
        <i class="fa fa-times" role="button" aria-label="#{msg.login__close}"></i>
        
        <!-- USER LOGIN WRAPPER -->
        <div id="userLoginWrapper" class="user-login__wrapper">
            <!-- USER LOGIN HEADER -->
            <div class="user-login__header">
                <h3>#{msg.login__header_title}</h3>
                <div class="user-login__header-logo"></div>
            </div>
            
            <!-- USER LOGIN BODY -->
            <div class="user-login__body">
                <!-- USER LOGIN BODY LOGIN SELECT -->
                <div id="userLoginSelectLoginWrapper" class="user-login__body-login-select">
                    <div class="form-group">
                        <label for="userLoginSelectLogin" class="control-label">#{msg.login__select_login_title}</label>
                        
                        <div class="custom-control custom-control--select">
                            <!-- TODO: Nach Auswahl der Option muss das Formular für externe Logins wissen was ausgewählt wurde. -->
<!--                             <h:selectOneMenu id="userLoginSelectLogin" value="#{userBean.authenticationProvider}"> -->
<!--                                 <f:selectItems value="" var="" itemValue="" itemLabel="" /> -->
<!--                             </h:selectOneMenu> -->

                            <select name="userLoginSelectLogin" id="userLoginSelectLogin">
                                <option value="Goobi viewer" selected="selected">#{msg.login__local_account}</option>
                                
                                <!-- EXTERNAL LOGIN TYPES -->
                                <ui:fragment rendered="#{userBean.hasProvidersOfType('userpassword')}">
                                    <ui:repeat var="provider" value="#{userBean.getProvidersOfType('userpassword')}">
                                        <option value="#{provider.name}">#{provider.name}</option>                            
                                    </ui:repeat>
                                </ui:fragment>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- USER LOGIN BODY LOGIN TYPE -->
                <div class="user-login__body-login-type-wrapper">
                    <!-- USER LOGIN LOCALE ACCOUNT -->
                    <ui:fragment rendered="#{userBean.hasProvidersOfType('local')}">
                        <div id="loginTypeLocale" class="user-login__body-login-type local">
                            <h:form id="userLoginLocalForm" prependId="false">
                                <div class="form-group">
                                    <label for="userEMail" class="control-label">#{msg.email}:</label>
                                    <h:inputText id="userEMail" styleClass="form-control" value="#{userBean.email}" required="true" requiredMessage="#{msg.loginEnterUserName}">
                                        <f:validator validatorId="emailValidator" />
                                        <f:passThroughAttribute name="placeholder" value="name@company.com" />
                                    </h:inputText>
                                </div>
    
                                <div class="form-group">
                                    <label for="userPassword" class="control-label">#{msg.password}:</label>
                                    <h:inputSecret 
                                        id="userPassword" 
                                        styleClass="form-control" 
                                        type="password" 
                                        value="#{userBean.password}" 
                                        required="true"
                                        requiredMessage="#{msg.login__enter_password}">
                                        <f:passThroughAttribute name="placeholder" value="#{msg.login__enter_password}" />
                                    </h:inputSecret>
                                </div>
                                
                                <!-- USER LOGIN BODY ACTION -->
                                <div class="user-login__body-action">
                                    <!--  LOGIN -->
                                    <h:commandButton 
                                        styleClass="btn btn--full" 
                                        value="#{msg.login}" 
                                        action="#{userBean.login}">
                                        <f:setPropertyActionListener target="#{userBean.authenticationProvider}" value="#{userBean.localAuthenticationProvider}" />
                                        <f:passThroughAttribute name="aria-label" value="#{msg.login}" />
                                    </h:commandButton>

                                    <br />

                                    <!-- RETRIEVE ACCOUNT -->
                                    <button 
                                        type="button" 
                                        class="btn btn--link" 
                                        aria-label="#{msg.user_forgotPassword}" 
                                        data-open="retrieve-account">
                                        #{msg.login__forgot_password}
                                    </button>
                                </div>
                            </h:form>
                        </div>
                    </ui:fragment>
                    
                    <!-- USER LOGIN EXTERNAL ACCOUNT -->
                    <ui:fragment rendered="#{userBean.hasProvidersOfType('userpassword')}">
                        <div id="loginTypeExternal" class="user-login__body-login-type external">
                            <h:form id="userLoginExternalForm" prependId="false">
                                <div class="form-group">
                                    <label for="externalUserName" class="control-label">#{msg.username}:</label>
                                    <h:inputText 
                                        id="externalUserName" 
                                        styleClass="form-control" 
                                        value="#{userBean.email}" 
                                        required="true" 
                                        requiredMessage="#{msg.loginEnterUserName}" />
                                </div>

                                <div class="form-group">
                                    <label for="externalUserPassword" class="control-label">#{msg.password}:</label>
                                    <h:inputSecret 
                                        id="externalUserPassword" 
                                        styleClass="form-control" 
                                        type="password" 
                                        value="#{userBean.password}" 
                                        required="true"
                                        requiredMessage="#{msg.login__enter_password}" />
                                </div>
                                
                                <!-- USER LOGIN BODY ACTION -->
                                <div class="user-login__body-action">                                    
                                    <!-- LOGIN -->
                                    <h:commandButton 
                                        styleClass="btn btn--full" 
                                        value="#{msg.login}"
                                        action="#{userBean.login}">
                                        <f:setPropertyActionListener target="#{userBean.authenticationProvider}" value="#{provider}" />
                                        <f:passThroughAttribute name="aria-label" value="#{msg.login}" />
                                    </h:commandButton>
                                </div>
                            </h:form>
                        </div>
                    </ui:fragment>
                
                    <!-- USER LOGIN TYPE RETRIEVE ACCOUNT -->
                    <div id="loginTypeRetrieveAccount" class="user-login__body-login-type retrieve">
                        <p>#{msg.login__retrieve_account_description}</p>

                        <h:form id="loginTypeRetrieveAccountForm">
                            <div class="form-group">
                                <label for="userEMailToRetrieve" class="contro-label">#{msg.email}:</label>
                                <h:inputText id="userEMailToRetrieve" styleClass="form-control" value="#{userBean.email}" required="true" requiredMessage="#{msg.loginEnterEmail}">
                                    <f:validator validatorId="emailValidator" />
                                </h:inputText>
                            </div>
                            
                            <!-- USER LOGIN BODY ACTION -->
                            <div class="user-login__body-action">
                                <h:commandButton 
                                    styleClass="btn btn--full" 
                                    value="#{msg.submit}" 
                                    action="#{userBean.sendPasswordResetLinkAction}">
                                    <f:passThroughAttribute name="aria-label" value="#{msg.submit}" />
                                </h:commandButton>
                                
                                <br />
                                
                                <button
                                    type="button" 
                                    class="btn btn--link" 
                                    aria-label="#{msg.login__back_to_login}" 
                                    data-close="retrieve-account">
                                    #{msg.login__back_to_login}
                                </button>
                            </div>
                        </h:form>
                    </div>
                    
                    <!-- USER LOGIN TYPE CREATE ACCOUNT -->
                    <div id="loginTypeCreateAccount" class="user-login__body-login-type create">
                        <h:form id="loginTypeCreateAccountForm">
                            <div class="form-group">
                                <label for="userCreateAccountNick" class="control-label">#{msg.nameNick}:</label>
                                <h:inputText 
                                    id="userCreateAccountNick" 
                                    styleClass="form-control" 
                                    value="#{userBean.nickName}" 
                                    required="true"
                                    requiredMessage="#{msg.loginEnterNickName}">
                                    <f:validator validatorId="nicknameValidator" />
                                </h:inputText>
                            </div>

                            <div class="form-group">
                                <label for="userCreateAccountEMail" class="control-label">#{msg.email}:</label>
                                <h:inputText 
                                    id="userCreateAccountEMail" 
                                    styleClass="form-control" 
                                    value="#{userBean.email}" 
                                    required="true"
                                    requiredMessage="#{msg.loginEnterEmail}">
                                    <f:validator validatorId="emailValidator" />
                                    <f:validator validatorId="emailAvailableValidator" />
                                </h:inputText>
                            </div>

                            <div class="form-group">
                                <label for="userCreateAccountPW1" class="control-label">#{msg.newUserPasswordOne}:</label>
                                <h:inputSecret 
                                    id="userCreateAccountPW1" 
                                    styleClass="form-control" 
                                    type="password" 
                                    value="#{userBean.passwordOne}" 
                                    required="true"
                                    requiredMessage="#{msg.newUserPasswordOneRequired}">
                                    <f:validator validatorId="passwordValidator" />
                                </h:inputSecret>
                            </div>

                            <div class="form-group">
                                <label for="userCreateAccountPW2" class="control-label">#{msg.newUserPasswordTwo}:</label>
                                <h:inputSecret 
                                    id="userCreateAccountPW2" 
                                    styleClass="form-control" 
                                    type="password" 
                                    value="#{userBean.passwordTwo}" 
                                    required="true"
                                    requiredMessage="#{msg.newUserPasswordTwoRequired}" />
                            </div>

                            <p>#{msg.login__new_account_agreement}</p>

                            <!-- USER LOGIN BODY ACTION -->
                            <div class="user-login__body-action">
                                <h:commandButton 
                                    styleClass="btn btn--full" 
                                    value="#{msg.submit}"
                                    action="#{userBean.sendPasswordResetLinkAction}">
                                    <f:passThroughAttribute name="aria-label" value="#{msg.submit}" />
                                </h:commandButton>

                                <br />

                                <button type="button" class="btn btn--link" aria-label="#{msg.login__back_to_login}" data-close="create-account">
                                    #{msg.login__back_to_login}</button>
                            </div>
                        </h:form>
                    </div>
                </div>
    
                <!-- USER LOGIN BODY LOGIN OPEN ID -->
                <div class="user-login__body-login-open-id">                    
                    <h4><span>#{msg.login__login_with_other_provider}</span></h4>
                    
                    <h:form id="userLoginOpenIdForm">
                        <ul>
                            <ui:repeat var="provider" value="#{userBean.getProvidersOfType('openId')}">
                                <li class="user-login__body-login-open-id-provider #{provider.name}">
                                    <h:commandLink action="#{userBean.login}">
                                        #{provider.name}
                                        <f:setPropertyActionListener target="#{userBean.authenticationProvider}" value="#{provider}" />
                                        <f:passThroughAttribute name="aria-label" value="#{msg.login__login_with} #{provider.name}" />
                                    </h:commandLink>
                                </li>
                            </ui:repeat>
                        </ul>
                    </h:form>
                </div>
            </div>
            
            <!-- USER LOGIN FOOTER -->
            <h:panelGroup rendered="#{userBean.userRegistrationEnabled}">
                <div class="user-login__footer">
                    #{msg.login__new_to_goobi_viewer}
                    <button 
                        type="button" 
                        class="btn btn--link" 
                        aria-label="#{msg.user_createNewAccount}" 
                        data-open="create-account">
                        #{msg.login__create_new_account}
                    </button>
                </div>
            </h:panelGroup>
        </div>
    </div>
</ui:composition>