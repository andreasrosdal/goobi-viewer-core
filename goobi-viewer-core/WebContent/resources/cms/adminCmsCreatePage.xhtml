<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:h="http://xmlns.jcp.org/jsf/html" 
	xmlns:f="http://xmlns.jcp.org/jsf/core" 
	xmlns:p="http://primefaces.org/ui" 
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:cmsComponent="http://xmlns.jcp.org/jsf/composite/cms/components" 
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
	xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets" 
	template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView" listener="#{navigationHelper.setCurrentPageAdmin(cmsBean.editMode ? 'adminCmsEditPage':'adminCmsCreatePage')}" />
			<f:event type="preRenderView" listener="#{navigationHelper.addStaticLinkToBreadcrumb(cmsBean.editMode ? msg.cms_editPage : msg.cms_createPage, 1)}" />
		</f:metadata>
	</ui:define>

	<ui:define name="breadcrumbs">
		<ui:include src="/resources/includes/breadcrumbs.xhtml" />
	</ui:define>

	<ui:define name="content">
		<h:panelGroup id="cmsCreatePageAccessControl" rendered="#{configurationBean.cmsEnabled}">
			<h:panelGroup layout="block" id="cmsCreatePage">
				<h:form rendered="#{userBean.admin and cmsBean.selectedPage == null}">
					<h:commandLink action="pretty:adminCmsOverview">
						<h:outputText value="#{msg.cms_backToOverview}" />
					</h:commandLink>
				</h:form>
				<h:panelGroup rendered="#{userBean.admin and cmsBean.selectedPage != null}">
					<!-- AJAX Loader -->
					<div id="AJAXLoader"></div>

					<h2>#{cmsBean.editMode ? msg.cms_editPage : msg.cms_createPage}: #{cmsBean.selectedPage.template.name}</h2>
					<div class="row">
						<h:form id="create_page_form">
							<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9 create-page-left">
								<!-- create page wrapper -->
								<div id="cmsCreatePageWrapper">
									<div role="tabpanel">
										<!-- Nav tabs -->
										<ul class="nav nav-tabs" role="tablist">
											<c:forEach var="locale" items="#{cmsBean.getAllLocales()}">
												<li role="presentation" class="#{cmsBean.selectedLocale == locale ? 'active':''}">
													<h:commandLink value="#{locale}" action="#{cmsBean.setSelectedLocale(locale)}" />
												</li>
											</c:forEach>
											<li role="presentation" class="#{cmsBean.selectedLocale == null ? 'active':''}"><h:commandLink value="#{msg.cms_pageSidebar}" action="#{cmsBean.setSelectedLocale(null)}" /></li>
										</ul>

										<div class="tab-content">
											<!-- localized tabs -->
											<!-- 											<c:forEach var="locale" items="#{cmsBean.getAllLocales()}"> -->
											<h:panelGroup rendered="#{cmsBean.selectedLocale != null}">
												<ui:param name="locale" value="#{cmsBean.selectedLocale}" />
												<div role="tabpanel" class="tab-pane #{cmsBean.selectedLocale == locale ? 'active':''}" id="#{locale.language}">
													<!-- page content -->
													<div class="edit-content-page edit-content-page-content">
														<div class="form-horizontal">
															<div class="form-group">
																<label class="col-sm-3 control-label">#{msg.cms_pageTitle}*:</label>
																<div class="col-sm-9">
																	<h:inputText value="#{cmsBean.selectedPage.getLanguageVersion(locale).title}" styleClass="form-control content-input" />
																</div>
															</div>
															<div class="form-group">
																<label class="col-sm-3 control-label">#{msg.cms_pageMenuTitle}*:</label>
																<div class="col-sm-9">
																	<h:inputText value="#{cmsBean.selectedPage.getLanguageVersion(locale).menuTitle}" styleClass="form-control content-input" />
																</div>
															</div>
															<h:panelGroup rendered="#{cmsBean.selectedPage.template.displaySortingField}">
																<div class="form-group">
																	<label class="col-sm-3 control-label">#{msg.cms_pageSortingField}:</label>
																	<div class="col-sm-9">
																		<h:inputText value="#{cmsBean.selectedPage.pageSorting}" styleClass="form-control content-input" />
																	</div>
																</div>
															</h:panelGroup>
															<ui:repeat var="contentItem" value="#{cmsBean.selectedPage.getContentItems(locale)}">
																<!-- HTML Snippet -->
																<h:panelGroup rendered="#{contentItem.type == 'TEXT'}">
																	<div class="form-group">
																		<label class="col-sm-3 control-label">#{contentItem.itemLabel}#{contentItem.mandatory?'*':''}:</label>
																		<div class="col-sm-9">
																			<h:inputText value="#{contentItem.htmlFragment}" styleClass="form-control content-input" />
																		</div>
																	</div>
																</h:panelGroup>

																<!-- tinyMCE -->
																<h:panelGroup rendered="#{contentItem.type == 'HTML'}">
																	<div class="form-group">
																		<label class="col-sm-3 control-label">#{contentItem.itemLabel}#{contentItem.mandatory?'*':''}:</label>
																		<div class="col-sm-9">
																			<h:inputTextarea styleClass="form-control tinyMCE" value="#{contentItem.htmlFragment}">
																			</h:inputTextarea>
																		</div>
																	</div>
																</h:panelGroup>

																<!-- content type MEDIA -->
																<cmsComponent:cms_createPageContentTypeMedia />

																<!-- content type SOLRQUERY -->
																<cmsComponent:cms_createPageContentTypeSolr />

																<!-- content type PAGELIST -->
																<cmsComponent:cms_createPageContentTypePagelist />

																<!-- content type COLLECTION -->
																<cmsComponent:cms_createPageContentTypeCollection />

																<!-- content type TILEGRID -->
																<cmsComponent:cms_createPageContentTypeTileGrid />

															</ui:repeat>
															<h:panelGroup rendered="#{!cmsBean.getDefaultLocale().equals(locale)}">
																<div class="form-group">
																	<label class="col-sm-3 control-label">#{msg.cms_languageVersion_creationStatus}:</label>
																	<div class="col-sm-9">
																		<div class="form-control__select">
																			<h:selectOneMenu styleClass="form-control" value="#{cmsBean.selectedPage.getLanguageVersion(locale).status}">
																				<f:selectItems value="#{cmsBean.languageStatusValues}" var="field" itemValue="#{field}" itemLabel="#{field.name()}" />
																				<f:ajax render="@none" />
																			</h:selectOneMenu>
																		</div>
																	</div>
																</div>
															</h:panelGroup>
															<div class="edit-content-page__pretty-url">
																<div class="form-group">
																	<label class="col-sm-3 control-label">
																		#{msg.cms_page_pretty_url}:
																		<button type="button" class="btn-clean">
																			<i class="fa fa-question-circle" aria-hidden="true"></i>
																		</button>
																	</label>
																	<div class="col-sm-9">
																		<h:inputText value="#{cmsBean.selectedPage.persistentUrl}" styleClass="form-control content-input" />
																	</div>
																</div>
																
																<script type="text/javascript">
																	$( '.edit-content-page__pretty-url button' ).popover( {
																	    html: true,
																        title: '#{msg.cms_page_pretty_url}',
																        content: '#{msg.cms_page_pretty_url_help}',
																        placement: 'top',
																        trigger: 'hover',
																        container: 'body'
																	} );
																</script>
															</div>
															
															<div class="edit-content-page__subtheme-discriminator">
																<div class="form-group">
																	<label class="col-sm-3 control-label">
																		#{msg.cms_page_subtheme_discriminator}:
																		<button type="button" class="btn-clean">
																			<i class="fa fa-question-circle" aria-hidden="true"></i>
																		</button>
																	</label>
																	<div class="col-sm-9">
																		<h:inputText value="#{cmsBean.selectedPage.subThemeDiscriminatorValue}" styleClass="form-control content-input" />
																	</div>
																</div>
																
																<script type="text/javascript">
																	$( '.edit-content-page__subtheme-discriminator button' ).popover( {
																	    html: true,
																        title: '#{msg.cms_page_subtheme_discriminator}',
																        content: '#{msg.cms_page_subtheme_discriminator_help}',
																        placement: 'top',
																        trigger: 'hover',
																        container: 'body'
																	} );
																</script>
															</div>
															
														</div>
													</div>
												</div>
											</h:panelGroup>
											<!-- 										</c:forEach> -->

											<!-- sidebar editor tab -->
											<cmsComponent:cms_createPageSidebarEditorTab id="sidebar_editor_component" />

										</div>
										<!-- end .tab-content -->
									</div>
								</div>
							</div>

							<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 create-page-right">
								<!-- metadata wrapper -->
								<cmsComponent:cms_createPageMetadataItemWrapper id="metadata_component" />
							</div>
							<!-- end .create-page-right -->
						</h:form>
					</div>
					<!-- end .row -->
				</h:panelGroup>
				<script type="text/javascript">
	                var createPageConfig = {
	                    selectedPageID: '#{cmsBean.selectedPage.id}',
	                    inputFields: $( '.content-input' ),
	                    prevBtn: $( '#preview-button' ),
	                    prevDescription: $( '#previewDescription' ),
	                    saveBtn: $( 'a[id*="save-button"]' ),
	                    sortablesConfig: {
	                        componentListInput: document.getElementById( "create_page_form:sidebar_editor_component:itemOrderInput" ),
	                        // 				        editButton: $('.ui-sortable li .glyphicon-edit'),
	                        editButton: $( '.widget-edit' ),
	                        availableItemList:  '#availableItemList' ,
	                        visibleItemList:  '#visibleItemList' 
	                    }
	                };
	                
	                cmsJS.createPage.init( createPageConfig );
	            </script>
			</h:panelGroup>

		</h:panelGroup>
	</ui:define>

	<ui:define name="sidebar">
		<widgetComponent:widget_admin />
		<widgetComponent:widget_cms />
		<widgetComponent:widget_user />
	</ui:define>
</ui:composition>