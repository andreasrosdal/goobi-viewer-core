<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://xmlns.jcp.org/jsf/composite"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components">
	
    <!-- CONTENT -->
                <!-- MEDIA ITEM OVERLAY -->
                <div class="admin-cms-media__overlay"></div>
            
                <div class="admin__content-inner-content">
                    <!-- UPLOAD -->
                    <adminMediaUpload></adminMediaUpload>

                    <h:form id="adminCmsMediaFilesForm" prependId="false">
                    
	                    <ui:include src="/resources/cms/includes/mediaActions.xhtml">
	                   		<ui:param name="bulkaction" value="#{false}"/>
		                    <ui:param name="viewswitch" value="#{false}" />
	                    </ui:include>
	
	                    <!-- MEDIA FILES -->
	                    <div class="admin-cms-media__files">
		                    <ui:repeat id="mediaList" value="#{cmsMediaBean.getMediaItems()}" var="selectableItem" varStatus="status">
		                       
		                       <div class="cms-mediaitem-wrapper #{selectableItem == cmsMediaBean.selectedMediaItem ? 'selected' : ''}">
			                       <div class="cms-mediaitem-item">
				                       <ui:include src="/resources/cms/includes/mediaFile.xhtml">
				                       		<ui:param name="item" value="#{selectableItem}" />
				                       		<ui:param name="idPrefix" value="mediaList:#{status.index}:" />
				                       </ui:include>
			                       </div>
			                       <h:commandLink styleClass="cms-mediaitem-select" action="#{cmsMediaBean.toggleSelectedMediaItem(selectableItem)}">
				                       <f:ajax execute="@this" render="selectedMediaItemPanel" onevent="reload"></f:ajax>
			                       </h:commandLink>
		                       </div>
		                                                                                
		                        
		                    </ui:repeat>
                    	</div>
                    	<div class="admin-cms-media__selected-file">
                    		<h:panelGroup id="selectedMediaItemPanel">
	                    		<ui:fragment rendered="#{cmsMediaBean.selectedMediaItem != null}">
	                    			<ui:include src="/resources/cms/includes/mediaFile.xhtml">
		                       			<ui:param name="item" value="#{cmsMediaBean.selectedMediaItem}"/>
		                       		</ui:include>
	                    		</ui:fragment>
                    		</h:panelGroup>
                    	</div>
                	</h:form>
                </div>

        <script type="text/javascript">
        	var adminMediaConfig = {
            	postUrl: '#{navigationHelper.applicationUrl}rest/cms/media/upload/',
            	msg: {
            		buttonUpload: "#{msg.button__upload}",
            		uploadText: "#{msg.admin__media_upload_text}",
            		allowedFileTypes: "#{msg.admin__media_upload_filetypes}",
            		mediaUploading: "#{msg.admin__media_upload_uploading}",
            		mediaFinished: "#{msg.admin__media_upload_finished}",
            		mediaError: "#{msg.admin__media_upload_error}"
            	},
            	onUploadComplete: function() {
            		$("#reloadButton").click();
            	},
            	forceGrid: true,
            	allowEdit: false
            };
            
        	viewerJS.clipboard.init( '[data-copy]' );
        	cmsJS.media.init( adminMediaConfig );
        	riot.mount( 'adminMediaUpload', adminMediaConfig );
        	
        	function reload(data) {
        		cmsJS.media.onReload(data);
        		cmsJS.modules.onReload(data);
        		if(!data || data.status == "success") {        			
        			riot.mount( 'adminMediaUpload', adminMediaConfig );
        			if(data) {
        				var alreadySelected = $(data.source).parent().hasClass('selected');
        				$(".cms-mediaitem-wrapper.selected").removeClass('selected');
        				if(!alreadySelected) {        					
        					$(data.source).parent().addClass('selected');
        				}
        			}
        		}
        	}
		</script>
    
</ui:composition>