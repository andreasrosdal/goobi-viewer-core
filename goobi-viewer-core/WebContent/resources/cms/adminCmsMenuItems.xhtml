<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
	xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
	template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{navigationHelper.setCurrentPageAdmin('adminCmsMenuItems')}" />
			<f:event type="preRenderView"
				listener="#{navigationHelper.addStaticLinkToBreadcrumb(msg.cms_menuItems,1)}" />
			<f:event type="preRenderView"
				listener="#{adminBean.resetCurrentLicenseAction}" />
		</f:metadata>
	</ui:define>

	<ui:define name="breadcrumbs">
		<ui:include src="/resources/includes/breadcrumbs.xhtml" />
	</ui:define>

    <ui:define name="content">
        <h:panelGroup id="cmsMenuItemsAccessControl" rendered="#{configurationBean.cmsEnabled}">
            <div id="cmsMenuItems" class="cms-menu">
                <h:form id="editMenuForm">
                    <h:panelGroup rendered="#{userBean.admin}">
                        <h2>#{msg.cms_menuItems}</h2>
                        
                        <!-- SELECT THEME -->
                        <ui:fragment rendered="#{cmsNavigationBean.selectableThemes.size() > 1}">
                            <div class="cms-menu__select-theme">
                                <!-- OPTION GROUP -->
                                <div class="cms-module__option-group">
                                    <div class="cms-module__option-label">
                                        <label for="cmsMenuAddItemSelectSubtheme">#{msg.cms_menu_item_subtheme}:</label>
                                    </div>
                                    <div class="cms-module__option-control">
                                        <div class="custom-control custom-control--select">
                                            <h:selectOneMenu value="#{cmsNavigationBean.selectedTheme}" name="cmsMenuAddItemSelectSubtheme" id="cmsMenuAddItemSelectSubtheme">
                                                <f:selectItems value="#{cmsNavigationBean.selectableThemes}" var="theme" itemValue="#{theme}" itemLabel="#{msg[theme]}"/>
                                                <f:ajax event="change" render="@all"/>
                                            </h:selectOneMenu>
                                        </div>
                                        <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemSubthemeInfo}</span>
                                    </div>
                                    <div class="cms-module__option-help">
                                        <button type="button" class="btn-clean" data-toggle="helptext">
                                            <i class="fa fa-question-circle" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </ui:fragment>

                        <!-- ADD MENU ITEM -->
                        <div class="cms-menu__add-item">
                            <button type="button" class="btn-clean" data-toggle="add-menu-item">
                                <i class="fa fa-plus-circle" aria-hidden="true"></i> #{msg.cms_menu_createItem}
                            </button>
                            <h:commandButton id="cmsMenuAddItemTrigger" styleClass="btn-hidden" action="#{cmsNavigationBean.createNavigationItem()}">
                                <f:ajax render="addItemOptions"></f:ajax>
                            </h:commandButton>

                            <h:panelGroup id="addItemOptions" styleClass="cms-menu__add-item-options" layout="block">
                                <!-- OPTION -->
                                <div class="cms-module__option">
                                    <!-- OPTION GROUP -->
                                    <div class="cms-module__option-group">
                                        <div class="cms-module__option-label">
                                            <label for="cmsMenuAddItemLabel">#{msg.cms_menu_item_label}:</label>
                                        </div>
                                        <div class="cms-module__option-control">
                                            <h:inputText id="cmsMenuAddItemLabel" value="#{cmsNavigationBean.navigationItem.itemLabel}" styleClass="form-control" />
                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemNameInfo}</span>
                                        </div>
                                        <div class="cms-module__option-help">
                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- OPTION GROUP -->
                                    <div class="cms-module__option-group">
                                        <div class="cms-module__option-label">
                                            <label for="cmsMenuAddItemUrl">#{msg.cms_menu_item_url}:</label>
                                        </div>
                                        <div class="cms-module__option-control">
                                            <h:inputText id="cmsMenuAddItemUrl" value="#{cmsNavigationBean.navigationItem.pageUrl}" styleClass="form-control" />
                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemUrlInfo}</span>
                                        </div>
                                        <div class="cms-module__option-help">
                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- OPTION GROUP -->
                                    <div class="cms-module__option-group">
                                        <div class="cms-module__option-label">
                                            <label for="cmsMenuAddItemNewTab">#{msg.cms_menu_item_newTab}:</label>
                                        </div>
                                        <div class="cms-module__option-control">
                                            <span class="cms-module__option-control-checkbox">
                                                <h:selectBooleanCheckbox id="cmsMenuAddItemNewTab" />
                                            </span>
                                            <br />
                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemNewTabInfo}</span>
                                        </div>
                                        <div class="cms-module__option-help">
                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- ACTION -->
                                    <div class="cms-module__option-action">
                                        <h:commandButton value="#{msg.cms_menu_addItem}" action="#{cmsNavigationBean.saveNavigationItem()}" styleClass="btn" />
                                    </div>
                                </div>                                
                            </h:panelGroup>
                        </div>
                        
                        <!-- SAVE MENU -->
                        <div class="cms-menu__save">
                            <h:inputHidden id="itemOrderInput" name="itemOrderInput" value="#{cmsNavigationBean.menuItemList}" />
                            <h:commandButton value="#{msg.cms_menu_save}" action="#{cmsNavigationBean.saveMenuItems}" styleClass="btn" />
                        </div>

                        <!-- MENU EDITOR -->
                        <div class="cms-menu__editor">
                            <!-- VISIBLE ITEMS -->
                            <div class="cms-menu__visible-items">
                                <h4>
                                    #{msg.cms_menu_visibleComponents}
                                    <i class="fa fa-question-circle" data-toggle="tooltip" data-placement="top" title="#{msg.cms_menu_instruction}" aria-hidden="true"></i>
                                </h4>

                                <ul id="visibleItemList" class="cms-menu__visible-items-list">
                                    <ui:repeat var="visibleItem" value="#{cmsNavigationBean.getVisibleMenuItems(cmsNavigationBean.selectedTheme)}">
                                        <li sortPosition="item_#{visibleItem.availableItemId}?#{visibleItem.level}"
                                            class="cms-menu__visible-item #{visibleItem.hasUnpublishedCmsPage() ? 'unpublished':''} #{visibleItem.hasDeletedCmsPage() ? 'deleted':''}">
                                            <!-- ITEM LEVEL -->
                                            <div class="cms-menu__visible-item-level">
                                                <button type="button" class="btn-clean left" title="#{msg.cms_menu_decreaseMenuItem}"
                                                    onclick="cmsJS.sortableList.decreaseLevel(this, true);">
                                                    <i class="fa fa-arrow-circle-left" aria-hidden="true"></i>
                                                </button>
                                                <button type="button" class="btn-clean right" title="#{msg.cms_menu_increaseMenuItem}"
                                                    onclick="cmsJS.sortableList.increaseLevel(this, true);">
                                                    <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                            
                                            <!-- ITEM LABEL -->
                                            <div class="cms-menu__visible-item-label">#{msg[visibleItem.itemLabel]}</div>

                                            <!-- ITEM EDIT -->
                                            <ui:fragment rendered="#{visibleItem.absoluteLink}">
                                                <div class="cms-menu__visible-item-edit">
                                                    <button type="button" class="btn-clean" data-toggle="edit-visible-item">
                                                        <i class="fa fa-caret-down" aria-hidden="true"></i>                                                        
                                                    </button>
                                                </div>
                                                
                                                <!-- OPTION -->
                                                <div class="cms-menu__visible-item-edit-wrapper cms-module__option">
                                                    <!-- OPTION GROUP -->
                                                    <div class="cms-module__option-group">
                                                        <div class="cms-module__option-label">
                                                            <label for="cmsMenuAddItemLabel">#{msg.cms_menu_item_label}:</label>
                                                        </div>
                                                        <div class="cms-module__option-control">
                                                            <h:inputText id="cmsMenuAddItemLabel" value="#{visibleItem.itemLabel}" styleClass="form-control" />
                                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemNameInfo}</span>
                                                        </div>
                                                        <div class="cms-module__option-help">
                                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- OPTION GROUP -->
                                                    <div class="cms-module__option-group">
                                                        <div class="cms-module__option-label">
                                                            <label for="cmsMenuAddItemUrl">#{msg.cms_menu_item_url}:</label>
                                                        </div>
                                                        <div class="cms-module__option-control">
                                                            <h:inputText id="cmsMenuAddItemUrl" value="#{visibleItem.pageUrl}" styleClass="form-control" />
                                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemUrlInfo}</span>
                                                        </div>
                                                        <div class="cms-module__option-help">
                                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- OPTION GROUP -->
                                                    <div class="cms-module__option-group">
                                                        <div class="cms-module__option-label">
                                                            <label for="cmsMenuAddItemNewTab">#{msg.cms_menu_item_newTab}:</label>
                                                        </div>
                                                        <div class="cms-module__option-control">
                                                            <span class="cms-module__option-control-checkbox">
                                                                <h:selectBooleanCheckbox id="cmsMenuAddItemNewTab" />
                                                            </span>
                                                            <br />
                                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemNewTabInfo}</span>
                                                        </div>
                                                        <div class="cms-module__option-help">
                                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ui:fragment>
                                        </li>
                                    </ui:repeat>
                                </ul>
                            </div>

                            <!-- AVAILABLE ITEMS -->
                            <div class="cms-menu__editor-menu-available-items">
                                <h4>#{msg.cms_menu_availableComponents}</h4>

                                <ul id="availableItemList" class="cms-menu__available-items-list">
                                    <ui:repeat var="availableItem" value="#{cmsNavigationBean.getAvailableMenuItems(cmsNavigationBean.selectedTheme)}">
                                        <li sortPosition="item_#{availableItem.availableItemId}?0"
                                            class="cms-menu__available-item #{availableItem.hasUnpublishedCmsPage() ? 'unpublished':''} #{availableItem.hasDeletedCmsPage() ? 'deleted':''}">
                                            <!-- ITEM LEVEL -->
                                            <div class="cms-menu__available-item-level">
                                                <button type="button" class="btn-clean left" title="#{msg.cms_menu_decreaseMenuItem}"
                                                    onclick="cmsJS.sortableList.decreaseLevel(this, true);">
                                                    <i class="fa fa-arrow-circle-left" aria-hidden="true"></i>
                                                </button>
                                                <button type="button" class="btn-clean right" title="#{msg.cms_menu_increaseMenuItem}"
                                                    onclick="cmsJS.sortableList.increaseLevel(this, true);">
                                                    <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                            
                                            <!-- ITEM LABEL -->
                                            <div class="cms-menu__available-item-label">#{msg[availableItem.itemLabel]}</div>

                                            <ui:fragment rendered="#{visibleItem.absoluteLink}">
                                                <div class="cms-menu__available-item-edit">
                                                    <button type="button" class="btn-clean" data-toggle="edit-available-item">
                                                        <i class="fa fa-caret-down" aria-hidden="true"></i>                                                        
                                                    </button>
                                                </div>
                                                
                                                <!-- OPTION -->
                                                <div class="cms-menu__available-item-edit-wrapper cms-module__option">
                                                    <!-- OPTION GROUP -->
                                                    <div class="cms-module__option-group">
                                                        <div class="cms-module__option-label">
                                                            <label for="cmsMenuAddItemLabel">#{msg.cms_menu_item_label}:</label>
                                                        </div>
                                                        <div class="cms-module__option-control">
                                                            <h:inputText id="cmsMenuAddItemLabel" value="#{cmsNavigationBean.navigationItem.itemLabel}" styleClass="form-control" />
                                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemNameInfo}</span>
                                                        </div>
                                                        <div class="cms-module__option-help">
                                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- OPTION GROUP -->
                                                    <div class="cms-module__option-group">
                                                        <div class="cms-module__option-label">
                                                            <label for="cmsMenuAddItemUrl">#{msg.cms_menu_item_url}:</label>
                                                        </div>
                                                        <div class="cms-module__option-control">
                                                            <h:inputText id="cmsMenuAddItemUrl" value="#{cmsNavigationBean.navigationItem.pageUrl}" styleClass="form-control" />
                                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemUrlInfo}</span>
                                                        </div>
                                                        <div class="cms-module__option-help">
                                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- OPTION GROUP -->
                                                    <div class="cms-module__option-group">
                                                        <div class="cms-module__option-label">
                                                            <label for="cmsMenuAddItemNewTab">#{msg.cms_menu_item_newTab}:</label>
                                                        </div>
                                                        <div class="cms-module__option-control">
                                                            <span class="cms-module__option-control-checkbox">
                                                                <h:selectBooleanCheckbox id="cmsMenuAddItemNewTab" />
                                                            </span>
                                                            <br />
                                                            <span class="cms-module__option-control-helptext">#{msg.cms_addMenuItemNewTabInfo}</span>
                                                        </div>
                                                        <div class="cms-module__option-help">
                                                            <button type="button" class="btn-clean" data-toggle="helptext">
                                                                <i class="fa fa-question-circle" aria-hidden="true"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ui:fragment>
                                        </li>
                                    </ui:repeat>
                                </ul>
                            </div>                            
                        </div>
                    </h:panelGroup>
                </h:form>
            </div>

            <script type="text/javascript">
                $( document ).ready( function() {
                    $( function() {
                        $( '[data-toggle="tooltip"]' ).tooltip()
                    } )

                    // trigger tooltips on modal shown up
                    $( "#addMenuItemModal" ).on( "shown.bs.modal", function( e ) {
                        $( function() {
                            $( '[data-toggle="tooltip"]' ).tooltip()
                        } )
                    } )

                    var createMenuConfig = {
                        sortablesConfig: {
                            componentListInput: document.getElementById( "editMenuForm:itemOrderInput" ),
                            editButton: $( ".widget-edit" ),
                            availableItemList: $( "#availableItemList" ),
                            visibleItemList: $( "#visibleItemList" )
                        }
                    };
                    
                    cmsJS.sortableList.init( 20, true, createMenuConfig );
                } );
            </script>
        </h:panelGroup>
    </ui:define>

    <ui:define name="sidebar">
		<widgetComponent:widget_admin />
    	<widgetComponent:widget_cms />
    	<widgetComponent:widget_user />
	</ui:define>
</ui:composition>