<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner"
                xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components" 
                xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
                template="/resources/themes/#{navigationHelper.theme}/template.html">
	
	<ui:param name="cmsPage" value="#{cmsBean.currentPage}" />
	
    <!-- METADATA -->
    <ui:define name="metadata">
	    <f:metadata> 
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPage(cmsPage.menuTitle, false, false, true)}" />
			<f:event type="preRenderView" listener="#{navigationHelper.updateBreadcrumbs(cmsBean.currentPage)}" />            
            <f:event type="preRenderView" listener="#{searchBean.resetSearchFilter}" />
        </f:metadata>
    </ui:define>
    
    <!-- BREADCRUMBS -->
    <ui:define name="breadcrumbs">
        <ui:include src="/resources/includes/breadcrumbs.xhtml" />
    </ui:define>

    <!-- CONTENT -->
    <ui:define name="content">
        <f:view contentType="text/html" encoding="utf-8">
            <div id="templateOverviewPage" class="tpl-overviewpage">
                <h2>#{cmsPage.title}</h2>

                <ui:fragment rendered="#{cmsPage.hasContent('subtitle')}">
                    <p class="tpl-overviewpage__subtitle">#{cmsPage.getContent('subtitle')}</p>
                </ui:fragment>

                <!-- PAGE UNPUBLISHED -->
                <ui:fragment rendered="#{!cmsPage.published}">
                    <div class="alert alert-warning" role="alert">#{msg.cms_pagePreviewNotPublished}</div>
                </ui:fragment>

                <!-- OVERVIEW METADATA -->
                <div class="tpl-overviewpage__overview">
                    <!-- THUMBNAIL -->
                    <div class="tpl-overviewpage__overview-thumbnail">
                        <ui:fragment rendered="#{activeDocumentBean.recordLoaded}">
                            <img src="#{imageDelivery.representativeThumbnail}" class="img-responsive" />
                        </ui:fragment>
                        <ui:fragment rendered="#{!activeDocumentBean.recordLoaded}">
                            <img src="#{imageDelivery.staticImagesURI}access_denied.png" class="img-responsive" />
                        </ui:fragment>
                    </div>

                    <!-- METADATA -->
                    <div class="tpl-overviewpage__overview-metadata">
                        <h:form id="overviewMetadataForm" prependId="false">
                            <ui:fragment rendered="true">
                                <ui:repeat value="#{metadataBean.topMetadataElement.getMetadata(cmsPage.getContentItem('metadata').metadataFieldsAsList)}" var="metadata"
                                    varStatus="status">
                                    <ui:fragment rendered="#{metadata.values != null and !metadata.values.isEmpty()}">
                                        <dl class="dl-horizontal 'edit-metadata'">
                                            <dt>
                                                <span class="tpl-overviewpage__overview-metadata-label" data-toggle="tooltip" data-placement="top" title="#{msg[metadata.label]}">
                                                    <h:outputText value="#{msg[metadata.label]}: " escape="false" />
                                                </span>
                                            </dt>
                                            <ui:fragment rendered="#{metadata.group}">
                                                <dd>
                                                    <ui:repeat value="#{metadata.values}" var="val">
                                                        <span class="tpl-overviewpage__overview-metadata-value">
                                                            <h:outputFormat value="#{msg[val.masterValue]}" escape="false">
                                                                <f:param value="#{val.getParamLabelWithColon(0)}" />
                                                                <f:param value="#{val.getComboValueShort(0)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(1)}" />
                                                                <f:param value="#{val.getComboValueShort(1)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(2)}" />
                                                                <f:param value="#{val.getComboValueShort(2)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(3)}" />
                                                                <f:param value="#{val.getComboValueShort(3)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(4)}" />
                                                                <f:param value="#{val.getComboValueShort(4)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(5)}" />
                                                                <f:param value="#{val.getComboValueShort(5)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(6)}" />
                                                                <f:param value="#{val.getComboValueShort(6)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(7)}" />
                                                                <f:param value="#{val.getComboValueShort(7)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(8)}" />
                                                                <f:param value="#{val.getComboValueShort(8)}" />
                                                                <f:param value="#{val.getParamLabelWithColon(9)}" />
                                                                <f:param value="#{val.getComboValueShort(9)}" />
                                                            </h:outputFormat>
                                                        </span>

                                                        <div class="clearfix"></div>
                                                    </ui:repeat>
                                                </dd>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{!metadata.group}">
                                                <dd>
                                                    <ui:repeat value="#{metadata.values}" var="val">
                                                        <span class="tpl-overviewpage__overview-metadata-value">
                                                            <h:outputFormat value="#{msg[val.masterValue]}" escape="false">
                                                                <f:param value="#{val.getComboValueShort(0)}" />
                                                                <f:param value="#{val.getComboValueShort(1)}" />
                                                                <f:param value="#{val.getComboValueShort(2)}" />
                                                                <f:param value="#{val.getComboValueShort(3)}" />
                                                                <f:param value="#{val.getComboValueShort(4)}" />
                                                                <f:param value="#{val.getComboValueShort(5)}" />
                                                                <f:param value="#{val.getComboValueShort(6)}" />
                                                                <f:param value="#{val.getComboValueShort(7)}" />
                                                                <f:param value="#{val.getComboValueShort(8)}" />
                                                                <f:param value="#{val.getComboValueShort(9)}" />
                                                            </h:outputFormat>
                                                        </span>

                                                        <div class="clearfix"></div>
                                                    </ui:repeat>
                                                </dd>
                                            </ui:fragment>
                                        </dl>
                                    </ui:fragment>
                                </ui:repeat>
                            </ui:fragment>

                            <!-- PURL -->
                            <dl class="dl-horizontal">
                                <dt>
                                    <span class="tpl-overviewpage__overview-metadata-label" data-toggle="tooltip" data-placement="top" title="#{msg.purl}"
                                        data-original-title="#{msg.purl}">#{msg.purl}:</span>
                                </dt>
                                <dd>
                                    <span class="tpl-overviewpage__overview-metadata-value">

                                        <c:set var="purl" value="#{fn:replace(activeDocumentBean.viewManager.getPersistentUrl(null), '/image/', '/overview/')}" />
                                        <a href="#{purl}">
                                            <h:outputText value="#{purl}" />
                                        </a>
                                    </span>
                                </dd>
                            </dl>
                        </h:form>
                    </div>
                </div>

                <!-- LITERATURE -->
                <div class="tpl-overviewpage__literature">
                    <img id="literatureLoader" src="#{request.contextPath}/resources/images/infinity_loader.gif" />
                    <h:outputText id="literature" escape="false" />
                </div>
            </div>
            
            <script type="text/javascript">                         
                $.ajax({
                	url: "#{cmsPage.getContent('literature')}",
                	type: "GET",
                	datatype: "HTML"                                
                }).then(function(data) {
                	$('#literature').html(data);
                	$('#literatureLoader').hide();
                });
            </script>
        </f:view>
    </ui:define>

    <!-- SIDEBAR -->
	<ui:define name="sidebar">
		<ui:include src="/resources/cms/includes/cms_sidebar.xhtml" />
    </ui:define>
</ui:composition>
