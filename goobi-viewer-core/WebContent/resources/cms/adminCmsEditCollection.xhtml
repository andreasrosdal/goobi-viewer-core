<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
    template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

    <ui:define name="metadata">
        <f:metadata>
            <f:event
                type="preRenderView"
                listener="#{navigationHelper.setCurrentPageAdmin('adminCmsCollections')}" />
            <f:event
                type="preRenderView"
                listener="#{navigationHelper.addStaticLinkToBreadcrumb(msg.cms_collections,1)}" />
            <f:event
                type="preRenderView"
                listener="#{adminBean.resetCurrentLicenseAction}" />
            <f:event
                type="preRenderView"
                listener="#{cmsBean.init()}" />
        </f:metadata>
    </ui:define>

    <ui:define name="breadcrumbs">
        <ui:include src="/resources/includes/breadcrumbs.xhtml" />
    </ui:define>

    <ui:define name="content">
        <h:panelGroup
            id="cmsCollectionsAccessControl"
            rendered="#{configurationBean.cmsEnabled}">
            <div id="cmsEditCollection">
            
            <h:commandLink id="returnToCollections" action="pretty:adminCmsCollections">
                <i class="fa fa-sign-out fa-flip-horizontal"></i>
                <f:ajax render="@none" />
            </h:commandLink>
            
                <h:panelGroup rendered="#{userBean.admin}">
                    <div class="cms-collections">
                        <h2>#{cmsCollectionsBean.currentCollection.solrFieldValue}</h2>

                        <h:form
                            id="cmsEditCollectionForm"
                            prependId="false">

                            <div class="edit_collection_table">

                                <div
                                    id="editLabel"
                                    class="edit_collection_row">
                                    <div class="edit_collection_label">
                                        <label>#{msg.cms_collections_label}</label>
                                    </div>
                                    <div class="edit_language_table">
                                        <ui:repeat
                                            value="#{navigationHelper.supportedLanguages}"
                                            var="language">
                                            <div class="edit_language_column">
                                                <div id="edit_language_label">
                                                    <label>#{language}</label>
                                                </div>
                                                <div id="edit_language_value">
                                                    <h:inputTextarea value="#{cmsCollectionsBean.getCurrentLabel(language).value}">
                                                    </h:inputTextarea>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </div>

                                <div
                                    id="editDescription"
                                    class="edit_collection_row">
                                    <div class="edit_collection_label">
                                        <label>#{msg.cms_collections_description}</label>
                                    </div>
                                    <div class="edit_language_table">
                                        <ui:repeat
                                            value="#{navigationHelper.supportedLanguages}"
                                            var="language">
                                            <div class="edit_language_column">
                                                <div id="edit_language_label">
                                                    <label>#{language}</label>
                                                </div>
                                                <div id="edit_language_value">
                                                    <h:inputTextarea value="#{cmsCollectionsBean.getCurrentDescription(language).value}">
                                                    </h:inputTextarea>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </div>

                                <div
                                    id="editLink"
                                    class="edit_collection_row">
                                    <div class="edit_collection_label">
                                        <label>#{msg.cms_collections_link}</label>
                                    </div>
                                    <div class="edit_language_table">
                                        <h:inputText value="#{cmsCollectionsBean.currentCollection.collectionUrl}"></h:inputText>
                                    </div>
                                </div>

                                <div
                                    id="editImage"
                                    class="edit_collection_row">
                                    <div class="edit_collection_label">
                                        <label>#{msg.cms_collections_image}</label>
                                    </div>
                                    <div class="edit_language_table">
                                        <ui:fragment rendered="#{cmsCollectionsBean.currentCollection.hasMediaItem()}">
                                            <img src="#{cmsCollectionsBean.currentCollection.mediaItem.iconURI}"></img>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{!cmsCollectionsBean.currentCollection.hasMediaItem()}">
                                            <img
                                                src="#{imageDelivery.thumbs.getThumbnailPath(configurationBean.getDefaultBrowseIcon(collection.solrFieldValue))}">
                                            </img>
                                        </ui:fragment>

                                        <a data-toggle="modal" data-target="#selectImageModal">
                                            #{msg.cms_collections_changeImage}
                                        </a>

                                    </div>
                                </div>
                                
                                <!-- select image modal -->
                            <div
                                id="selectImageModal"
                                class="modal fade"
                                tabindex="-1"
                                role="dialog">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                        <a class="close" data-dismiss="modal" >
                                             <span aria-hidden="true">
                                                    <h:outputText
                                                        value="&amp;times;"
                                                        escape="false" />
                                              </span>
                                              <span class="sr-only">Close</span>
                                        </a>
                                            <h4 class="modal-title">#{msg.cms_collections_selectMediaItem}</h4>
                                        </div>
                                        <div class="modal-body">
                                            <h:panelGroup layout="block" id="images" styleClass="select_image_panel">
                                                <h:commandLink action="#{cmsCollectionsBean.setSelectedMediaItem(null)}">
                                                        <div class="select_image_item #{cmsCollectionsBean.isSelectedMediaItem(null) ? 'selected' : ''}">
                                                             <img
                                                        src="#{imageDelivery.thumbs.getThumbnailPath(configurationBean.getDefaultBrowseIcon(collection.solrFieldValue))}"> </img>

                                                            <label>#{msg.cms_collections_noImage}</label>
                                                            <f:ajax render="images"></f:ajax>
                                                         </div>
                                                    </h:commandLink>
                                                <ui:repeat var="mediaItem" value="#{cmsMediaBean.mediaItems}">
                                                    <h:commandLink action="#{cmsCollectionsBean.setSelectedMediaItem(mediaItem)}">
                                                        <div class="select_image_item #{cmsCollectionsBean.isSelectedMediaItem(mediaItem) ? 'selected' : ''}">
                                                            <img src="#{imageDelivery.thumbs.getSquareThumbnailUrl(mediaItem, 150)}"></img>
                                                            <label>#{mediaItem.name}</label>
                                                            <f:ajax render="images"></f:ajax>
                                                         </div>
                                                    </h:commandLink>
                                                </ui:repeat>
                                            </h:panelGroup>
                                        </div>
                                        <div class="modal-footer">
                                           
                                            <a class="btn" data-dismiss="modal" >
                                             #{msg.cancel}
                                            </a>
                                            <h:commandLink
                                                action="#{cmsCollectionsBean.currentCollection.setMediaItem(cmsCollectionsBean.selectedMediaItem)}"
                                                value="#{msg.cms_selectMediaItem_agree}"
                                                styleClass="btn">
                                                <f:passThroughAttribute
                                                    name="data-dismiss"
                                                    value="modal" />
                                                <f:ajax render="@form" />
                                            </h:commandLink>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            </div>
                            <div class="cms-edit-collection__save">
                                <h:commandButton
                                    styleClass="btn"
                                    id="saveCollection"
                                    value="#{msg.save}"
                                    action="#{cmsCollectionsBean.saveCurrentCollection()}">
                                    <!--                                         <f:ajax render="@none" execute="@form"></f:ajax>  -->
                                </h:commandButton>
                            </div>
                        </h:form>
                    </div>
                </h:panelGroup>
            </div>
        </h:panelGroup>
    </ui:define>

    <ui:define name="sidebar">
        <widgetComponent:widget_admin />
        <widgetComponent:widget_cms />
        <widgetComponent:widget_user />
    </ui:define>
</ui:composition>
