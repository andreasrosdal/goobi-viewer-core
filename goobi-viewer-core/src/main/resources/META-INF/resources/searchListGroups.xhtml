<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
    template="/resources/themes/#{navigationHelper.theme}/template.html"
    xmlns:searchFacetsComponent="http://xmlns.jcp.org/jsf/composite/components/widgets/searchFacets">
    

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPage('searchlist', false, true)}" />
            <f:event type="preRenderView" listener="#{searchBean.setActiveSearchType(1)}" />
            <f:event type="preRenderView" listener="#{searchBean.resetCurrentHitIndex}" />
        </f:metadata>
    </ui:define>

    <ui:define name="breadcrumbs">
        <viewerComponent:breadcrumbs showIcon="false" showStartText="true" />
    </ui:define>

    <ui:define name="content">
        <f:view contentType="text/html" encoding="utf-8">
            <div id="searchList">
                <!-- SEARCH LIST -->
                <div class="search-list">
                
                    <!-- ENTITY SELECTION -->
                    <ui:repeat value="#{configurationBean.searchResultGroupNames}" var="groupName">
                        <h:outputLink
                            value="#{navigationHelper.getSearchUrl(searchBean.activeSearchType)}/#{groupName}/-/1/-/-/">
                            <ui:fragment rendered="#{groupName == searchBean.activeResultGroupName}">
                                <div><strong>#{msg[groupName]}</strong></div>
                            </ui:fragment>
                            <ui:fragment rendered="#{groupName != searchBean.activeResultGroupName}">
                                <div>#{msg[groupName]}</div>
                            </ui:fragment>
                            <f:passThroughAttribute name="aria-label" value="#{msg[groupName]}" />
                        </h:outputLink>
                    </ui:repeat>
                    
                    <h:form id="searchAdvancedForm" prependId="false" styleClass="search-advanced__form">
                        <h2 class="search-advanced__entry-area-title">#{msg.search__search_query}</h2>
                        <div class="search-advanced__entry-area">
                            <!-- AJAX LOADER -->
                            <div class="search-advanced__loader"></div>
                            <!-- SEARCH ADVANCED INPUT GROUP -->
                        
                                            
                            <c:forEach var="queryItem" items="#{searchBean.advancedSearchQueryGroup.queryItems}" varStatus="status">
                                <div id="searchAdvancedInputGroup-0-#{status.count}">
                                 
                                    <h3>#{msg[queryItem.field]}</h3>
                                        
                                    <!-- INPUT FIELD -->
                                    <h:panelGroup layout="block" id="advsearch_value_group_0-#{status.count}">
                                        <div class="search-advanced__input-group-field">
                                            <ui:fragment rendered="#{queryItem.displaySelectItems}">
                                                 <!-- BADGES -->
                                                <ui:fragment rendered="#{queryItem.selectType == 'badges'}">
                                                <c:forEach var="item" items="#{queryItem.getSelectItems(navigationHelper.localeString)}">
                                                    <button type="button" class="btn btn--link"
                                                        jsf:action="#{queryItem.toggleValue(item.one)}" title="#{msg[item.two]}">
                                                        <ui:fragment rendered="#{queryItem.isValueSet(item.one)}">
                                                             <div class="badge badge-warning"><strong>#{item.two}</strong></div>
                                                        </ui:fragment>
                                                        <ui:fragment rendered="#{!queryItem.isValueSet(item.one)}">
                                                             <div class="badge badge-light">#{item.two}</div>
                                                        </ui:fragment>
                                                        <f:ajax render="@form" />
                                                    </button>
                                                </c:forEach>
                                                </ui:fragment> 
                                                
                                                 <!-- CHECKBOXES -->
                                                <ui:fragment rendered="#{queryItem.selectType == 'checkboxes'}">
                                                <ui:repeat var="selectable" value="#{queryItem.getSelectableItems(navigationHelper.localeString)}">
                                                    <li>
														<label> 
															<h:selectBooleanCheckbox type="checkbox" value="#{selectable.selected}">
																<f:ajax event="valueChange" render="@this"></f:ajax>
															</h:selectBooleanCheckbox> #{selectable.label}
														</label>
													</li>
                                                    
                                                    
                                                </ui:repeat>
                                                </ui:fragment> 
                                                
                                                <!-- DROP-DOWN-CHECKBOXES -->
                                                <ui:fragment rendered="#{queryItem.selectType == 'dropdowncheckboxes'}">
														<div class="cms-module__option-dropdown">
															<div class="cms-module__option-dropdown-trigger"
																data-toggle="option-dropdown">#{msg.select}</div>
															<ul>
																<ui:repeat var="selectable"
																	value="#{queryItem.getSelectableItems(navigationHelper.localeString)}">
																	<li>
																		<label> 
																			<h:selectBooleanCheckbox type="checkbox" value="#{selectable.selected}">
																				<f:ajax event="valueChange" render="@this"></f:ajax>
																			</h:selectBooleanCheckbox> #{selectable.label}
																		</label>
																	</li>
																</ui:repeat>
															</ul>
														</div>
                                                </ui:fragment>
                                                
                                                 <!-- DROP-DOWN -->
                                                <ui:fragment rendered="#{queryItem.selectType == 'dropdown'}">
                                                    <div class="custom-control custom-control--select multiple">
                                                       <h:selectManyMenu id="advsearch_value_select_0-#{status.count}" styleClass="value-text"
                                                           value="#{queryItem.values}">
                                                           <c:forEach var="item" items="#{queryItem.getSelectItems(navigationHelper.localeString)}">
                                                               <f:selectItem itemValue="#{item.one}" itemLabel="#{item.two}" />
                                                           </c:forEach>
                                                           <f:passThroughAttribute name="aria-label" value="#{msg.cms_collections_err_noselection}" />
                                                       </h:selectManyMenu>
                                                    </div>
                                                </ui:fragment>
                                                
                                            </ui:fragment>
                                            <ui:fragment rendered="#{!queryItem.displaySelectItems}">
                                                        <ui:fragment rendered="#{queryItem.range}">
                                                            <div class="search-advanced__year-span-from d-none d-lg-inline-block">#{msg.searchAdvanced_range_value1}</div>
                                                            <h:inputText id="advsearchValue1Text_0-#{status.count}"
                                                                styleClass="form-control value-text -with-right-border search-advanced__input-value" value="#{queryItem.value}">
                                                                <f:passThroughAttribute name="placeholder" value="#{msg.year}" />
                                                            </h:inputText>
                                                            <i class="fa fa-arrows-h search-advanced__between-arrow d-lg-none" aria-hidden="true"></i>
                                                            <div class="search-advanced__year-span-to d-none d-lg-inline-block">#{msg.searchAdvanced_range_value2}</div>
                                                            <h:inputText id="advsearchValue2Text_0-#{status.count}"
                                                                styleClass="form-control value-text -with-right-border search-advanced__input-value" value="#{queryItem.value2}">
                                                                <f:passThroughAttribute name="placeholder" value="#{msg.year}" />
                                                            </h:inputText>
                                                        </ui:fragment>
                                                        <ui:fragment rendered="#{!queryItem.range}">
                                                            <h:inputText id="advsearchValueText_0-#{status.count}"
                                                                styleClass="form-control value-text search-advanced__input-value" value="#{queryItem.value}">
                                                                <f:passThroughAttribute name="placeholder" value="#{msg.searchFieldDemoText}" />
                                                                <f:passThroughAttribute name="aria-label" value="#{msg.searchFieldDemoText}" />
                                                            </h:inputText>
                                                        </ui:fragment>
                                            </ui:fragment>
                                        </div>
                                    </h:panelGroup>

                                </div>
                            </c:forEach>
                         
                        </div>

                <!-- SEARCH ADVANCED ACTION -->
                <div class="search-advanced__action">
                    <div class="search-advanced__action-submit-button-wrapper small-button-loader__wrapper">
                
                        <h:commandButton styleClass="btn btn--full search-advanced__action-search-button"
                            value="#{msg.search}" action="#{searchBean.searchAdvanced}">
                            <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="1" />
                            <f:passThroughAttribute name="data-target" value="buttonLoaderClickEvent" />
                        </h:commandButton>
                        
                        <div class="small-button-loader__icon -top-right" data-target="buttonLoader"></div>
                    
                    </div>
                    
                </div>

                <script>
                
                window.addEventListener("unload", (event) => {
                        $('[data-target="buttonLoader"]').hide();
                        $('[data-target="buttonLoaderClickEvent').css('opacity', '1');
                  });
                
                    $('[data-target="buttonLoaderClickEvent"]').on('click', function(e) {
                        $('[data-target="buttonLoader"]').fadeIn('fast');
                        $('[data-target="buttonLoaderClickEvent').css('opacity', '0.5');
                    });
                
                </script>

            </h:form>
            
            <div class="search-advanced__entry-area">
            	<searchFacetsComponent:chronologyFacet/>
            	<searchFacetsComponent:geoFacetting/>
           	 	<searchFacetsComponent:searchFacets/>
            </div>
                    
                    <!-- GROUPS -->
                    <ui:fragment rendered="#{searchBean.activeResultGroupName eq 'group'}">
                    </ui:fragment>
                    
                    <!-- EVENTS -->
                    <ui:fragment rendered="#{searchBean.activeResultGroupName eq 'event'}">
                    </ui:fragment>
                    
                    <!-- AWARDS -->
                    <ui:fragment rendered="#{searchBean.activeResultGroupName eq 'award'}">
                    </ui:fragment>

                    <!-- SEARCH LIST -->
                    <div class="search-list">
                        <ui:include src="/resources/includes/search/searchHitList.xhtml">
                            <ui:param name="searchParam" value="#{cmsPage.getContentItem('search').functionality}"/>
                        </ui:include>
                    </div>
            	</div>
        	</div>
        </f:view>
    </ui:define>

    <ui:define name="sidebar">
        <!-- OPTIONAL FACETS HEADING -->
        <div class="search-list__facets-heading">
            <h2>#{msg.searchListOptionalHeading}</h2>
        </div>
        <widgetComponent:widget_searchFacets />
    </ui:define>

</ui:composition>
