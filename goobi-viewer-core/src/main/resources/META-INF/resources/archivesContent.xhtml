<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets" 
    xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
    template="/resources/themes/#{navigationHelper.theme}/templateArchives.html">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView" listener="#{navigationHelper.setCurrentPage('archives', false, true)}" />
		</f:metadata>
	</ui:define>
    
    <ui:define name="breadcrumbs">
        <ui:include src="/resources/includes/breadcrumbs.xhtml" />
    </ui:define>

    <ui:define name="content">
    
        <f:view contentType="text/html" encoding="utf-8">
        	<div class="tec-archives__wrapper">

        		<!-- LEFT SIDE -->
				<div class="tec-archives__left-side">
				
				                
                    <div class="tec-archives__graphic-tree">
                    
                    <h:form id="tocForm" prependId="false">
				
				        <div class="search-standard__input">
                            <div class="admin__search-input-wrapper">
                                <h:inputText id="tectonicsSearchField" inputStyleClass="-no-outline -active-border"
                                    value="#{tectonicsBean.searchString}" immediate="true">
                                    <f:passThroughAttribute name="placeholder" value="#{msg.searchFieldDemoText}" />
                                </h:inputText>
                                <div class="admin__search-clear">x</div>
                                <h:commandButton style="visibility:hidden" value="#{msg.search}" action="#{tectonicsBean.searchAction}">
<!--                                   <f:ajax render="tocForm" /> -->
                                </h:commandButton>
                            </div>
                        </div>

                        
                        <!-- TOC TREEVIEW -->
                        <h:panelGroup id="tocTreeGroup">
                            <c:set var="indent" value="#{configurationBean.tocIndentation}" scope="request" />
                            <!-- EXPANDABLE TREEVIEW -->
                            <h:panelGroup>
                                <!-- EXPAND ALL -->
                                <div class="toc__list-expandable-all clearfix">
                                    <ul>
                                        <li>
                                            <h:commandLink action="#{tectonicsBean.tectonicsTree.collapseAll(true)}" title="#{msg.allClose}">
                                                <i class="fa fa-minus-square-o" aria-hidden="true"></i>
                                                <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                                <f:passThroughAttribute name="data-placement" value="top" />
                                                <f:passThroughAttribute name="aria-label" value="#{msg.allClose}" />
                                                <f:ajax render="tocForm" />
                                            </h:commandLink>
                                        </li>
                                        <li>
                                            <h:commandLink action="#{tectonicsBean.tectonicsTree.expandAll}" title="#{msg.allOpen}">
                                                <i class="fa fa-plus-square-o" aria-hidden="true"></i>
                                                <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                                <f:passThroughAttribute name="data-placement" value="top" />
                                                <f:passThroughAttribute name="aria-label" value="#{msg.allOpen}" />
                                                <f:ajax render="tocForm" />
                                            </h:commandLink>
                                        </li>
                                    </ul>
                                </div>

                                <nav class="toc__list-expandable clearfix">
                                    <ul>
                                        <c:set var="visibleTree" value="#{tectonicsBean.tectonicsTree.treeView.stream().filter(e -> e.visible).toList()}" scope="request" />
										<c:forEach var="entry" items="#{visibleTree}" varStatus="status">
                                                <li class="toc__list-expandable-elem #{entry.hasChild == true ? 'parent' : 'child' }"
                                                    data-id="id_#{entry.id}" style="padding-left: #{entry.hierarchy * indent}px">
                                                    <div class="row">
                                                        <div class="col-12 col-sm-1">
                                                            <h:panelGroup rendered="#{entry.hasChild}">
                                                                <!-- EXPAND -->
                                                                <div class="toc__list-expandable-expand">
                                                                    <h:commandLink action="#{tectonicsBean.setChildrenVisible(entry)}"
                                                                        rendered="#{!entry.expanded}">
                                                                        <i class="fa fa-plus-square-o" aria-hidden="true"></i>
                                                                        <f:passThroughAttribute name="aria-label" value="#{msg.allOpen}" />
                                                                        <f:ajax render="@form" />
                                                                    </h:commandLink>
                                                                    <h:commandLink action="#{tectonicsBean.setChildrenInvisible(entry)}"
                                                                        rendered="#{entry.expanded}">
                                                                        <i class="fa fa-minus-square-o" aria-hidden="true"></i>
                                                                        <f:passThroughAttribute name="aria-label" value="#{msg.all}" />
                                                                        <f:ajax render="@form" />
                                                                    </h:commandLink>
                                                                </div>
                                                            </h:panelGroup>
                                                        </div>
                                                        <div class="col-12 col-sm-8 col-md-9">
                                                            <!-- TITLE -->
                                                            <div class="toc__list-expandable-title">
                                                                <!-- TODO icon instead of descriptionLevel -->
                                                                #{entry.nodeType}
                                                                <!-- TODO highlight selected entry via CSS -->
                                                                <c:choose>
                                                                    <c:when test="#{entry.id == tectonicsBean.tectonicsTree.selectedEntry.id}">
                                                                        <h:outputLink value="#{navigationHelper.applicationUrl}tectonics/#{entry.id}/">
                                                                            <strong>#{entry.label}</strong>
                                                                            <f:ajax render="hiearchyGroup metadataGroup" />
                                                                        </h:outputLink>
                                                                    </c:when>
                                                                    <c:otherwise>
                                                                        <h:outputLink value="#{navigationHelper.applicationUrl}archives/#{entry.id}/">
                                                                            <h:outputText style="#{entry.selected ? 'color:#5BA2E5' : 'color:black'}"
                                                                                value="#{entry.label}">
                                                                            </h:outputText>
                                                                            <f:ajax render="hiearchyGroup metadataGroup" />
                                                                        </h:outputLink>
                                                                    </c:otherwise>
                                                                </c:choose>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
										</c:forEach>
                                    </ul>
                                </nav>
                            </h:panelGroup>

                        </h:panelGroup>
                    </h:form>
					</div>
				</div>
				
				<!-- RIGHT SIDE -->
				<div class="tec-archives__right-side">
					<div class="tec-archives__text-tree">
					
					    <!-- HIERARCHY OF THE CURRENT NODE -->
                        <h:panelGroup id="hiearchyGroup">
                            <ui:repeat var="entry"
                                value="#{tectonicsBean.getTectonicsHierarchyForIdentifier(tectonicsBean.tectonicsTree.selectedEntry.id)}">
                                <!-- TODO proper level tag -->
                                <!-- TODO bold via CSS -->
                                <h:outputText rendered="#{entry.descriptionLevel != null}" value="#{msg[entry.descriptionLevel]}:" /> <strong>#{entry.label}</strong>
                                <br /><br />
                            </ui:repeat>
                        </h:panelGroup>
					</div>
					
					<div class="tec-archives__object-info">

                        <h:panelGroup id="metadataGroup">
                        
                            <!-- METADATA -->
                            <!-- Replacing these with c:forEach will result in get*List() being called for each iteration -->
                            
                            <!-- TODO bold via CSS -->
                            
                            <!-- Identity statement metadata -->
                            <c:if test="#{not empty tectonicsBean.tectonicsTree.selectedEntry.identityStatementAreaList}">
                                <label>#{msg.plugin_administration_archive_area_identity}</label>
                                <ui:repeat var="field" value="#{tectonicsBean.tectonicsTree.selectedEntry.identityStatementAreaList}">
                                    <h:outputText rendered="#{field.filled and field.visible}">
                                        <br /><strong>#{field.name}:</strong> #{field.value}
                                    </h:outputText>
                                </ui:repeat>
                            </c:if>
                            <!-- Context metadata -->
                            <c:if test="#{not empty tectonicsBean.tectonicsTree.selectedEntry.contextAreaList}">
                                <label>#{msg.plugin_administration_archive_area_context}</label>
                                <ui:repeat var="field" value="#{tectonicsBean.tectonicsTree.selectedEntry.contextAreaList}">
                                    <h:outputText rendered="#{field.filled and field.visible}">
                                        <br /><strong>#{field.name}:</strong> #{field.value}
                                    </h:outputText>
                                </ui:repeat>
                            </c:if>
                            <!-- Content and structure metadata -->
                            <c:if test="#{not empty tectonicsBean.tectonicsTree.selectedEntry.contentAndStructureAreaAreaList}">
                                <label>#{msg.plugin_administration_archive_area_content}</label>
                                <ui:repeat var="field" value="#{tectonicsBean.tectonicsTree.selectedEntry.contentAndStructureAreaAreaList}">
                                    <h:outputText rendered="#{field.filled and field.visible}">
                                        <br /><strong>#{field.name}:</strong> #{field.value}
                                    </h:outputText>
                                </ui:repeat>
                            </c:if>
                            <!-- Access and terms of usage metadata -->
                            <c:if test="#{not empty tectonicsBean.tectonicsTree.selectedEntry.accessAndUseAreaList}">
                                <label>#{msg.plugin_administration_archive_area_access}</label>
                                <ui:repeat var="field" value="#{tectonicsBean.tectonicsTree.selectedEntry.accessAndUseAreaList}">
                                    <h:outputText rendered="#{field.filled and field.visible}">
                                        <br /><strong>#{field.name}:</strong> #{field.value}
                                    </h:outputText>
                                </ui:repeat>
                            </c:if>
                            <!-- Related matarials metadata -->
                            <c:if test="#{not empty tectonicsBean.tectonicsTree.selectedEntry.alliedMaterialsAreaList}">
                                <label>#{msg.plugin_administration_archive_area_materials}</label>
                                <ui:repeat var="field" value="#{tectonicsBean.tectonicsTree.selectedEntry.alliedMaterialsAreaList}">
                                    <h:outputText rendered="#{field.filled and field.visible}">
                                        <br /><strong>#{field.name}:</strong> #{field.value}
                                    </h:outputText>
                                </ui:repeat>
                            </c:if>
                            <!-- Notes metadata -->
                            <c:if test="#{not empty tectonicsBean.tectonicsTree.selectedEntry.notesAreaList}">
                                <label>#{msg.plugin_administration_archive_area_notes}</label>
                                <ui:repeat var="field" value="#{tectonicsBean.tectonicsTree.selectedEntry.notesAreaList}">
                                    <h:outputText rendered="#{field.filled and field.visible}">
                                        <br /><strong>#{field.name}:</strong> #{field.value}
                                    </h:outputText>
                                </ui:repeat>
                            </c:if>
                            <!-- Description control metadata -->
                            <c:if test="#{not empty tectonicsBean.tectonicsTree.selectedEntry.descriptionControlAreaList}}">
                                <label>#{msg.plugin_administration_archive_area_descriptionControl}</label>
                                <ui:repeat var="field" value="#{tectonicsBean.tectonicsTree.selectedEntry.descriptionControlAreaList}">
                                    <h:outputText rendered="#{field.filled and field.visible}">
                                        <br /><strong>#{field.name}:</strong> #{field.value}
                                    </h:outputText>
                                </ui:repeat>
                            </c:if>
                        
                            <!-- ASSOCIATED RECORD -->
                            <h:outputLink
                                rendered="#{tectonicsBean.tectonicsTree.selectedEntry != null and tectonicsBean.tectonicsTree.selectedEntry.associatedRecordPi != ''}" target="_blank"
                                value="#{navigationHelper.objectUrl}/#{tectonicsBean.tectonicsTree.selectedEntry.associatedRecordPi}/1/">
                                    <!-- TODO less trivial image display -->
                                    <img src="#{imageDelivery.thumbs.getThumbnailUrl(tectonicsBean.tectonicsTree.selectedEntry.associatedRecordPi)}" />
                                    <!-- TODO view selection, representative page -->
                            </h:outputLink>
                        
                        </h:panelGroup>
                        
					</div>

				</div>

			</div>
        </f:view>
    </ui:define>

    <!-- SIDEBAR -->
    <ui:define name="sidebar">
        <adminWidget:widget_admin />
        <adminWidget:widget_cms />
    </ui:define>
</ui:composition>
