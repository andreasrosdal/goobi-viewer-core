<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
            	xmlns:h="http://xmlns.jcp.org/jsf/html"
            	xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/resources/themes/#{navigationHelper.theme}/template.html"
                xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components" 
                xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets">

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPageTimeMatrix}" />
            <f:event type="preRenderView" listener="#{searchBean.resetSearchFilter}" />
            <f:event type="preRenderView" listener="#{breadcrumbBean.addStaticLinkToBreadcrumb(msg.timematrix,1)}" />
        </f:metadata>
    </ui:define>

    <ui:define name="content">
		<f:view contentType="text/html" encoding="utf-8">
            <div id="timeMatrix" class="timematrix">				
				<h2>#{msg.timematrix}</h2>

                <p>#{msg.timematrixDescriptionText}</p>

				<div class="timematrix__subarea">
	                <h3 class="timematrix__selection-header">#{msg.timematrixSelectRange}</h3>
	               	<!-- LOADER -->
					<span class="timematrix__loader">
						<img src="#{request.contextPath}/resources/images/infinity_loader.gif" class="img-responsive" alt="Timematrix Loader" />
					</span> 
				</div>

				<div class="timematrix__selection">
					<form id="locateTimematrix" method="POST">
						<input type="hidden" id="timematrixSelectionRangeInput1" value="#{configurationBean.timeMatrixStartYear}" />
						<input type="hidden" id="timematrixSelectionRangeInput2" value="#{configurationBean.timeMatrixEndYear}" />
						<div id="slider-range" onmouseup="mouseUp()"></div>
						<button type="submit" id="setTimematrix" class="btn btn--full setTimematrix">#{msg.timematrixCalculate}</button>
					</form>
					<div class="timematrix__hitsForm">
						<label>#{msg.hits}:</label> 
						<input type="number" id="hitsPerPage" class="hitsPerPage" name="hitsPerPage" value="#{configurationBean.timeMatrixHits}" placeholder="hits per page" />
						<button type="submit" class="setTimematrix">#{msg.timematrixCalculate}</button>
					</div>
				</div>
				
				<div class="clearfix"></div>

				<div id="timematrixCanvas"></div>
				
				<div class="clearfix"></div>
				
				<timematrix></timematrix>
				
            	</div>

			<script>
				<!-- Loads results when the page is reloaded -->
				$("document").ready(function() {
				    setTimeout(function() {
				        $(".setTimematrix").trigger('click');
				    },10);
				});
				
				<!-- Reloads the results after the slider is released -->
				function mouseUp() {
					document.getElementById("setTimematrix").click();
				}
				
				<!-- Reloads the results after leaving the input field -->
				document.getElementById("hitsPerPage").onfocusout = function() {myFunction()};
				
				function myFunction() {
					document.getElementById("setTimematrix").click();
					
				}
				
            	<!-- Reloads the results after pressing the input field with Enter -->
				var input = document.getElementById("hitsPerPage");
				input.addEventListener("keyup", function(event) {
				  if (event.keyCode === 13) {
				   event.preventDefault();
				   document.getElementById("setTimematrix").click();
				  }
				});	 
			</script>

           	<script>
           		var $startHere= $("#timematrixSelectionRangeInput1");
               	var $endHere= $("#timematrixSelectionRangeInput2");
               	var $count= $(".hitsPerPage");
               	
           		riot.mount('timematrix', {
              		msg: {
              			timematrixCalculate: "#{msg.timematrixCalculate}",
          	        	closeWindow: "#{msg.timematrixCloseWindow}",
          	        	goToWork: "#{msg.timematrixGoToWork}"
              		},
                   	startInput: "#timematrixSelectionRangeInput1",
                   	endInput: "#timematrixSelectionRangeInput2",
                   	contextPath: "#{request.contextPath}/",
                   	count: $( ".hitsPerPage" ),
                   	button: ".setTimematrix",
                   	loading: $('.timematrix__loader'),
                   	});
           	</script>
            
            <script type="text/javascript">
	            $(document).ready(function() {
	              	var timematrixConfig = {
		                contextPath: "#{request.contextPath}/",
		                rangeInput1: $( "#timematrixSelectionRangeInput1" ),
		                startDate: $( "#timematrixSelectionRangeInput1" ).val(),
		                rangeInput2: $( "#timematrixSelectionRangeInput2" ),
			            endDate: $( "#timematrixSelectionRangeInput2" ).val(),
			            count: $( ".hitsPerPage" ),
			            $tmCanvas: $( "#timematrixCanvas" ),
			            $tmCanvasPos: $( "#timematrixCanvas" ).position(),
		                lang: {
		                	closeWindow: "#{msg.timematrixCloseWindow}",
		                	goToWork: "#{msg.timematrixGoToWork}"	                  
		                }              	      
	              	};
	              	
	                viewerJS.timematrix.init( timematrixConfig );            	
	            });
            </script>
			   
		</f:view>
	</ui:define>
    
	<ui:define name="sidebar">
		<widgetComponent:widget_browsing />
        
        <c:forEach var="module" items="#{configurationBean.modules}">
            <c:forEach var="contribution" items="#{module.sidebarContributions}">
                <ui:include src="/#{contribution}" />
            </c:forEach>
        </c:forEach>
	</ui:define>

	<ui:define name="rssFeed">
		<ui:include src="/resources/includes/rssFeed.xhtml" />
	</ui:define>
	
	<ui:define name="breadcrumbs">
		<ui:include src="/resources/includes/breadcrumbs.xhtml" />
	</ui:define>
</ui:composition>
