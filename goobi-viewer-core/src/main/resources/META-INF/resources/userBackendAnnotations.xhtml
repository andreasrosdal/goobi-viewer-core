<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:composite="http://xmlns.jcp.org/jsf/composite"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components" 
	xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
	template="/resources/themes/#{navigationHelper.theme}/template.html">

	<composite:interface></composite:interface>

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPage('myannotations', false, true)}" />
            <f:event type="preRenderView" listener="#{navigationHelper.addStaticLinkToBreadcrumb(msg.annotations,1)}" />
        </f:metadata>
    </ui:define>

    <ui:define name="breadcrumbs">
        <ui:include src="/resources/includes/breadcrumbs.xhtml" />
    </ui:define>

    <ui:define name="content">
        <div id="myActivity" class="page-wrapp">
    		<h:panelGroup rendered="#{userBean.loggedIn}">
                <h2>#{msg.annotations}</h2>
                
                
                <!-- USER ACTIVITY -->
                <div class="user-activity">
                    <h:form id="userMyLastActivityForm" prependId="false">
                        <table class="table table-striped table-bordered user-activity__table admin-table">
                            <thead>
                                <tr>
                                    <th>     
                                        #{msg.date}
                                    </th>
                                    <th>
                                        #{msg.work}
                                    </th>
                                    <th>
                                        #{msg.campaign}
                                    </th>
                                    <th>
                                        #{msg.role}
                                        <i class="fa fa-info-circle" aria-hidden="true"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <ui:repeat var="annotation" value="#{userBean.annotations}">
                                    <tr>
                                        <td>
                                        <!-- TODO dateCreated if creator, dateModified if reviewer? -->
                                            <h:outputText value="#{annotation.dateModified}">
                                                <f:converter converterId="localDateTimeConverter" />
                                                <f:attribute name="pattern" value="dd.MM.YYYY - HH:mm" />
                                            </h:outputText>
                                        </td>
                                        <td>
                                            <h:outputLink
                                                value="#{navigationHelper.objectUrl}/#{annotation.targetPI}/#{annotation.targetPageOrder}" styleClass="link">
                                                <h:outputText value="#{annotation.targetPI} (#{annotation.targetPageOrder})" />
                                            </h:outputLink>
                                        </td>
                                        <td>
                                            <h:outputText value="#{annotation.generatorId}" />
                                        </td>                                  
                                        <td>
                                            <ui:fragment rendered="#{annotation.creatorId == userBean.user.id}">
                                                <h:outputText value="#{msg.creator}" />
                                            </ui:fragment>
                                            <ui:fragment rendered="#{annotation.reviewerId == userBean.user.id}">
                                                <h:outputText value="#{msg.creator}" />
                                            </ui:fragment>
                                        </td>
                                    </tr>
                                </ui:repeat>
                            </tbody>
                        </table>
                    </h:form>
                </div>
			</h:panelGroup>
        </div>

		<script type="text/javascript">			
        	$( document ).ready( function() {        		
        		$( '.user-activity__table .fa' ).popover({
        			html: true,
        			content: function() {
        				var string = "";
        				
        				if ( #{transcriptionBean.crowdsourcingEditFullText} ) {
        					string += "#{msgcs.crowdsourcing_myActivityTooltip_ocr}";
        				}
        				
        				if ( #{transcriptionBean.crowdsourcingEditUGC} ) {
        					string += "#{msgcs.crowdsourcing_myActivityTooltip_ugc}";
        				}
        				
        				return string;
        			},
        			placement: 'bottom'
        		});
        	} );
        </script>
	</ui:define>

	<ui:define name="sidebar">
		<h:panelGroup rendered="#{browseBean.browsingMenuEnabled}">
			<widgetComponent:widget_browsing />
		</h:panelGroup>
		
        	<h:panelGroup rendered="#{userBean.loggedIn and transcriptionBean.crowdsourcingEnabled}">
        		<widgetComponent:widget_crowdsourcing />
        	</h:panelGroup>
	</ui:define>

</ui:composition>
