<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:jsf="http://xmlns.jcp.org/jsf" 
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner" 
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets">

    <!-- VIEW TEXT -->
    <div id="fulltext-box" class="view-fulltext__box">
                
        <ui:fragment rendered="#{activeDocumentBean.viewManager.getFulltextMimeType(navigationHelper.localeString) == 'text/plain'}">        
	        <pre>
	        	<!-- Single page mode -->
	        	<ui:fragment rendered="#{!activeDocumentBean.viewManager.doublePageMode}">
	            	<h:outputText rendered="#{activeDocumentBean.viewManager.currentPage.fullText != null}"
	                	value="#{activeDocumentBean.viewManager.currentPage.fullText}" escape="false" />
	            	<h:outputText value="#{msg.noFulltextAvailable}" rendered="#{activeDocumentBean.viewManager.currentPage.fullText == null}" />
	            </ui:fragment>
	            <!-- Double page mode -->
	        	<ui:fragment rendered="#{activeDocumentBean.viewManager.doublePageMode}">
	        		<!-- Left page text -->
	        		<ui:fragment rendered="#{activeDocumentBean.viewManager.currentLeftPage.present}">
	            		<h:outputText rendered="#{activeDocumentBean.viewManager.currentLeftPage.get().fullText != null}"
	                		value="#{activeDocumentBean.viewManager.currentLeftPage.get().fullText}" escape="false" />
	            		<h:outputText value="#{msg.noFulltextAvailable}" rendered="#{activeDocumentBean.viewManager.currentLeftPage.get().fullText == null}" />
	            	</ui:fragment>
	            	<!-- Separator -->
	            	<ui:fragment rendered="#{activeDocumentBean.viewManager.currentLeftPage.present and activeDocumentBean.viewManager.currentRightPage.present}">
	            		<hr />
	            	</ui:fragment>
	            	<!-- Right page text -->
	            	<ui:fragment rendered="#{activeDocumentBean.viewManager.currentRightPage.present}">
	            		<h:outputText rendered="#{activeDocumentBean.viewManager.currentRightPage.get().fullText != null}"
	                		value="#{activeDocumentBean.viewManager.currentRightPage.get().fullText}" escape="false" />
	            		<h:outputText value="#{msg.noFulltextAvailable}" rendered="#{activeDocumentBean.viewManager.currentRightPage.get().fullText == null}" />
	            	</ui:fragment>
	            </ui:fragment>
	        </pre>
        </ui:fragment>
        
        <ui:fragment rendered="#{activeDocumentBean.viewManager.getFulltextMimeType(navigationHelper.localeString) != 'text/plain'}">        
	        <div class="view-fulltext__content">
	        
	            <!-- TEI files -->
                <ui:fragment rendered="#{activeDocumentBean.viewManager.fulltextFromTEI}"> 
                    <h:outputText escape="false" value="#{textBean.getTeiText(activeDocumentBean.viewManager.topStructElement, activeDocumentBean.selectedRecordLanguage)}" /> 
                </ui:fragment>
	        
	            <!-- Non-TEI -->
	            <ui:fragment rendered="#{!activeDocumentBean.viewManager.fulltextFromTEI}"> 
                    <!-- Single page mode -->
                    <ui:fragment rendered="#{!activeDocumentBean.viewManager.doublePageMode}">
                        <h:outputText rendered="#{activeDocumentBean.viewManager.currentPage.fullText != null}"
                            value="#{activeDocumentBean.viewManager.currentPage.fullText}" escape="false" />
                        <h:outputText value="#{msg.noFulltextAvailable}" rendered="#{activeDocumentBean.viewManager.currentPage.fullText == null}" />
                    </ui:fragment>
                    <!-- Double page mode -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.doublePageMode}">
                        <!-- Left page text -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.currentLeftPage.present}">
                            <h:outputText rendered="#{activeDocumentBean.viewManager.currentLeftPage.get().fullText != null}"
                                value="#{activeDocumentBean.viewManager.currentLeftPage.get().fullText}" escape="false" />
                            <h:outputText value="#{msg.noFulltextAvailable}" rendered="#{activeDocumentBean.viewManager.currentLeftPage.get().fullText == null}" />
                        </ui:fragment>
                        <!-- Separator -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.currentLeftPage.present and activeDocumentBean.viewManager.currentRightPage.present}">
                            <hr />
                        </ui:fragment>
                        <!-- Right page text -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.currentRightPage.present}">
                            <h:outputText rendered="#{activeDocumentBean.viewManager.currentRightPage.get().fullText != null}"
                                value="#{activeDocumentBean.viewManager.currentRightPage.get().fullText}" escape="false" />
                            <h:outputText value="#{msg.noFulltextAvailable}" rendered="#{activeDocumentBean.viewManager.currentRightPage.get().fullText == null}" />
                        </ui:fragment>
                    </ui:fragment>
                </ui:fragment>
            </div>
        </ui:fragment>
        
        
        <!-- HIDDEN POPOVER ELEMENT FOR EVERY ENTITY TERM -->
        <script>
        $( document ).ready(function() {


        $('[data-entity-type]').each(function() {
        	
        	var thisEntityElement = $(this);
        	// console.log(thisEntityElement);
        	var searchLink = $(this).data("entity-authority-data-search");
         	console.log(searchLink);
        	var authorityDataUri = $(this).data("entity-authority-data-uri");
         	console.log(authorityDataUri);
         	
         	
			var popOverActionsElement = `<div class="hidden entity-popover-element">
      			<!-- POPOVER HEADING -->
	  			<div class="popover-heading">Actions for this term</div>
	  			
	  			<!-- POPOVER BODY -->
	  			<div class="popover-body"> 
	  				<div class="d-flex flex-column">
	  					<button type="button">
	  						<i class="fa fa-list-ul" aria-hidden="true"></i> Normdata
	  					</button>
	  					<a href="\${searchLink}"><i class="fa fa-search" aria-hidden="true">${searchLink}</i>
	  						Trigger Search</a>
	  				</div>
	  			</div>
	  		</div>`
         	

			$(this).append(popOverActionsElement);
			
			// console.log($(thisEntityElement).find(".popover-body").html());
			
			var thisEntityBody = $(thisEntityElement).find(".popover-body").html();
			var thisEntityTitle = $(thisEntityElement).find(".popover-heading").html();
			
			$(this).popover({
			        html : true,
			      sanitize: false,
			        content: function() {
			       		var content = thisEntityBody;
			        	return content;
			        },
			        title: function() {
			            var title = thisEntityTitle;
			            return title;
			        },
			    });
			
        });

        });	
        </script>


	</div>
</ui:composition>