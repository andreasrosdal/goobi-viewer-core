<ui:composition

    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets">

    <ui:param name="search" value="#{searchParam != null ? searchParam : searchBean}"></ui:param>

    <!-- SEARCH ADVANCED -->
    <div class="search-advanced">
    
        <!-- MESSAGE -->
        <h:panelGroup rendered="#{!configurationBean.advancedSearchEnabled}">
            <div class="alert alert-warning" role="alert">
                <h:outputText value="#{msg.errFunctionalityDisabled}" />
            </div>
        </h:panelGroup>

        <h:panelGroup rendered="#{configurationBean.advancedSearchEnabled}">
            
            <h:form id="searchAdvancedForm" prependId="false" styleClass="search-advanced__form">
           			<h2 class="search-advanced__entry-area-title">#{msg.search__search_query}</h2>
                    <div class="search-advanced__entry-area">
                        <!-- AJAX LOADER -->
                        <div class="search-advanced__loader"></div>

                        <!-- SEARCH ADVANCED INPUT GROUP -->
                        <c:forEach var="queryItem" items="#{searchBean.advancedSearchQueryGroup.queryItems}" varStatus="status">
                            <div id="searchAdvancedInputGroup-0-#{status.count}" class="search-advanced__input-group">
                                    
                                    <c:choose>
                                    <c:when test="#{status.count == 1}">

                                            <!-- FIELD SELECT -->
                                            <div class="search-advanced__input-col">
                                                <div class="search-advanced__select custom-control custom-control--select">
                                                    <h:selectOneMenu id="advsearch_field_0-#{status.count}" styleClass="value-text" value="#{queryItem.field}" valueChangeListener="#{queryItem.selectOneMenuListener}">
                                                        
                                                        <c:forEach var="field" items="#{searchBean.advancedSearchAllowedFields}">
                                                    	   <f:passThroughAttribute name="aria-label" value="#{msg.searchIn}"/>
														  <f:passThroughAttribute name="aria-haspopup" value="listbox"/>
                                                            <f:selectItem itemValue="#{field.field}" itemLabel="#{msg[field.label]}" itemDisabled="#{field.disabled}" />
                                                        </c:forEach>
                                                        
                                                        <f:ajax render=":searchAdvancedInputGroup-0-#{status.count} :advsearch_value_group_0-#{status.count}" />
                                                    </h:selectOneMenu>
                                                </div>
                                            </div>

                                    </c:when>
                                    <c:otherwise>
                                    
                                    <div class="search-advanced__operator-field-pair-wrapper">
                                    
	                                        <!-- OPERATOR SELECT -->
	                                        <div id="advsearch_operator_0-#{status.count}" class="search-advanced__input-col">
	                                            <div class="custom-control custom-control--select search-advanced__custom-control">
	                                                <h:selectOneMenu id="advsearch_item_operator_0-#{status.count}" styleClass="search-advanced__select-values"
	                                                    value="#{queryItem.operator}">
	                                                    <f:passThroughAttribute name="aria-label" value="#{msg.aria_label__search_adv_search_link_search_terms}"/>
	                                                    <f:passThroughAttribute name="aria-haspopup" value="listbox"/>
	                                                    <f:selectItems value="#{queryItem.availableOperators}" var="operator" itemValue="#{operator}" itemLabel="#{operator.label}" />
	                                                </h:selectOneMenu>
	                                            </div>
	                                        </div>
	
	
	
	                                        <!-- FIELD SELECT -->
	                                        <div class="search-advanced__input-col">
	                                            <div class="custom-control custom-control--select search-advanced__custom-control">
	                                                <h:selectOneMenu id="advsearch_field_0-#{status.count}" styleClass="search-advanced__select-values" value="#{queryItem.field}"
	                                                    valueChangeListener="#{queryItem.selectOneMenuListener}">
	                                                    <c:forEach var="field" items="#{searchBean.advancedSearchAllowedFields}">
	                                                        <f:passThroughAttribute name="aria-label" value="#{msg.searchIn}"/>
	                                                        <f:passThroughAttribute name="aria-haspopup" value="listbox"/>
	                                                        <f:selectItem itemValue="#{field.field}" itemLabel="#{msg[field.label]}" itemDisabled="#{field.disabled}" />
	                                                    </c:forEach>
	                                                    <f:ajax render=":searchAdvancedInputGroup-0-#{status.count} :advsearch_value_group_0-#{status.count}" />
	                                                </h:selectOneMenu>
	                                            </div>
	                                        </div>
                                        
                                        </div>
                                        
                                        
                                    </c:otherwise>
                                    
                                    
                                    </c:choose>
                                    

                                        <!-- INPUT FIELD -->
                                        <h:panelGroup id="advsearch_value_group_0-#{status.count}">
                                            <div class="search-advanced__input-col">
                                                <h:panelGroup rendered="#{!queryItem.displaySelectItems}">
                                                    <div class="form-group">
                                                        <label class="sr-only" for="advsearchValueText_0-#{status.count}"></label>
                                                        <div class="input-group">
                                                            <ui:fragment rendered="#{queryItem.range}">
                                                            	<div class="search-advanced__year-span-from d-none d-lg-inline-block">#{msg.searchAdvanced_range_value1}</div>
                                                                <h:inputText id="advsearchValue1Text_0-#{status.count}"
                                                                    styleClass="form-control value-text -with-right-border" value="#{queryItem.value}">
                                                                    <f:passThroughAttribute name="placeholder" value="#{msg.year}" />
                                                                </h:inputText>
                                                                <i class="fa fa-arrows-h search-advanced__between-arrow d-lg-none" aria-hidden="true"></i>
                                                                <div class="search-advanced__year-span-to d-none d-lg-inline-block">#{msg.searchAdvanced_range_value2}</div>
                                                                <h:inputText id="advsearchValue2Text_0-#{status.count}"
                                                                    styleClass="form-control value-text -with-right-border" value="#{queryItem.value2}">
                                                                    <f:passThroughAttribute name="placeholder" value="#{msg.year}" />
                                                                </h:inputText>
                                                            </ui:fragment>
                                                            <ui:fragment rendered="#{!queryItem.range}">
                                                                <h:inputText id="advsearchValueText_0-#{status.count}"
                                                                    styleClass="form-control value-text" value="#{queryItem.value}">
                                                                    <f:passThroughAttribute name="placeholder" value="#{msg.searchFieldDemoText}" />
                                                                    <f:passThroughAttribute name="aria-label" value="#{msg.searchFieldDemoText}" />
                                                                </h:inputText>
                                                                <div class="input-group-append">
                                                                    <button type="button" class="btn btn--clean reset"
                                                                        data-toggle="tooltip" data-placement="top"
                                                                        title="#{msg.searchAdvanved_resetCurrentValue}"
                                                                        aria-label="#{msg.searchAdvanved_resetCurrentValue}">
                                                                        <i class="fa fa-times-circle" aria-hidden="true"></i>
                                                                    </button>
                                                            </div>
                                                            </ui:fragment>
                                                        </div>
                                                    </div>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{queryItem.displaySelectItems}">
                                                    <div class="custom-control custom-control--select">
                                                        <h:selectOneMenu id="advsearch_value_select_0-#{status.count}" styleClass="value-text"
                                                            value="#{queryItem.value}">
                                                            <c:forEach var="item" items="#{queryItem.selectItems}">
                                                                <f:selectItem itemValue="#{item.one}" itemLabel="#{item.two}" />
                                                            </c:forEach>
                                                            <f:passThroughAttribute name="aria-label" value="#{msg.cms_collections_err_noselection}" />
                                                        </h:selectOneMenu>
                                                    </div>
                                                </h:panelGroup>
                                            </div>
                                        </h:panelGroup>


                            </div>
                         </c:forEach>
                         
                        <!-- FUZZY SEARCH OPTION -->
						<div class="search-advanced__fuzzy-search-option-wrapper"><span class="search-advanced__fuzzy-search-option-label">#{msg.search__fuzzy_search}:</span> <viewerComponent:toggleSwitch name="fuzzeSearchToggle" value="#{searchBean.fuzzySearchEnabled}"/></div> 

                    </div>

                
                <!-- ADDITIONAL OPTIONS FOR ADV SEARCH -->
                <div class="search-advanced__additional-options-area">
	                <!-- SEARCH LIST SORTING -->
	                <h2 class="search-advanced__additional-options-title">#{msg.search__search_output}</h2>
	                <div class="search-advanced__nav-helper-box">
		                    <div class="search-list__nav-helper-item">
		                        <div class="search-list__nav-helper-label">
		                            <label for="hitsPerPageSelect" id="searchListSortingLabel">#{msg.search__hits_per_page}:</label>
		                        </div>
		                        <div class="custom-control custom-control--select">
		                             <h:selectOneMenu id="hitsPerPageSelect" value="#{searchBean.hitsPerPage}">
		                                 <f:selectItems var="value" value="#{configurationBean.searchHitsPerPageValues}"
		                                     itemLabel="#{value}" itemValue="#{value}" />
		                                 <f:passThroughAttribute name="aria-labelledby" value="searchListSortingLabel"/>
		                                 <f:passThroughAttribute name="aria-haspopup" value="listbox"/>
		                             </h:selectOneMenu>
		                             <h:commandButton style="display: none" action="#{search.search(cmsBean.currentPage.subThemeDiscriminatorValue)}">
		                                 <f:passThroughAttribute name="data-hits-per-page" value="reload"/>
		                             </h:commandButton>
		                        </div>
		                    </div>
		
		                    <div class="search-list__nav-helper-item" >
		                        <div class="search-list__nav-helper-label">
		                            <label for="sortSelect">#{msg.sortBy}:</label>
		                        </div>
		                        <div class="custom-control custom-control--select">
		                            <h:selectOneMenu value="#{search.sortString}" id="sortSelect">
		                                <f:selectItems value="#{searchBean.searchSortingOptions}"
		                                    var="option"
		                                    itemLabel="#{option.label}"
		                                    itemValue="#{option.sortString}"/>
		                            </h:selectOneMenu>                                
		                        </div>
		                    </div>

	               </div>
                </div>

               

                <!-- SEARCH ADVANCED ACTION -->
                <div class="search-advanced__action">
                    <h:commandButton styleClass="btn btn--full" value="#{msg.search}" action="#{search.searchAdvanced}">
                        <f:setPropertyActionListener target="#{searchBean.activeSearchType}" value="1" />
                    </h:commandButton>
                    <button
						class="btn btn--default"
						jsf:action="#{search.resetSearch}">
						#{msg.reset}
					</button>
                </div>

                
            </h:form>
        </h:panelGroup>
    </div>

    <script type="text/javascript">
        $(document).ready(function() {
        	var searchAdvancedConfig = {};

        	viewerJS.searchAdvanced.init(searchAdvancedConfig);
        });
    </script>
</ui:composition>
