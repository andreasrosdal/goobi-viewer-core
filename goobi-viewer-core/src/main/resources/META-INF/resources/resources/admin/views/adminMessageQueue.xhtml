<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
    template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <ui:define name="metadata">
        <f:metadata>
            <f:event
                type="preRenderView"
                listener="#{navigationHelper.setCurrentPageAdmin('adminMessageQueue')}" />
        </f:metadata>
    </ui:define>

    <ui:define name="content">
        <div id="adminAllUsers">
            <h:panelGroup rendered="#{userBean.admin}">
                <h:form
                    id="adminAllUserForm"
                    prependId="false">
                    <div class="admin__title-bar">
                        <!-- TITLE -->
                        <h1 class="admin__title">#{msg.admin__message_queue__title}</h1>
                    </div>


                    <viewerComponent:adminBreadcrumbs />


                    <!-- TODO style buttons, increase in size, add tooltip, change color of active button -->
                    <button
                        jsf:action="#{messageQueueBean.pauseQueue}"
                        jsf:id="pauseButton"
                        class="#{!messageQueueBean.paused ? 'active' : ''} btn">
                        <i class="fa fa-pause"></i>
                    </button>

                    <button
                        jsf:action="#{messageQueueBean.resumeQueue}"
                        jsf:id="resumeButton"
                        class="#{messageQueueBean.paused ? 'active' : ''} btn">
                        <i class="fa fa-play"></i>
                    </button>


                    <button
                        jsf:action="#{messageQueueBean.clearQueue}"
                        jsf:id="clearButton"
                        class="btn">
                        <i class="fa fa-trash"></i>
                    </button>


                    <ui:fragment rendered="#{!messageQueueBean.messageBrokerStart}">
                        <h:outputText value="#{msgs.admin__message_queue__queues_switched_off}" />
                    </ui:fragment>

                    <ui:fragment rendered="#{messageQueueBean.messageBrokerStart}">



                        <div class="admin__content-inner-content">
                            <div class="admin__table-tools">
                                <!-- PAGINATOR -->
                                <div class="admin__table-paginator">
                                    <!--  <viewerComponent:dataTablePaginator tableValues="#{adminBean.lazyModelUsers}" /> -->
                                </div>

                            </div>

                            <!-- All MESSAGE TYPE TABLE -->
                            <div
                                id="new-table-adminallmessagetypes"
                                class="admin__table-content"
                                role="grid"
                                aria-label="#{msg.admin__message_queue__message_types}: #{msg.aria_label__table__actions}">
                                <!-- TITLE ROW -->
                                <div
                                    class="row no-gutters admin__table-title"
                                    role="row">
                                    <!-- NAME COL -->
                                    <div class="col-6 d-flex -sorting-arrow-trigger">
                                        <!-- SORTING -->
                                        <viewerComponent:sortingArrow
                                            filterType="email"
                                            colHeading="#{msg.admin__message_queue__message_type}"
                                            list="#{adminBean.lazyModelUsers}" />
                                    </div>
                                    <!-- LAST LOGIN COL -->
                                    <div class="col-3 d-flex -sorting-arrow-trigger">
                                        <!-- SORTING -->
                                        <viewerComponent:sortingArrow
                                            filterType="lastLogin"
                                            colHeading="#{msg.admin__message_queue__message_count}"
                                            list="#{adminBean.lazyModelUsers}" />
                                    </div>
                                    <!-- USER GROUPS COL -->
                                    <div
                                        class="col-3 d-flex"
                                        role="columnheader">#{msg.admin__message_queue__details}</div>
                                </div>


                                <!-- INDIVIDUAL ROWS -->
                                <ui:repeat
                                    var="entry"
                                    value="#{messageQueueBean.queueContent}">
                                    <div
                                        class="row no-gutters admin__table-entry"
                                        role="row">
                                        <!-- message type -->
                                        <div class="col-6 d-flex">
                                            <h:outputText value="#{msg[entry.key]}" />
                                        </div>

                                        <!-- number of messages -->
                                        <div
                                            class="col-3 d-flex align-items-center"
                                            role="gridcell">
                                            <h:outputText value="#{entry.value}" />
                                        </div>

                                        <!-- actions -->
                                        <div
                                            class="col-3 d-flex align-items-center align-content-center flex-wrap"
                                            role="gridcell">

                                            <button
                                                jsf:action="#{messageQueueBean.removeMessagesFromQueue}"
                                                class="btn">
                                                <i class="fa fa-trash-o" />
                                                <f:setPropertyActionListener
                                                    target="#{messageQueueBean.messageType}"
                                                    value="#{entry.key}" />
                                            </button>

                                            <button
                                                jsf:id="displayDetails"
                                                class="btn">
                                                <i class="fa fa-info" />
                                                <f:setPropertyActionListener
                                                    target="#{messageQueueBean.messageType}"
                                                    value="#{entry.key}" />
                                                <f:ajax render="details" />
                                            </button>


                                        </div>
                                    </div>
                                </ui:repeat>
                            </div>
                        </div>

                        <h:panelGroup id="details">
                            <br />
                            <ui:fragment rendered="#{messageQueueBean.messageType != null}">

#{msg.admin__message_queue__details}

                                <div
                                    id="messagedetails"
                                    class="admin__table-content"
                                    role="grid"
                                    aria-label="#{msg.admin__message_queue__message_types}: #{msg.aria_label__table__actions}">
                                    <!-- TITLE ROW -->
                                    <div
                                        class="row no-gutters admin__table-title"
                                        role="row">

                                        <div
                                            class="col-2 d-flex -sorting-arrow-trigger"
                                            role="columnheader">
                                            <h:outputText value="#{msg.admin__message_queue__message_id}" />
                                        </div>
                                        <div
                                            class="col-2 d-flex -sorting-arrow-trigger"
                                            role="columnheader">
                                            <h:outputText value="#{msg.admin__message_queue__message_type}" />
                                        </div>
                                        <div
                                            class="col-3 d-flex -sorting-arrow-trigger"
                                            role="columnheader">
                                            <h:outputText value="#{msg.admin__message_queue__pi}" />
                                        </div>
                                        <div
                                            class="col-3 d-flex -sorting-arrow-trigger"
                                            role="columnheader">
                                            <h:outputText value="#{msgs.admin__message_queue__properties}" />
                                        </div>
                                        <div
                                            class="col-2 d-flex"
                                            role="columnheader">#{msg.admin__message_queue__details}</div>
                                    </div>


                                    <ui:repeat
                                        var="ticket"
                                        value="#{messageQueueBean.activeQueryMesssages}">

                                        <div
                                            class="row no-gutters admin__table-entry"
                                            role="row">

                                            <div class="col-2 d-flex">
                                                <h:outputText value="#{ticket.messageId}" />
                                            </div>

                                            <div class="col-2 d-flex">
                                                <h:outputText value="#{msg[ticket.taskName]}" />
                                            </div>
                                            <div class="col-3 d-flex">
                                                <h:outputText value="#{ticket.pi}" />
                                            </div>
                                            <div class="col-3 d-flex">
                                                <ui:repeat
                                                    var="prop"
                                                    value="#{ticket.properties.keySet()}">
                                                    <h:outputText value="#{prop}: #{ticket.properties[prop]} " />
                                                    <br />
                                                </ui:repeat>
                                            </div>
                                            <div class="col-2 d-flex">
                                                <button
                                                    jsf:action="#{messageQueueBean.deleteMessage(ticket)}"
                                                    class="btn">
                                                    <i class="fa fa-trash-o" />
                                                </button>
                                            </div>

                                        </div>
                                    </ui:repeat>
                                </div>
                            </ui:fragment>
                        </h:panelGroup>


                    </ui:fragment>
                </h:form>
            </h:panelGroup>
        </div>
        <script type="text/javascript">
									var dataTableConfig = {
										dataTablePaginator : "#dataTablePaginator",
										txtField1 : "#txtMoveTo1",
										txtField2 : "#txtMoveTo2",
										totalCount : "#totalCount",
										reloadBtn : 'input[id*="cmdMoveTo"]',
									};

									viewerJS.dataTable.init(dataTableConfig);
								</script>
    </ui:define>

</ui:composition>
