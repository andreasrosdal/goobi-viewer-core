<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
	xmlns:cmsComponent="http://xmlns.jcp.org/jsf/composite/cms/components"
	xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
	template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

<ui:define name="metadata">
	<f:metadata>
		<f:event type="preRenderView" listener="#{navigationHelper.setCurrentPageAdmin('adminConfigEditor')}" />
	</f:metadata>
</ui:define>

<ui:define name="content">
	<f:view contentType="text/html" encoding="utf-8">
		<div id="adminConfigEditor">
			<h:outputText
				rendered="#{userBean.admin and adminBean.translationLocked}"
				value="#{msg.admin__translation_locked}" />

					<div class="admin__title-bar">
						<!-- TITLE -->
						<h1 class="admin__title">#{msg.admin__config_editor__title}</h1>
					</div>

					<div class="admin__content-inner-content">

						<div class="admin__content-wrapper">
							<div class="admin__content-main -sticky -refreshHCsticky">
								<h2>#{msg.dateiinhalt}</h2>

								<!-- CODEMIRROR EDITOR FORM -->
								<h:form id="editor-form">

				 					<!-- TEXTAREA -->
									<h:inputTextarea id="editor" cols="170" rows="87"
										value="#{configEditorBean.fileContent}" />
										
										<script>console.log('something happened');</script>
										
				                    <div class="admin__overlay-bar">
				                    	
				                    	<h:commandButton 
				                    		value="#{msg.cancel}" 
				                    		disabled="#{not(configEditorBean.editable)}" 
				                    		styleClass="btn btn--default admin__overlay-bar-action" 
				                    		action="#{configEditorBean.cancelEdition}" >
				                    		
											<f:ajax execute="@form" render="backup-form" />
										</h:commandButton>
				                    	
				                    	<h:commandButton 
				                    		value="#{msg.save}" 
				                    		type="submit" 
				                    		styleClass="btn btn--success admin__overlay-bar-action" 
				                    		action="#{configEditorBean.saveFile}"
											onclick="writeCMcontentIntoTextArea();" >
											
											<f:ajax excute="@form" render="@all" />
										</h:commandButton>

				                    </div>
										

<!-- 					<h:panelGroup layout="block" styleClass="save-cancel-buttons"> -->
<!-- 						<h:commandButton value="Save" -->
<!-- 										 type="submit"  -->
<!-- 										 styleClass="buttons general-buttons" -->
<!-- 										 action="#{configEditorBean.saveFile}"  -->
<!-- 										 accesskey="s" -->
<!-- 										 onclick="saveEditor();" -->
<!-- 										 disabled="#{not(configEditorBean.editable)}"> -->
										 
<!-- 							<f:ajax execute="@form" render="backup-form:backup-table :output"/> -->
<!-- 						</h:commandButton> -->
<!-- 						<h:commandButton value="Cancel" -->
<!-- 										 styleClass="buttons general-buttons" -->
<!-- 										 action="#{configEditorBean.cancelEdition}" -->
<!-- 										 accesskey="c" -->
<!-- 										 disabled="#{not(configEditorBean.editable)}"> -->
<!-- 							<f:ajax execute="@form" render="@all"/> -->
<!-- 						</h:commandButton> -->
<!-- 					</h:panelGroup> -->


								</h:form>

								<p class="label">
									<h:outputText value="Dateien" />
								</p>
								<p class="description">
									<h:outputText value="Bitte wÃ¤hle aus der folgenden Liste die zu bearbeitende Datei:" />
								</p>

								
								<!-- CHECK THIS + ADAPT STYLING -->
								<div id="currentConfigFileType"
									style="position: absolute; visibility: hidden">
									#{configEditorBean.currentConfigFileType}</div>


							</div>
							<div class="admin__content-side">
							
								<div class="admin__default-block">
								
								<h:form id="backup-form">
								
								<ui:repeat var="record" value="#{configEditorBean.backupRecordsModel}">
								<div class="">#{record.name} <h:commandButton
											styleClass="buttons download-buttons fa fa-solid"
											value="&#xf019;" action="#{configEditorBean.downloadFile}"
											disabled="#{not(configEditorBean.downloadable)}">

											<f:ajax execute="@this" render="@all" />
										</h:commandButton></div>	
								
								</ui:repeat>
								
								</h:form>

								</div>
								
								
								
								<div class="admin__default-block">
									

									
										<h:form id="file-form">
										
									<div class="admin__config-editor-file-selection-inner" id="file-table">
		
										<ui:repeat var="record" value="#{configEditorBean.fileRecordsModel}">
											
											<div class="admin__config-editor-file-selection-single-entry">
												<h:commandLink value="#{record.fileName}"
													action="#{configEditorBean.showBackups}"
													name="#{record.number}"
													onclick="setEditable(false, #{record.number}, false);">
													<f:ajax execute="@this" render="@all" />
												</h:commandLink>
	
												<h:commandButton
													value="#{record.writable ? '&#xf040;' : '&#xf06e;'}"
													styleClass="buttons edit-buttons fa fa-solid"
													action="#{configEditorBean.editFile(record.writable)}"
													name="#{record.number}" rendered="#{record.readable}"
													onclick="setEditable(#{record.writable}, #{record.number}, true);">
													<f:ajax execute="@this" render="@all" immediate="true" />
												</h:commandButton>
											</div>
											
										</ui:repeat>
										
									</div>
										
										</h:form>
								</div>
								
								
								

							</div>
						</div>
					</div>

				<script>			
					var readOnly;
					if (readOnly === undefined){
						readOnly = true;
					}
					initTextArea();  
					
					// SHOW OVERLAY BAR IF USER TYPES IN TEXTAREA

					
					
				</script>
				
				
				
		</div>
	</f:view>
</ui:define>

</ui:composition>
