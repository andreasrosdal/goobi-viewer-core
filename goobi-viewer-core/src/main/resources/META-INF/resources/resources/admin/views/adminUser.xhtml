<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:h="http://xmlns.jcp.org/jsf/html" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets" 
    xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
    template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPageAdmin('adminUser')}" />
            <f:event type="preRenderView" listener="#{adminBean.currentUser.backupFields}" />
        </f:metadata>
    </ui:define>

    <ui:define name="content">
        <f:view contentType="text/html" encoding="utf-8">
            <div id="adminUser">
                <h:panelGroup rendered="#{userBean.admin == true and adminBean.currentUser != null}">
                    <h:panelGroup rendered="#{adminBean.currentUser.id == null}">
                        <h2 class="admin__content-inner-title">#{msg.newUserCreateUser}</h2>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{adminBean.currentUser.id != null}">
                        <h2 class="admin__content-inner-title">#{msg.user}</h2>
                    </h:panelGroup>

                    <div class="admin__content-inner-content">
                        <div role="tabpanel">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs" role="tablist">
                                <!-- user data link -->
                                <li role="presentation" class="active">
                                    <a href="#userData" aria-controls="home" role="tab" data-toggle="tab">#{msg.userCP}</a>
                                </li>
    
                                <!-- licenses link -->
                                <li role="presentation">
                                    <a href="#licenses" aria-controls="profile" role="tab" data-toggle="tab">#{msg.licenses}</a>
                                </li>
                            </ul>
    
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <!-- user data tab -->
                                <div role="tabpanel" class="tab-pane active" id="userData">
                                    <ui:include src="/resources/admin/includes/tabUserGeneral.xhtml" />
                                </div>
    
                                <!-- licenses tab -->
                                <div role="tabpanel" class="tab-pane" id="licenses">
                                    <ui:include src="/resources/admin/includes/tabUserLicenses.xhtml" />
                                </div>
                            </div>
                        </div>

                        <!-- PASSWORD -->
                        <ui:fragment rendered="#{adminBean.currentUser.active}">
                            <h:panelGroup rendered="#{adminBean.currentUser.id == null}">
                                <h3>#{msg.password}</h3>
                            
                                <!-- TODO proper css class -->
                                <div class="cms-select-template__template">
                            
                                    <div class="form-horizontal" role="form">
                                        <div class="form-group cms-select-template__template">
                                            <h:outputLabel for="adminPasswordOneNew" styleClass="col-sm-4 control-label" value="#{msg.newUserPasswordOne}:" />
                                            <div class="col-sm-8">
                                                <h:inputSecret id="adminPasswordOneNew" styleClass="form-control" value="#{adminBean.passwordOne}"
                                                    required="true" requiredMessage="#{msg.newUserPasswordOneRequired}" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <h:outputLabel for="adminPasswordTwoNew" styleClass="col-sm-4 control-label" value="#{msg.newUserPasswordTwo}:" />
                                            <div class="col-sm-8">
                                                <h:inputSecret id="adminPasswordTwoNew" styleClass="form-control" value="#{adminBean.passwordTwo}"
                                                    required="true" requiredMessage="#{msg.newUserPasswordOneRequired}" />
                                            </div>
                                        </div>
                                    </div>
                            
                                </div>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{adminBean.currentUser.id != null}">
                                <h3>#{msg.changePassword}</h3>
                            
                                <!-- TODO proper css class -->
                                <div class="cms-select-template__template">
                            
                                    <div class="form-horizontal" role="form">
                                        <div class="form-group">
                                            <h:outputLabel for="adminPasswordOne" styleClass="col-sm-4 control-label" value="#{msg.newUserPasswordOne}:" />
                                            <div class="col-sm-8">
                                                <h:inputSecret id="adminPasswordOne" styleClass="form-control" value="#{adminBean.passwordOne}" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <h:outputLabel for="adminPasswordTwo" styleClass="col-sm-4 control-label" value="#{msg.newUserPasswordTwo}:" />
                                            <div class="col-sm-8">
                                                <h:inputSecret id="adminPasswordTwo" styleClass="form-control" value="#{adminBean.passwordTwo}" />
                                            </div>
                                        </div>
                                    </div>
                            
                                </div>
                            </h:panelGroup>
                        
                        </ui:fragment>
                        
                        <!-- SAVE / CANCEL BUTTONS -->
                        <ui:fragment rendered="#{adminBean.currentUser.active}">                        
                            <div class="text-right">
                                <h:commandLink  rendered="#{adminBean.currentUser.id != null}"
                                    id="cancelUserButton" styleClass="btn" value="#{msg.cancel}" action="adminAllUsers" immediate="true">
                                    <f:setPropertyActionListener target="#{adminBean.currentUser}" value="#{null}" />
                                </h:commandLink>
                                <h:commandLink id="saveUserButton" styleClass="btn btn--success" value="#{msg.save}"
                                    action="#{adminBean.saveUserAction}" />
                            </div>
                        </ui:fragment>
                        
                        <!-- ACCOUNT ACTIVATION -->
                        <ui:fragment rendered="#{!adminBean.currentUser.active}">
                            <h3>#{msg.admin__user_activation_title}</h3>
                            
                            <!-- TODO proper css class -->
                            <!-- TODO yellow frame -->
                            <div class="cms-select-template__template">
                            
                                #{msg.admin__user_activation_description}
                                <div class="form-horizontal" role="form">
                                    <div class="form-group">
                                        <div class="col-sm-9">
                                            <div class="checkbox">
                                                <label> 
                                                    <h:selectBooleanCheckbox value="#{adminBean.currentUser.active}" />
                                                    #{msg.admin__user_activation_label}
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <h:commandLink id="saveUserActivationButton" styleClass="btn btn--success" value="#{msg.save}"
                                        action="#{adminBean.saveUserAction}" />
                                </div>
                                
                            </div>
                        </ui:fragment>
                        
                        </h:form>
                        
                        <!-- DELETE USER -->
                        <ui:fragment rendered="#{adminBean.currentUser.id != null}">
                            <h:form id="deleteUser" styleClass="form-horizontal" role="form" prependId="false">
                                <h3>#{msg.admin__delete_user_account}</h3>
                                
                                <!-- TODO proper css class -->
                                <!-- TODO red frame -->
                                <div class="cms-select-template__template">
                                
                                    <h:selectOneRadio value="#{adminBean.deleteUserContributions}" immediate="true"> 
                                        <f:selectItem itemValue="false" itemLabel="#{msg.admin__user_delete_keep_data}" />
                                        <f:selectItem itemValue="true" itemLabel="#{msg.admin__user_delete_everything}"
                                            itemDisabled="#{adminBean.currentUser.cmsCreator}" />
                                    </h:selectOneRadio>
                                    
                                    <div class="form-group">
                                        <h:outputLabel for="emailConfirmation" styleClass="col-sm-6 control-label" value="#{msg.user__displayName} *" />
                                        <div class="col-sm-6">
                                            <h:inputText value="#{adminBean.emailConfirmation}" id="emailConfirmation" label="emailConfirmation"
                                                styleClass="form-control" required="true" requiredMessage="#{msg.admin__error_email_mismatch}" />
                                        </div>
                                    </div>

                                    <div class="text-right">
                                        <h:commandLink id="deleteUserButton" styleClass="btn btn--danger" value="#{msg.admin__delete_user_permanently}"
                                            action="#{adminBean.deleteUserAction(user, false)}" />
                                    </div>
                                </div>
                            </h:form>
                        </ui:fragment>
                        
                    </div>
                </h:panelGroup>
            </div>
        </f:view>
    </ui:define>

    <!-- SIDEBAR -->
    <ui:define name="sidebar">
        <adminWidget:widget_admin />
        <adminWidget:widget_crowdsourcing />
        <adminWidget:widget_cms />
    </ui:define>
</ui:composition>
