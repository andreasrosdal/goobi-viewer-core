<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:h="http://xmlns.jcp.org/jsf/html" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets" 
    xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
    template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPageAdmin('adminUser')}" />
            <f:event type="preRenderView" listener="#{adminBean.currentUser.backupFields}" />
	    <f:viewParam name="avatar" value="#{adminBean.currentUser.useGravatar}"/>
        </f:metadata>
    </ui:define>

    <ui:define name="content">
        <f:view contentType="text/html" encoding="utf-8">
            <div id="adminUser">
                <h:panelGroup rendered="#{userBean.admin == true and adminBean.currentUser != null}">
                    <div class="admin__title-bar">
	                    <ui:fragment rendered="#{adminBean.currentUser.id == null}">
	                    	<h2 class="admin__title">#{msg.admin__user_create_new}</h2>
	                    </ui:fragment>
	                    <ui:fragment rendered="#{adminBean.currentUser.id != null}">
	                        <h2 class="admin__title">#{msg.admin__user_edit}</h2>
	                    </ui:fragment>
                	</div>

                    <div class="admin__content-inner-content">
    
                    <!-- PROFILE -->
                    <h:form id="editUser" styleClass="form-horizontal form-group" role="form" prependId="false">
                        <h3>#{msg.admin__user_profile}</h3>
                        
                        <!-- TODO proper css class -->
                        <div class="admin__default-block">
                        
                        <!-- prevent autocomplete in IE, Chrome and Firefox -->
                        <input type="text" class="hidden" />
                        <input type="password" class="hidden" />
                        
                        
                        
                        <!-- TODO LOGIC FOR DISABLED OR NOT DISABLED -->
                  		<!--  <fieldset disabled="#{!adminBean.currentUser.active}">-->
						<fieldset>
						
                            <div class="form-group form-row">
                            
                                <div class="col-2 control-label admin__form-label">
                                	<h:outputLabel for="displayName" value="#{msg.admin__user_display_name}" />
                                </div>
                                <div class="col-9 admin__form-input">
                                    <h:inputText value="#{adminBean.currentUser.nickName}" id="displayName" label="displayName" styleClass="form-control"
                                        required="false" requiredMessage="#{msg.loginEnterDisplayName}" />
                                    <span class="admin__form-help-text">#{msg.admin__user_display_name__help}</span>
                                </div>
                                <div class="col-1 admin__form-help-icon">
                                    <button type="button" class="btn btn--clean" data-toggle="helptext">
                                        <i class="fa fa-question-circle" aria-hidden="true"></i>
                                    </button>
                                </div>
                                
                            </div>
                            
                                <h:panelGroup id="emailGroup">
                                <div class="form-group form-row">
                                    <div class="cms-module__option-message">
                                        <h:messages for="email" 
                                            infoClass="cms-module__option-message-status success" 
                                            warnClass="cms-module__option-message-status warning"
                                            errorClass="cms-module__option-message-status danger" />
                                        <div class="cms-module__option-message-mark">
                                            <i class="fa fa-check" aria-hidden="true"></i>
                                            <i class="fa fa-exclamation" aria-hidden="true"></i>
                                        </div>
                                    </div>
                                    
                                    <div class="col-2 control-label admin__form-label">
	                                    <h:outputLabel for="email" value="#{msg.email}" /><span class="admin__label-required-field">(#{msg.form__required-field})</span>
                                    </div>
                                    
                                    <div class="col-9 admin__form-input">
                                        <h:inputText value="#{adminBean.currentUser.email}" id="email" label="email" immediate="true" required="true"
                                            styleClass="form-control">
                                            <f:validator validatorId="emailValidator" for="email" />
                                            <f:ajax render="emailGroup" />
                                        </h:inputText>
                                        <span class="admin__form-help-text">#{msg.admin__user_email__help}</span>
                                    </div>

                                    <div class="col-1 admin__form-help-icon">
                                        <button type="button" class="btn btn--clean" data-toggle="helptext">
                                            <i class="fa fa-question-circle" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                    
                                       </div>
                                </h:panelGroup>
                         
                            
                            
                            <div class="form-group form-row">
                            
                            <div class="col-2 control-label admin__form-label">
                                <h:outputLabel for="firstName" value="#{msg.nameFirst}" />
                            </div>
                            
                                <div class="col-9 admin__form-input">
                                    <h:inputText value="#{adminBean.currentUser.firstName}" id="firstName" label="firstName" styleClass="form-control" />
                                    <span class="admin__form-help-text">#{msg.admin__user_first_name__help}</span>
                                </div>
                                <div class="col-1 admin__form-help-icon">
                                    <button type="button" class="btn btn--clean" data-toggle="helptext">
                                        <i class="fa fa-question-circle" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group form-row">
                            <div class="col-2 control-label admin__form-label">
                                <h:outputLabel for="lastName" value="#{msg.nameLast}" />
                            </div>
                            
                            <div class="col-9 admin__form-input">
                                    <h:inputText value="#{adminBean.currentUser.lastName}" id="lastName" label="lastName" styleClass="form-control" />
                                    <span class="admin__form-help-text">#{msg.admin__user_last_name__help}</span>
                            </div>
                                <div class="col-1 admin__form-help-icon">
                                    <button type="button" class="btn btn--clean" data-toggle="helptext">
                                        <i class="fa fa-question-circle" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group form-row">
                                <div class="col-2 control-label admin__form-label">
                                <h:outputLabel for="avatar" value="#{msg.admin__user_avatar}" />
                                </div>
                                                     
                                <!-- TODO CONVERT TO BOOTSTRAP STRUCTURE -->
                                <div id="avatar" class="col-9">
                                    <div class="row no-gutters">
                                        <div class="col-6">
                                            <img class="admin__user-icon" src="#{request.contextPath}/resources/themes/#{navigationHelper.theme}/images/thumbnail_goobi_person.png" />
                                            <input type="radio" jsf:id="avatarFalseOption" pt:name="avatar" value="false" pt:checked="#{!adminBean.currentUser.useGravatar ? 'false' : null}" />
                                            <label for="avatarFalseOption">#{msg.admin__user_avatar_standard}</label>
                                        </div>
                                        <div class="col-6">
                                            <img class="admin__user-icon" src="#{adminBean.currentUser.getGravatarUrl(96)}" />
                                            <input type="radio" jsf:id="avatarTrueOption" pt:name="avatar" value="true" pt:checked="#{adminBean.currentUser.useGravatar ? 'true' : null}"/>
                                            <label for="avatarTrueOption">#{msg.admin__user_avatar_gravatar}</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group form-row">
                            
                            
                            <div class="col-2 control-label admin__form-label">
                                <h:outputLabel for="superuser" value="#{msg.admin__user_superuser}" />
                            </div>
                            
                            
                                <div class="col-9 admin__form-input">
                                    <div class="form-check admin__form-checkbox">
                                        <h:selectBooleanCheckbox class="form-check-input" type="checkbox" value="#{adminBean.currentUser.superuser}"
                                        id="superUser" />
                                        <label class="form-check-label" for="superUser">#{msg.admin__user_superuser_notice}</label>
                                    </div>
                                </div>
                                </div>
                                                 
                            
                        </fieldset>
                        
                        </div>

                        <!-- PASSWORD -->
                            <h:panelGroup rendered="#{adminBean.currentUser.id == null}">
                                <h3>#{msg.password}</h3>
                            
                                <!-- TODO proper css class -->
                                <div class="admin__default-block">
					<!-- TODO FIX MESSAGE KEY, HTML AND CSS HERE -->
					<p>#{msg.admin__user_password_info_text}</p> 
                                    <div class="form-horizontal" role="form">
                                        <div class="form-group form-row">
                                            <h:outputLabel for="adminPasswordOneNew" styleClass="col-sm-4 control-label" value="#{msg.newUserPasswordOne}" />
                                            <div class="col-sm-8">
                                                <h:inputSecret id="adminPasswordOneNew" styleClass="form-control" value="#{adminBean.passwordOne}"
                                                    required="true" requiredMessage="#{msg.newUserPasswordOneRequired}" />
                                            </div>
                                        </div>
                                        <div class="form-group form-row">
                                            <h:outputLabel for="adminPasswordTwoNew" styleClass="col-sm-4 control-label" value="#{msg.newUserPasswordTwo}" />
                                            <div class="col-sm-8">
                                                <h:inputSecret id="adminPasswordTwoNew" styleClass="form-control" value="#{adminBean.passwordTwo}"
                                                    required="true" requiredMessage="#{msg.newUserPasswordOneRequired}" />
                                            </div>
                                        </div>
                                    </div>
                            
                                </div>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{adminBean.currentUser.id != null}">
                                <h3>#{msg.changePassword}</h3>
                            
                                <!-- TODO proper css class -->
                                <div class="admin__default-block">
                            
                                    <div class="form-horizontal" role="form">
                                        <div class="form-group form-row">
                                            <h:outputLabel for="adminPasswordOne" styleClass="col-2 control-label" value="#{msg.newUserPasswordOne}" />
                                            <div class="col-9">
                                                <h:inputSecret id="adminPasswordOne" styleClass="form-control" value="#{adminBean.passwordOne}" />
                                            </div>
                                        </div>
                                        <div class="form-group form-row">
                                            <h:outputLabel for="adminPasswordTwo" styleClass="col-2 control-label" value="#{msg.newUserPasswordTwo}" />
                                            <div class="col-9">
                                                <h:inputSecret id="adminPasswordTwo" styleClass="form-control" value="#{adminBean.passwordTwo}" />
                                            </div>
                                        </div>
                                    </div>
                            
                                </div>
                            </h:panelGroup>
                        
                        <!-- SAVE / CANCEL BUTTONS -->
                        <ui:fragment rendered="#{adminBean.currentUser.active}">                        
                            <div class="text-right">
                                <h:commandLink  rendered="#{adminBean.currentUser.id != null}"
                                    id="cancelUserButton" styleClass="btn" value="#{msg.cancel}" action="adminUsers" immediate="true">
                                    <f:setPropertyActionListener target="#{adminBean.currentUser}" value="#{null}" />
                                </h:commandLink>
                                <h:commandLink id="saveUserButton" styleClass="btn btn--success" value="#{msg.save}"
                                    action="#{adminBean.saveUserAction}" />
                            </div>
                        </ui:fragment>
                        
                        <!-- ACCOUNT ACTIVATION -->
                        <ui:fragment rendered="#{!adminBean.currentUser.active}">
                            <h3>#{msg.admin__user_activation}</h3>

								<div class="admin__default-block -warning">

									<div class="form-group form-row">
										<div class="col-9">
											<p>#{msg.admin__user_activation_description}</p>
										</div>
									</div>

									<div class="form-group form-row">
										<div class="col-9">
											<div class="form-check">
												<h:selectBooleanCheckbox class="form-check-input" value="#{adminBean.currentUser.active}" /><label class="form-check-label"> 
													#{msg.admin__user_activation_label}
												</label>
											</div>
										</div>
									</div>

								<div class="text-right">
                                    <h:commandLink id="saveUserActivationButton" styleClass="btn btn--success" value="#{msg.save}"
                                        action="#{adminBean.saveUserAction}" />
                                </div>
                                
                            </div>
                        </ui:fragment>
                        
                        </h:form>
                        
                        <!-- DELETE USER -->
                        <ui:fragment rendered="#{adminBean.currentUser.id != null}">
                            <h:form id="deleteUser" styleClass="form-horizontal" role="form" prependId="false">
                                <h3>#{msg.admin__user_delete}</h3>
                                
                                <div class="admin__default-block -danger">
                                
                                <div class="form-group form-row">
										<div class="col-9">
											<p>#{msg.admin__user_delete_description}:</p>
										</div>
								</div>
                                
                                
                                <!-- TODO CONVERT TO BOOTSTRAP STRUCTURE -->
                                <div class="form-group">
                                    <h:selectOneRadio value="#{adminBean.deleteUserContributions}" immediate="true"> 
                                        <f:selectItem itemValue="false" itemLabel="#{msg.admin__user_delete_type_keep_data}" />
                                        <f:selectItem itemValue="true" itemLabel="#{msg.admin__user_delete_type_everything}"
                                            itemDisabled="#{adminBean.currentUser.cmsCreator}" />
                                    </h:selectOneRadio>
                                </div>    
                                    
                                    
                                    
                                    <div class="form-group form-row">
                                        <h:outputLabel for="emailConfirmation" styleClass="col-6 control-label"
                                            value="#{msg.admin__user_delete_email_confirmation}:" />
                                        <div class="col-6">
                                            <h:inputText value="#{adminBean.emailConfirmation}" id="emailConfirmation" label="emailConfirmation"
                                                styleClass="form-control" required="true" requiredMessage="#{msg.admin__error_email_mismatch}" />
                                        </div>
                                    </div>

                                    <div class="text-right">
                                        <h:commandLink id="deleteUserButton" styleClass="btn btn--danger" value="#{msg.admin__user_delete_permanently}"
                                            action="#{adminBean.deleteUserAction(user, false)}" />
                                    </div>
                                </div>
                            </h:form>
                        </ui:fragment>
                        
                    </div>
                </h:panelGroup>
            </div>
        </f:view>
    </ui:define>

    <!-- SIDEBAR -->
    <ui:define name="sidebar">
        <adminWidget:widget_admin />
        <adminWidget:widget_crowdsourcing />
        <adminWidget:widget_cms />
    </ui:define>
</ui:composition>
