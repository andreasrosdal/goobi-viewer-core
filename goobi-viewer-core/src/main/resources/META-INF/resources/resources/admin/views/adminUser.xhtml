<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
	xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
	xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
	template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{navigationHelper.setCurrentPageAdmin('adminUser')}" />
			<f:viewAction onPostback="false"
				action="#{adminBean.currentUser.backupFields}" />
			<f:viewParam name="avatar"
				value="#{adminBean.currentUser.useGravatar}" />
			<f:viewParam name="deleteData"
				value="#{adminBean.deleteUserContributions}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
		<f:view contentType="text/html" encoding="utf-8">
			<div id="adminUser">
				<h:panelGroup
					rendered="#{userBean.admin == true and adminBean.currentUser != null}">
					<div class="admin__title-bar">
						<ui:fragment rendered="#{adminBean.currentUser.id == null}">
							<h2 class="admin__title">#{msg.admin__user_create_new}</h2>
						</ui:fragment>
						<ui:fragment rendered="#{adminBean.currentUser.id != null}">
							<h2 class="admin__title">#{msg.admin__user_edit}</h2>
						</ui:fragment>
					</div>

					<div class="admin__content-inner-content">

						<div class="admin__content-wrapper">
							<div class="admin__content-main -refreshHCsticky">

								<!-- PROFILE -->
								<h:form id="editUser" role="form" prependId="false">
									<h3>#{msg.general}</h3>
									<div class="admin__default-block">

										<!-- prevent autocomplete in IE, Chrome and Firefox -->
										<input type="text" class="hidden" /> <input type="password"
											class="hidden" />

										<fieldset>
											<!-- USER DISPLAY NAME -->
											<div class="form-group form-row">
												<div class="col-2 control-label admin__form-label">
													<label for="displayName">#{msg.admin__user_display_name}:</label>
												</div>
												<div class="col-9 admin__form-input">
													<h:inputText value="#{adminBean.currentUser.nickName}"
														id="displayName" label="displayName"
														styleClass="form-control" required="false"
														requiredMessage="#{msg.loginEnterDisplayName}" />
													<span class="admin__form-help-text">#{msg.admin__user_display_name__help}</span>
												</div>
												<div class="col-1 admin__form-help-icon">
													<button type="button" class="btn btn--clean"
														data-toggle="helptext" aria-label="inline help icon">
														<i class="fa fa-question-circle" aria-hidden="true"></i>
													</button>
												</div>
											</div>

											<!-- USER EMAIL ADDRESS -->
											<h:panelGroup id="emailGroup" layout="block"
												styleClass="form-group form-row">
												<div class="col-2 control-label admin__form-label">
													<label for="email">#{msg.email}: </label><span
														class="admin__label-required-field">(#{msg.form__required_field})</span>
												</div>
												<div
													class="col-9 admin__form-input cms-module__option-control">
													<div class="cms-module__option-message">
														<h:messages for="email"
															infoClass="cms-module__option-message-status success"
															warnClass="cms-module__option-message-status warning"
															errorClass="cms-module__option-message-status danger" />
														<div class="cms-module__option-message-mark">
															<i class="fa fa-check" aria-hidden="true"></i> <i
																class="fa fa-exclamation" aria-hidden="true"></i>
														</div>
													</div>
													<h:inputText disabled="#{adminBean.currentUser.anonymous}"
														value="#{adminBean.currentUser.email}" id="email"
														label="email" immediate="true" required="true"
														styleClass="form-control">
														<f:validator validatorId="emailValidator" for="email" />
														<f:ajax render="emailGroup" />
													</h:inputText>
													<span class="admin__form-help-text">#{msg.admin__user_email__help}</span>
												</div>
												<div class="col-1 admin__form-help-icon">
													<button type="button" class="btn btn--clean"
														data-toggle="helptext" aria-label="inline help icon">
														<i class="fa fa-question-circle" aria-hidden="true"></i>
													</button>
												</div>
											</h:panelGroup>

											<!-- USER FIRST NAME -->
											<div class="form-group form-row">
												<div class="col-2 control-label admin__form-label">
													<label for="firstName">#{msg.nameFirst}:</label>
												</div>
												<div class="col-9 admin__form-input">
													<h:inputText value="#{adminBean.currentUser.firstName}"
														id="firstName" label="firstName" styleClass="form-control" />
													<span class="admin__form-help-text">#{msg.admin__user_first_name__help}</span>
												</div>
												<div class="col-1 admin__form-help-icon">
													<button type="button" class="btn btn--clean"
														data-toggle="helptext" aria-label="inline help icon">
														<i class="fa fa-question-circle" aria-hidden="true"></i>
													</button>
												</div>
											</div>

											<!-- USER LAST NAME -->
											<div class="form-group form-row">
												<div class="col-2 control-label admin__form-label">
													<label for="lastName">#{msg.nameLast}:</label>
												</div>
												<div class="col-9 admin__form-input">
													<h:inputText value="#{adminBean.currentUser.lastName}"
														id="lastName" label="lastName" styleClass="form-control" />
													<span class="admin__form-help-text">#{msg.admin__user_last_name__help}</span>
												</div>
												<div class="col-1 admin__form-help-icon">
													<button type="button" class="btn btn--clean"
														data-toggle="helptext" aria-label="inline help icon">
														<i class="fa fa-question-circle" aria-hidden="true"></i>
													</button>
												</div>
											</div>



										</fieldset>
									</div>

									<!-- PASSWORD NEW USER -->
									<ui:fragment rendered="#{adminBean.currentUser.id == null}">
										<h3>#{msg.password}</h3>
										<div class="admin__default-block">
											<p>#{msg.admin__user_create_password_info_text}</p>
											<div class="form-horizontal" role="form">
												<div class="form-group form-row">
													<h:outputLabel for="adminPasswordOneNew"
														styleClass="col-sm-2 control-label"
														value="#{msg.newUserPasswordOne}:" />
													<div class="col-sm-9">
														<h:inputSecret id="adminPasswordOneNew"
															styleClass="form-control"
															value="#{adminBean.passwordOne}" required="true"
															requiredMessage="#{msg.newUserPasswordOneRequired}" />
													</div>
												</div>
												<div class="form-group form-row">
													<h:outputLabel for="adminPasswordTwoNew"
														styleClass="col-sm-2 control-label"
														value="#{msg.newUserPasswordTwo}:" />
													<div class="col-sm-9">
														<h:inputSecret id="adminPasswordTwoNew"
															styleClass="form-control"
															value="#{adminBean.passwordTwo}" required="true"
															requiredMessage="#{msg.newUserPasswordOneRequired}" />
													</div>
												</div>
											</div>
										</div>
									</ui:fragment>

									<!-- PASSWORD CHANGE FOR EXISTING USER -->
									<ui:fragment
										rendered="#{adminBean.currentUser.id != null and !adminBean.currentUser.anonymous}">
										<h3>#{msg.changePassword}</h3>
										<div class="admin__default-block">
											<p>#{msg.admin__user_password_info_text}</p>
											<div class="form-horizontal" role="form">
												<div class="form-group form-row">
													<h:outputLabel for="adminPasswordOne"
														styleClass="col-2 control-label"
														value="#{msg.newUserPasswordOne}:" />
													<div class="col-9">
														<h:inputSecret id="adminPasswordOne"
															styleClass="form-control"
															value="#{adminBean.passwordOne}" />
													</div>
												</div>
												<div class="form-group form-row">
													<h:outputLabel for="adminPasswordTwo"
														styleClass="col-2 control-label"
														value="#{msg.newUserPasswordTwo}:" />
													<div class="col-9">
														<h:inputSecret id="adminPasswordTwo"
															styleClass="form-control"
															value="#{adminBean.passwordTwo}" />
													</div>
												</div>
											</div>
										</div>
									</ui:fragment>

									<!-- SAVE / CANCEL BUTTONS FOR EXISTING USERS -->
									<ui:fragment rendered="#{adminBean.currentUser.active}">
										<div
											class="row no-gutters justify-content-end admin__final-actions">
											<h:commandLink rendered="#{adminBean.currentUser.id != null}"
												id="cancelUserButton" styleClass="btn admin__cancel-button"
												value="#{msg.cancel}" action="pretty:adminUsers"
												immediate="true" />
											<h:commandLink id="saveUserButton"
												styleClass="btn btn--success" value="#{msg.save}"
												action="#{adminBean.saveCurrentUserAction}" />
										</div>
									</ui:fragment>

									<!-- ACCOUNT ACTIVATION -->
									<ui:fragment
										rendered="#{!adminBean.currentUser.active and !adminBean.currentUser.anonymous}">
										<h3>#{msg.admin__user_activation}</h3>
										<div class="admin__default-block -warning">
											<p>#{msg.admin__user_activation_description}</p>
											<div class="form-group form-row">
												<div class="col-9">
													<div class="form-check">
														<h:selectBooleanCheckbox class="form-check-input"
															value="#{adminBean.currentUser.active}"
															id="userActivation" />
														<label for="userActivation" class="form-check-label">#{msg.admin__user_activation_label}</label>
													</div>
												</div>
											</div>
										</div>
										<!-- SAVE / CANCEL BUTTONS FOR NEW USER -->
										<div
											class="row no-gutters justify-content-end admin__final-actions">
											<h:commandLink id="cancelNewUserCreationnButton"
												styleClass="btn admin__cancel-button" value="#{msg.cancel}"
												action="pretty:adminUsers" immediate="true" />
											<h:commandLink id="saveNewUserCreationButton"
												styleClass="btn btn--success" value="#{msg.save}"
												action="#{adminBean.saveCurrentUserAction}" />
										</div>
									</ui:fragment>
								</h:form>

								<!-- DELETE USER -->
								<ui:fragment
									rendered="#{adminBean.currentUser.id != null and !adminBean.currentUser.anonymous}">
									<h:form id="deleteUser" styleClass="form-horizontal"
										role="form" prependId="false">
										<h3>#{msg.admin__user_delete}</h3>
										<div class="admin__default-block -danger">
											<p>#{msg.admin__user_delete_description}:</p>
											<div class="form-group">
												<div class="form-check connected-top">
													<input type="radio" id="keepDataOption" name="deleteData"
														value="false"
														checked="#{adminBean.deleteUserContributions ? null : 'true'}" />
													<label for="keepDataOption">#{msg.admin__user_delete_type_keep_data}</label>
												</div>
												<div class="form-check connected-bottom">
													<input type="radio" id="deleteDataOption" name="deleteData"
														value="true"
														checked="#{adminBean.deleteUserContributions ? 'true' : null}" />
													<label for="deleteDataOption">#{msg.admin__user_delete_type_everything}</label>
												</div>
											</div>
											<div class="form-group form-row">
												<h:outputLabel for="emailConfirmation"
													styleClass="col-4 control-label"
													value="#{msg.admin__user_delete_email_confirmation}:" />
												<div class="col-8">
													<h:inputText value="#{adminBean.emailConfirmation}"
														id="emailConfirmation" label="emailConfirmation"
														styleClass="form-control" required="true"
														requiredMessage="#{msg.admin__error_email_mismatch}" />
												</div>
											</div>
											<div class="text-right">
												<h:commandLink id="deleteUserButton"
													styleClass="btn btn--danger"
													value="#{msg.admin__user_delete_permanently}"
													action="#{adminBean.deleteUserAction(adminBean.currentUser, adminBean.deleteUserContributions)}" />
											</div>
										</div>
									</h:form>
								</ui:fragment>


							</div>


							<div class="admin__content-side -sticky">
								<div class="admin__default-block">
									<!-- USER ADMIN RIGHTS -->
									<div class="form-group form-row">

										<img class="user-settings__profile-image"
											src="#{userBean.user.getAvatarUrl(300)}" alt="User Avatar" />
										<button data-toggle="modal" data-backdrop="false"
											data-target="#changeProfilePicture"
											class="btn btn--default user-settings__profile-image-edit-button mb-3">#{msg.user_change_profile_picture}</button>



										<div class="col-6 control-label admin__form-label">
											<span>#{msg.admin__user_superuser}:</span>
										</div>
										<div class="col-6 admin__form-input">
											<div class="admin__radio-switch openAccessToggle">
												<h:selectOneRadio group="superUserToggle"
													value="#{adminBean.currentUser.superuser}" immediate="true"
													checked="#{adminBean.currentUser.superuser ? null : 'false'}">
													<f:selectItem itemValue="#{false}" itemLabel="#{msg.no}" />
												</h:selectOneRadio>
												<h:selectOneRadio group="superUserToggle"
													value="#{adminBean.currentUser.superuser}" immediate="true"
													checked="#{adminBean.currentUser.superuser ? 'true' : null}">
													<f:selectItem itemValue="#{true}" itemLabel="#{msg.yes}" />
												</h:selectOneRadio>
												<span class="toggle-outside"><span
													class="toggle-inside"></span></span>
											</div>
										</div>
									</div>

								</div>

							</div>

						</div>
					</div>
				</h:panelGroup>


				<!-- EDIT USERDATA MODAL -->
				<div class="modal fade profile-picture-modal"
					id="changeProfilePicture" tabindex="-1" role="dialog"
					aria-labelledby="editUserdataModalLabel">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<h:form>

								<div class="modal-header">
									<h3 class="modal-title" id="editUserdataModalLabel">#{msg.user_change_profile_picture}</h3>
									<button type="button" class="fancy-close" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true"> <h:outputText
												value="&amp;times;" escape="false" />
										</span>
									</button>
								</div>
								<div class="modal-body">

									<p>#{msg.user_change_profile_picture_text}</p>


									<h:panelGroup layout="block" id="avatarModeGroup"
										styleClass="admin__cms-edit-collection-image-actions-wrapper">

										<div
											class="form-group admin__cms-edit-collection-connected-radio-buttons">
											<div class="connected-top">
												<!-- STANDARD PLACEHOLDER PERSON IMAGE -->
												<h:selectOneRadio group="imageModeRadio"
													value="#{cc.attrs.user.avatarType}" immediate="true">
													<f:selectItem itemValue="DEFAULT"
														itemLabel="#{msg.user_change_profile_picture_label_standard}" />
													<f:ajax render="avatarModeGroup" />
												</h:selectOneRadio>
											</div>
											<div class="connected-middle">
												<!-- TO DO: UPLOAD OWN IMAGE FILE -->
												<h:selectOneRadio group="imageModeRadio"
													value="#{cc.attrs.user.avatarType}" immediate="true">
													<f:selectItem itemValue="LOCAL"
														itemLabel="#{msg.user_change_profile_picture_upload_image}" />
													<f:ajax render="avatarModeGroup" />
												</h:selectOneRadio>
											</div>
											<div class="connected-bottom">
												<!-- CHOOSE GRAVATAR AS PROFILE PICTURE -->
												<h:selectOneRadio group="imageModeRadio"
													value="#{cc.attrs.user.avatarType}" immediate="true">
													<f:selectItem itemValue="GRAVATAR"
														itemLabel="#{msg.gravatar}" />
													<f:ajax render="avatarModeGroup" />
												</h:selectOneRadio>
											</div>
										</div>


										<h:panelGroup layout="block"
											styleClass="admin__cms-edit-collection-wrapper-choose-image"
											id="mediaGroup"
											rendered="#{cmsCollectionsBean.imageMode == 'IMAGE'}">
											<!-- THUMBNAIL -->
											<div class="admin__cms-edit-collection-image-thumbnail">
												<ui:fragment
													rendered="#{cmsCollectionsBean.currentCollection.hasImage()}">
													<img src="#{cmsCollectionsBean.currentCollection.iconURI}"
														class="img-fluid" alt="" />
												</ui:fragment>
												<ui:fragment
													rendered="#{!cmsCollectionsBean.currentCollection.hasImage()}">
													<img
														data-src="#{imageDelivery.thumbs.getThumbnailPath(null)}"
														data-viewer-thumbnail="thumbnail" class="img-fluid" alt="" />
												</ui:fragment>
											</div>

											<!-- ACTIONS -->
											<div class="admin__cms-edit-collection-image-actions">
												<h:commandLink
													action="#{cmsBean.setSelectedMediaHolder(cmsCollectionsBean.currentCollection)}"
													value="#{cmsCollectionsBean.currentCollection.getMediaItem() == null ? msg.cms_selectMedia : msg.cms_media_editFile}"
													class="#{cmsCollectionsBean.currentCollection.getMediaItem() == null ? 'btn btn--default' : ''}"
													role="button">
													<f:ajax execute="@form" render="mediaSelectPanel" />
												</h:commandLink>
												<h:commandLink
													rendered="#{cmsCollectionsBean.currentCollection.getMediaItem() != null}"
													action="#{cmsCollectionsBean.currentCollection.setMediaItem(null)}"
													value="#{msg.cms_selectMediaItem_deselect}"
													class="-redlink" role="button">
													<f:ajax render="mediaGroup" />
												</h:commandLink>
											</div>

										</h:panelGroup>

										<h:panelGroup layout="block"
											styleClass="admin__cms-collections-wrapper-identifier"
											id="piGroup"
											rendered="#{cmsCollectionsBean.imageMode == 'PI'}">
											<div class="cms-edit-collection__text-control">
												<h:inputText id="workPI" styleClass="form-control"
													validator="#{cmsCollectionsBean.validatePI}"
													value="#{cmsCollectionsBean.currentCollection.representativeWorkPI}">
													<!--                                 validator="piInSolrValidator" -->
													<f:ajax render="@all"></f:ajax>
												</h:inputText>
											</div>
										</h:panelGroup>

									</h:panelGroup>


								</div>
								<div class="modal-footer">
									<h:commandButton value="#{msg.save}"
										styleClass="btn btn--success">
										<f:passThroughAttribute name="aria-label" value="#{msg.save}" />
									</h:commandButton>
								</div>


							</h:form>
						</div>
					</div>
					<div class="alt-backdrop" data-dismiss="modal"></div>
				</div>








			</div>
		</f:view>
	</ui:define>

</ui:composition>
