<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:composite="http://xmlns.jcp.org/jsf/composite">

	<composite:interface />

	<composite:implementation>
		<div role="tabpanel"
			class="tab-pane #{cmsBean.selectedLocale == null ? 'active':''} sidebar-editor__wrapper"
			id="sidebarTab">

			<!-- sidebar editor -->

				<h:panelGroup id="sidebarEditorWrapper" styleClass="sidebar-editor" layout="block">
					<h:panelGroup rendered="#{!cmsBean.selectedPage.useDefaultSidebar}">
							
							
							<h:panelGroup layout="block" id="selectedWidgetsGroup" class="sidebar-editor__left">
								<h3>#{msg.cms_pageSidebar}</h3>
								
								<div class="sidebar-editor__left-inner">

									<ui:repeat var="element" varStatus="status"
										value="#{cmsBean.selectedPage.sidebarElements}">

										<div class="sidebar-editor__widget-item">
											<!-- MOVE ITEM UP OR DOWN -->
											<div class="sidebar-editor__move-wrapper">
											
												<button class="btn btn--clean sidebar-editor__move-up" rendered="#{!status.first}"
													jsf:action="#{cmsBean.selectedPage.moveUpSidebarElement(element)}">
													<i class="fa fa-arrow-up" aria-hidden="true"></i>
													<f:ajax render="sidebar_editor_component:selectedWidgetsGroup"></f:ajax>
												</button>
												
												<button class="btn btn--clean sidebar-editor__move-down" rendered="#{!status.last}"
													jsf:action="#{cmsBean.selectedPage.moveDownSidebarElement(element)}">
													<i class="fa fa-arrow-down" aria-hidden="true"></i>
													<f:ajax render="sidebar_editor_component:selectedWidgetsGroup"></f:ajax>
												</button>
												
											</div> 
											
											<!-- ITEM LABEL -->
											<div class="sidebar-editor__widget-item-label">#{element.title.textOrDefault}</div> 
											
											<!-- ITEM DELETE -->
											<h:commandLink
													styleClass="admin__table-action-link sidebar-editor__widget-item-delete-button -redlink"
													action="#{cmsBean.selectedPage.removeSidebarElement(element)}"
													aria-label="#{msg.delete}">#{msg.delete}
													<f:ajax render="@form"/>
											</h:commandLink>			
										</div>
									</ui:repeat>
								</div>
							</h:panelGroup>

							<h:panelGroup layout="block" id="availableWidgetsGroup" class="sidebar-editor__right">
							
								<h3>#{msg.cms_menu_availableComponents}</h3>
								
								<div class="sidebar-editor__right-inner">

									<ui:repeat var="widget" value="#{cmsPageEditBean.sidebarWidgets.keySet().stream().sorted().toList()}" varStatus="status">
										<ui:fragment rendered="#{!cmsBean.selectedPage.containsSidebarElement(widget)}">
											<div class="sidebar-editor__choose-widget-item">
											  <input type="checkbox" id="scales#{status.index}" name="scales#{status.index}" jsf:value="#{cmsPageEditBean.sidebarWidgets[widget]}">
											  	<f:ajax event="change"></f:ajax>
											  </input>
											  <label for="scales#{status.index}">#{widget.title.textOrDefault}</label>
											</div>
										</ui:fragment>
									</ui:repeat>


									<!-- NOT WORKING FUNCTIONALITY -->
									<ui:repeat var="widget" value="#{selectedWidgets}">
										<h:selectBooleanCheckbox value="#{selectedWidgets[widget]}"/>
									</ui:repeat>


									<button class="btn btn--default sidebar-editor__add-widgets-button" jsf:action="#{cmsBean.selectedPage.addToSidebar(cmsPageEditBean.getAndResetSelectedWidgets())}">
										#{msg.action__add_to_sidebar}
										<f:ajax render="@form"/>
									</button>

								</div>
								
								
								
							</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
				
				<!-- choose standard sidebar for current page -->
				<div class="sidebar-editor-choose-standard">
					<h:selectBooleanCheckbox id="checkboxUseDefaultSidebar"
						value="#{cmsBean.selectedPage.useDefaultSidebar}"
						onclick="cmsJS.createPage.disablePreview();">
						<h:outputText value="#{msg.cms_pageSidebarUseDefault}" />
						<f:ajax render="cmsCreatePageAccessControl" />
						<f:passThroughAttribute name="aria-label"
							value="#{msg.cms_pageSidebarUseDefault}" />
					</h:selectBooleanCheckbox>
				</div>

			</div>
	</composite:implementation>


</ui:composition>