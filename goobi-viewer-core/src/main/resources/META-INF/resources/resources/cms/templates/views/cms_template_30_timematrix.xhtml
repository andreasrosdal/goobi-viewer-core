<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:viewer="http://xmlns.jcp.org/jsf/composite/components/partner"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components" 
	xmlns:widgetComponent="http://xmlns.jcp.org/jsf/composite/components/widgets"
	template="/resources/themes/#{navigationHelper.theme}/template.html"
	xmlns:pretty="http://ocpsoft.com/prettyfaces/3.3.3">

	<ui:param name="cmsPage" value="#{cmsBean.currentPage}" />

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView" listener="#{navigationHelper.setCurrentPage(cmsBean.currentPage.title, false, false, true)}" />
			<f:event type="preRenderView" listener="#{breadcrumbBean.updateBreadcrumbs(cmsBean.currentPage)}" />
			<f:event type="preRenderView" listener="#{searchBean.resetSearchFilter}" />
		</f:metadata>
	</ui:define>
	
	<ui:define name="breadcrumbs">
        <ui:include src="/resources/includes/breadcrumbs.xhtml" />
    </ui:define>
    

	<ui:define name="content">
    
		<f:view contentType="text/html" encoding="utf-8">
			<div id="templateTimematrix" class="tpl-timeMatrix">
                <!-- EDIT PAGE -->
                <ui:fragment rendered="#{cmsBean.mayEdit(cmsPage)}">
                    <ui:include src="/resources/cms/includes/editPage.xhtml" />                    
                </ui:fragment>
                
                <!-- PAGE UNPUBLISHED -->
                <h:panelGroup rendered="#{!cmsPage.published}">
                    <div class="alert alert-warning" role="alert">
                        #{msg.cms_pagePreviewNotPublished}
                    </div>
                </h:panelGroup>

				<h2>#{cmsPage.title}</h2>                
				
                <!-- TEXT -->
                <div class="tpl-timeMatrix__text">
                    <ui:include src="#{cmsPage.getContent('text01')}" />
                </div>

				<div class="tpl-timematrix__subarea">
	                <h3 class="tpl-timematrix__selection-header">#{msg.timematrixSelectRange}</h3>
	               	<!-- LOADER -->
					<span class="tpl-timematrix__loader">
						<img src="#{request.contextPath}/resources/images/infinity_loader.gif" class="img-responsive" alt="Timematrix Loader" />
					</span> 
				</div>

				<div class="tpl-timematrix__selection">
					<form id="locateTimematrix" method="POST">
						<input type="hidden" id="timematrixSelectionRangeInput1" value="#{configurationBean.timeMatrixStartYear}" />
						<input type="hidden" id="timematrixSelectionRangeInput2" value="#{configurationBean.timeMatrixEndYear}" />
						<div id="slider-range" onmouseup="mouseUp()"></div>
						<button type="submit" id="setTimematrix" class="btn btn--full setTimematrix">#{msg.timematrixCalculate}</button>
					</form>
					<div class="tpl-timematrix__hitsForm">
						<label>#{msg.hits}:</label> 
						<input type="number" id="hitsPerPage" class="hitsPerPage" name="hitsPerPage" value="#{configurationBean.timeMatrixHits}" placeholder="hits per page" />
						<button type="submit" class="setTimematrix">#{msg.timematrixCalculate}</button>
					</div>
				</div>
				
				<div class="clearfix"></div>

				<div id="timematrixCanvas"></div>
				
				<div class="clearfix"></div>
				
				<timematrix></timematrix>
				
            	</div>

						<!-- Loads results when the page is reloaded -->
			<script>			
				$("document").ready(function() {
				    setTimeout(function() {
				        $(".setTimematrix").trigger('click');
				    },10);
				});
				
				<!-- Reloads the results after the slider is released -->
				function mouseUp() {
					document.getElementById("setTimematrix").click();
				}
			</script>
			
			<script>
			<!-- Reloads the results after leaving the input field -->
			document.getElementById("hitsPerPage").onfocusout = function() {myFunction()};
			
			function myFunction() {
				document.getElementById("setTimematrix").click();
				
			}
			</script>

           	<script>
           		var $startHere= $("#timematrixSelectionRangeInput1");
               	var $endHere= $("#timematrixSelectionRangeInput2");
               	var $count= $(".hitsPerPage");
               	
           		riot.mount('timematrix', {
              		msg: {
              			timematrixCalculate: "#{msg.timematrixCalculate}",
          	        	closeWindow: "#{msg.timematrixCloseWindow}",
          	        	goToWork: "#{msg.timematrixGoToWork}"
              		},
                   	startInput: "#timematrixSelectionRangeInput1",
                   	endInput: "#timematrixSelectionRangeInput2",
                   	contextPath: "#{request.contextPath}/",
                   	count: $( ".hitsPerPage" ),
                   	button: ".setTimematrix",
                   	loading: $('.tpl-timematrix__loader'),
                   	});
           	</script>
            
            <script type="text/javascript">
	            $(document).ready(function() {
	              	var timematrixConfig = {
		                contextPath: "#{request.contextPath}/",
		                rangeInput1: $( "#timematrixSelectionRangeInput1" ),
		                startDate: $( "#timematrixSelectionRangeInput1" ).val(),
		                rangeInput2: $( "#timematrixSelectionRangeInput2" ),
			            endDate: $( "#timematrixSelectionRangeInput2" ).val(),
			            count: $( ".hitsPerPage" ),
			            $tmCanvas: $( "#timematrixCanvas" ),
			            $tmCanvasPos: $( "#timematrixCanvas" ).position(),
		                lang: {
		                	closeWindow: "#{msg.timematrixCloseWindow}",
		                	goToWork: "#{msg.timematrixGoToWork}"	                  
		                }              	      
	              	};
	              	
	                viewerJS.timematrix.init( timematrixConfig );            	
	            });
            </script>
            
            <script>
            	<!-- Reloads the results after pressing the input field with Enter -->
				var input = document.getElementById("hitsPerPage");
				input.addEventListener("keyup", function(event) {
				  if (event.keyCode === 13) {
				   event.preventDefault();
				   document.getElementById("setTimematrix").click();
				  }
				});	           
			</script>
		</f:view>
	</ui:define>

    <!-- SIDEBAR -->
	<ui:define name="sidebar">
		<ui:include src="/resources/cms/includes/cms_sidebar.xhtml" />
    </ui:define>
</ui:composition>
