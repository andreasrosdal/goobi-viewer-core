<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
	xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
	template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{navigationHelper.setCurrentPageAdmin('adminCmsCollections')}" />
			<f:event type="preRenderView" listener="#{cmsBean.init()}" />
			<f:event type="preRenderView"
				listener="#{browseBean.initializeCollection('DC', 'FACET_DC')}" />
			<f:event type="preRenderView"
				listener="#{browseBean.populateCollection('DC')}" />
		</f:metadata>
	</ui:define>

	<!-- CONTENT -->
	<ui:define name="content">
		<ui:fragment id="cmsCollectionsAccessControl"
			rendered="#{userBean.user.isHasCmsPrivilege('CMS_COLLECTIONS')}">
			<div id="cmsCollections">
				<div class="admin__title-bar">
					<h2 class="admin__title">#{msg.cms_collections}</h2>
				</div>

				<div class="admin__content-inner-content">

					<h:form id="cmsCollectionsForm" prependId="false">




						<!-- COLLECTION TREE -->
						<div class="admin__content-wrapper">

							<div class="admin__content-main -sticky">
								<div class="admin__default-block">
								<div class="admin__entry-list">
									<ul class="collection">
										<ui:repeat var="browseDcElement" value="#{browseBean.getCollection(cmsCollectionsBean.solrField).visibleDcElements}">
											<li class="collection__item collection__item--level-#{browseDcElement.level}"
												style="#{navigationHelper.localeString eq 'ar' or navigationHelper.localeString eq 'iw' ? 'padding-right:' : 'padding-left:'} #{browseDcElement.level * 32}px">
												<div class="row">
													<div class="col-2 col-sm-1 collection__structure-col">
														<!-- STRUCTURE -->
														<h:panelGroup
															rendered="#{browseDcElement.hasSubelements and !browseDcElement.opensInNewWindow}">
															<div class="collection__structure text-center">
																<h:commandLink
																	action="#{browseBean.dcCollection.toggleChildren(browseDcElement)}">
																	<f:passThroughAttribute name="aria-label"
																		value="#{msg.aria_label__show_details}" />
																	<h:panelGroup
																		rendered="#{browseDcElement.hasSubelements and !browseDcElement.showSubElements}">
																		<i class="fa fa-plus-square-o" aria-hidden="true"></i>
																	</h:panelGroup>
																	<h:panelGroup
																		rendered="#{browseDcElement.hasSubelements and browseDcElement.showSubElements}">
																		<i class="fa fa-minus-square-o" aria-hidden="true"></i>
																	</h:panelGroup>
																	<f:ajax render="@form" />
																</h:commandLink>
															</div>
														</h:panelGroup>
													</div>
													<div class="col-7 col-sm-9">
														<div class="collection__title">

															<div class="row">
																<div class="col-12">
																	<!-- TITLE -->
																	<h:outputLink
																		value="#{browseBean.dcCollection.getCollectionUrl(browseDcElement)}"
																		styleClass="#{browseBean.dcCollection.isTopVisibleElement(browseDcElement) ? 'collection__top-element' : ''}">
																		<h:outputText
																			rendered="#{browseDcElement.displayNumberOfVolumes}"
																			value="#{msg[browseDcElement.label]} (#{browseDcElement.numberOfVolumes})" />
																		<h:outputText
																			rendered="#{!browseDcElement.displayNumberOfVolumes}"
																			value="#{msg[browseDcElement.label]}" />
																		<f:ajax render="@form" />
																	</h:outputLink>
																</div>
															</div>
														</div>
													</div>
													<div class="col-3 col-sm-2 collection__item-end">
														<!-- TOGGLE DESCRIPTION -->
														<h:panelGroup
															rendered="#{msg[browseDcElement.description] != browseDcElement.description || browseDcElement.hasCMSDescription()}">
															<div class="collection__description-toggle">
																<h:commandLink title="#{msg[browseDcElement.label]}">
																	<h:panelGroup
																		rendered="#{not browseDcElement.showDescription}">
																		<i class="fa fa-angle-down" aria-hidden="true"></i>
																	</h:panelGroup>

																	<h:panelGroup
																		rendered="#{browseDcElement.showDescription}">
																		<i class="fa fa-angle-up" aria-hidden="true"></i>
																	</h:panelGroup>

																	<f:setPropertyActionListener
																		target="#{browseDcElement.showDescription}"
																		value="#{not browseDcElement.showDescription}" />
																	<f:ajax render="@form" />
																</h:commandLink>
															</div>
														</h:panelGroup>

														<!-- TODO: EDIT -->
														<div>
															<a href="#" title="#{msg.edit}" target="_blank"> </a>
														</div>
													</div>

													<!-- DESCRIPTION -->
													<h:panelGroup rendered="#{browseDcElement.showDescription}">
														<div class="col-12 col-sm-11 col-sm-offset-1">
															<div class="collection__description">
																<h:outputText
																	value="#{msg[browseDcElement.description]}"
																	escape="false" />
															</div>
															<h:panelGroup rendered="#{browseDcElement.hasIcon()}">
																<img data-src="#{browseDcElement.icon}" alt=""
																	class="img-fluid" data-viewer-thumbnail="thumbnail" />
															</h:panelGroup>
														</div>
													</h:panelGroup>
												</div>

											</li>
										</ui:repeat>
									</ul>
								</div>
							</div>
							</div>


							<!-- SIDEBAR -->
							<div class="admin__content-side">

								<c:choose>
									<c:when test="#{adminBean.hasAccessPermissingForTranslationFiles()}">
										<div class="admin__boxed-entry">
											<!--  TRANSLATION GROUPS -->
											<ui:repeat var="group"
												value="#{adminBean.getTranslationGroupsForSolrField(cmsCollectionsBean.solrField)}">
												<div class="admin__boxed-entry -w100 -std-bottom-pad">
													<div class="row">
														<div class="col-12 col-lg-9">
															<!-- GROUP TITLE -->
															<h3>#{msg[group.name]}</h3>

															<!-- DESCRIPTION -->
															<ui:fragment rendered="#{group.description ne ''}">
																<p class="admin__boxed-entry-description">#{msg[group.description]}</p>
															</ui:fragment>
															<ui:fragment rendered="#{group.description eq ''}">
																<p class="admin__boxed-entry-description-empty"
																	aria-disabled="true">
																	(#{msg.admin__label__no_description_available})</p>
															</ui:fragment>

														</div>

														<div
															class="col-12 col-lg-3 d-flex justify-content-center justify-content-lg-end">
															<div class="d-flex flex-column align-items-center">

																<ui:fragment
																	rendered="#{group.fullyTranslatedEntryCount != group.entryCount}">
																	<a class="btn btn--full"
																		href="#{navigationHelper.applicationUrl}admin/translations/edit/#{group.id}/"
																		aria-label="#{msg.edit}: #{msg[group.name]}">#{msg.admin__translations_translate}</a>
																	<div class="admin__translations-overview-number">(#{group.fullyTranslatedEntryCount}
																		#{msg.of} #{group.entryCount})</div>
																</ui:fragment>

																<ui:fragment
																	rendered="#{group.fullyTranslatedEntryCount == group.entryCount}">
																	<a class="btn btn--default"
																		href="#{navigationHelper.applicationUrl}admin/translations/edit/#{group.id}/"
																		aria-label="#{msg.edit}: #{msg[group.name]}">#{msg.show}</a>
																</ui:fragment>

															</div>
														</div>

													</div>

													<div class="admin__boxed-entry-progress">
														<div class="admin__boxed-entry-progress-complete"
															style="flex: 0 0 #{group.fullyTranslatedEntryCountPercentage}%; max-width: #{group.fullyTranslatedEntryCountPercentage}%;"></div>
														<div class="admin__boxed-entry-progress-partially"
															style="flex: 0 0 #{group.partiallyTranslatedEntryCountPercentage}%; max-width: #{group.partiallyTranslatedEntryCountPercentage}%;"></div>
													</div>
												</div>
											</ui:repeat>
										</div>
									</c:when>
									<c:otherwise>
										<div class="admin__boxed-entry -danger">
											<h3>#{msg.admin__translations__missing_write_permissions__title}</h3>
											<h:outputText escape="false"
												value="#{msg.admin__translations__missing_write_permissions__description}"></h:outputText>
										</div>
									</c:otherwise>
								</c:choose>

								<!-- COLLECTION INDEX FIELD -->
								<div class="admin__boxed-entry">
									<div class="#{fn:length(cmsCollectionsBean.allCollectionFields) > 1 ? '' : 'd-none'} form-group form-row">
										<h3><label for="SolrFieldSelect">#{msg.cms_collections_solrField}:</label></h3>

										<div>
											<h:selectOneMenu id="SolrFieldSelect" name="SolrFieldSelect"
												value="#{cmsCollectionsBean.solrField}"
												styleClass="form-control">
												<f:selectItems
													value="#{cmsCollectionsBean.allCollectionFields}" />
												<f:ajax render="@form"></f:ajax>
											</h:selectOneMenu>
											<span class="admin__form-help-text">#{msg.admin__cms_collections_select_field}</span>
										</div>
										<div class="col-1 admin__form-help-icon">
											<button type="button" class="btn btn--clean"
												data-toggle="helptext" aria-label="#{msg.aria_label__help}">
												<i class="fa fa-question-circle" aria-hidden="true"></i>
											</button>
										</div>
									</div>
								</div>
								
								<!--TODO: PREVIEW -->
								<div class="admin__boxed-entry">
									<h3>#{msg.preview}:</h3>
									
								</div>

							</div>

						</div>
					</h:form>
				</div>
			</div>
		</ui:fragment>

	</ui:define>
</ui:composition>

