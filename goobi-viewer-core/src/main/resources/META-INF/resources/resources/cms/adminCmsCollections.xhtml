<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
    xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
    template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{navigationHelper.setCurrentPageAdmin('adminCmsCollections')}" />
            <f:event type="preRenderView" listener="#{cmsBean.init()}" />
        </f:metadata>
    </ui:define>

    <!-- CONTENT -->
    <ui:define name="content">
        <ui:fragment id="cmsCollectionsAccessControl" rendered="#{userBean.user.isHasCmsPrivilege('CMS_COLLECTIONS')}">
            <div id="cmsCollections">
                <div class="admin__title-bar">
                    <h2 class="admin__title">#{msg.cms_collections}</h2>
                </div>


                <div class="admin__content-inner-content">
                    <h:form id="cmsCollectionsForm" prependId="false">
                        <div class="admin__default-block">
                            <div class="form-group form-row">
                                <!-- COLLECTION FIELD -->
                                <div class="col-2 control-label admin__form-label">
                                    <label for="SolrFieldSelect">#{msg.cms_collections_solrField}:</label>
                                </div>

                                <!-- CONTROL -->
                                <div class="col-9 admin__form-input">
                                    <h:selectOneMenu id="SolrFieldSelect" name="SolrFieldSelect" value="#{cmsCollectionsBean.solrField}" styleClass="form-control">
                                        <f:selectItems value="#{cmsCollectionsBean.allCollectionFields}" />
                                        <f:ajax render="@form"></f:ajax>
                                    </h:selectOneMenu>
                                    <span class="admin__form-help-text">#{msg.admin__cms_collections_select_field}</span>
                                </div>
                                <div class="col-1 admin__form-help-icon">
                                    <button type="button" class="btn btn--clean" data-toggle="helptext" aria-label="inline help icon">
                                        <i class="fa fa-question-circle" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- ADD COLLECTION -->
                            <div class="form-group form-row">
                                <div class="col-2 control-label admin__form-label">
                                    <label for="SolrFieldInput">#{msg.cms_collections_solrFieldValue}:</label>
                                </div>

                                <!-- CONTROL -->
                                <div class="col-9 admin__form-input">
                                    <h:inputText id="SolrFieldInput" name="SolrFieldInput" styleClass="form-control" value="#{cmsCollectionsBean.solrFieldValue}" />
                                    <h:commandLink action="#{cmsCollectionsBean.addCollection()}" title="#{msg.cms_collections_solrFieldValue}">
                                        <i class="fa fa-plus-circle" aria-hidden="true"></i>
                                        <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                        <f:passThroughAttribute name="data-placement" value="top" />
                                        <f:ajax execute="@form" render="@all" />
                                    </h:commandLink>
                                    <span class="admin__form-help-text">#{msg.admin__cms_collections_add_field_value}</span>

                                    <script type="text/javascript">
                                        $( '#SolrFieldInput' ).autocomplete( {
                                                source: function( request, response ) {
                                                Q( $.ajax( {
                                                        url: '#{navigationHelper.applicationUrl}rest/contentAssist/collections/'
                                                        + $( '#SolrFieldSelect' ).val()
                                                        + '/'
                                                        + request.term
                                                        + '/',
                                                        type: 'GET',
                                                        datatype: 'json',
                                                } ) ).then( function( data ) {
                                                        response( data );
                                                } );
                                            },
                                            appendTo: $( '#SolrFieldInput' ).parent(),
                                            minLength: 0
                                        } ).bind('focus', function(){ $(this).autocomplete("search", "-") } );
                                    </script>
                                </div>
                                <div class="col-1 admin__form-help-icon">
                                    <button type="button" class="btn btn--clean" data-toggle="helptext" aria-label="inline help icon">
                                        <i class="fa fa-question-circle" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>


                        <!-- COLLECTION LIST -->
                        <div class="admin__table-content">
                            <div class="row no-gutters admin__table-title">
                                <div class="col-2 d-flex">#{msg.cms_collections_fieldValue}</div>
                                <div class="col-2 d-flex">#{msg.cms_collections_label}</div>
                                <div class="col-2 d-flex">#{msg.cms_collections_description}</div>
                                <div class="col-2 d-flex">#{msg.cms_collections_link}</div>
                                <div class="col-2 d-flex">#{msg.cms_collections_image}</div>
                                <div class="col-2 d-flex justify-content-center">#{msg.cms_collections_actions}</div>
                            </div>
                            <ui:repeat var="collection" value="#{cmsCollectionsBean.collections}">
                                <div class="row no-gutters admin__table-entry">
                                    <div class="col-2 d-flex">#{collection.solrFieldValue}</div>
                                    <div class="col-2 d-flex">#{collection.label}</div>
                                    <div class="col-2 d-flex">#{collection.description}</div>
                                    <div class="col-2 d-flex">
                                        <a href="#{collection.linkURI}" class="-bluelink" target="_blank">#{collection.collectionUrl}</a>
                                    </div>
                                    <div class="col-2 d-flex">
                                        <img src="#{collection.iconURI}" class="img-fluid" alt="" />
                                    </div>
                                    <div class="col-2 d-flex justify-content-center">
                                        <h:commandLink styleClass="-bluelink" action="#{cmsCollectionsBean.editCollection(collection)}" aria-label="#{msg.cms_collection_edit}: #{collection.solrFieldValue}">
                                            <f:passThroughAttribute name="style" value="padding-right:1.4rem;" />
                                            #{msg.edit}
                                        </h:commandLink>
                                        <h:commandLink styleClass="-redlink" action="#{cmsCollectionsBean.deleteCollection(collection)}"
                                            aria-label="#{msg.cms_collection_delete}: #{collection.solrFieldValue}"
                                            onclick="if ( !confirm( &quot;#{msg.cms_deleteCollection_confirmation}&quot; ) ) { return false };">
                                            #{msg.delete}
                                        </h:commandLink>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>
                    </h:form>
                </div>
            </div>
        </ui:fragment>
    </ui:define>
</ui:composition>

