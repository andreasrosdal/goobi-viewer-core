<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components"
	xmlns:adminWidget="http://xmlns.jcp.org/jsf/composite/admin/widgets"
	xmlns:viewerForms="http://xmlns.jcp.org/jsf/composite/components/forms"
	template="/resources/themes/#{navigationHelper.theme}/templateAdmin.html">

	<f:event listener="cmswidgetEditBean.startConversation()"
		type="preRenderView"></f:event>

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{navigationHelper.setCurrentPageAdmin('adminCmswidgets')}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
		<div id="cmsWidgetsAdd" class="cms-widgets-add">
			<h:panelGroup rendered="#{userBean.user.cmsAdmin}">

				<div class="admin__title-bar">
					<!-- TITLE -->
					<c:if test="#{customWidgetEditBean.widgetType == null}">
						<h2 class="admin__title">#{msg.cms__add_widget__title}</h2>
					</c:if>
					<c:if test="#{customWidgetEditBean.widgetType != null}">
						<h2 class="admin__title">#{msg.cms__edit_widget__title}</h2>
					</c:if>
				</div>

				<h:form prependId="false">

					<div class="admin__content-inner-content">

						<div class="admin__content-wrapper">

							<div class="admin__content-main -sticky -refreshHCsticky">

								<ui:fragment
									rendered="#{customWidgetEditBean.widgetType == null}">
									<div class="admin__info-text">#{msg.cms__add_widget__select_type}:</div>

									<div class="admin__entry-list -w33">
										<ui:repeat var="type"
											value="#{customWidgetEditBean.widgetTypes}">
											<div class="admin__boxed-entry -w33">
												<div class="d-flex flex-column h-100">
													<div>
														<h3>#{msg[type.label]}</h3>
													</div>
													<div class="mb-2">
														<p>#{msg[type.description]}</p>
													</div>
													<div class="mt-auto">
														<div class="d-flex">
															<button
																jsf:action="#{customWidgetEditBean.createWidget(type)}"
																class="btn btn--default ml-auto">#{msg.action__select}</button>
														</div>
													</div>
												</div>
											</div>
										</ui:repeat>
									</div>
								</ui:fragment>

								<ui:fragment
									rendered="#{customWidgetEditBean.widgetType != null}">
									<c:set var="widget" value="#{customWidgetEditBean.widget}"
										scope="view" />
									<!-- HTML -->
									<ui:fragment rendered="#{widget.type == 'WIDGET_HTML'}">

										<viewerForms:inputFormBlock title="#{msg.general}"
											languageSelector="#{widget}">

											<!-- TITLE -->
											<viewerForms:textInputField value="#{widget.title.text}"
												label="#{msg.label__cms_page_title}" required="#{widget.isDefaultLocaleSelected()}"
												helpText="#{msg.help__cms_page_title}" />
											<!-- HTML -->
											<viewerForms:htmlInputField value="#{widget.htmlText.text}"
												label="#{msg.cms_sidebarElement_html}" required="#{widget.isDefaultLocaleSelected()}"
												helpText="#{msg.admin_widgets__html__help}" />

										</viewerForms:inputFormBlock>
									</ui:fragment>

									<!-- CMS PAGES -->
									<ui:fragment rendered="#{widget.type == 'WIDGET_CMSPAGES'}">

										<viewerForms:inputFormBlock title="#{msg.general}"
											languageSelector="#{widget}">
											<!-- TITLE -->
											<viewerForms:textInputField value="#{widget.title.text}"
												label="#{msg.label__cms_page_title}" required="#{widget.isDefaultLocaleSelected()}"
												helpText="#{msg.help__cms_page_title}" />
										</viewerForms:inputFormBlock>

										<viewerForms:inputFormBlock title="#{msg.settings}">

											<viewerForms:manySelectField label="#{msg.admin__cms_pages}"
												value="#{widget.pageIds}"
												selectValues="#{cmsBean.validCMSPages}" var="page"
												itemLabel="#{page.title}" itemValue="#{page.id}"
												helpText="#{msg.cms__edit_widget__collections__help}" />

										</viewerForms:inputFormBlock>

									</ui:fragment>

									<ui:fragment rendered="#{widget.type == 'WIDGET_FIELDFACETS'}">

										<viewerForms:inputFormBlock title="#{msg.settings}">

											<viewerForms:singleSelectField
												label="#{msg.label__solrfield}" required="true"
												value="#{widget.facetField}"
												selectValues="#{cmsBean.getLuceneFields(true)}" var="field"
												itemValue="#{field}" itemLabel="#{msg[field]}"
												helpText="#{msg.cms_widget__solrfield__help}" />

											<viewerForms:textInputField
												label="#{msg.admin_widgets__filter_query__label}"
												required="false" value="#{widget.filterQuery}"
												helpText="#{msg.cms_widget__filter_query__help}" />

											<viewerForms:singleSelectField label="#{msg.cms_itemCount}"
												required="false" value="#{widget.numEntries}"
												selectValues="#{[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]}"
												helpText="#{msg.cms_widget__solrfield__help}" />

										</viewerForms:inputFormBlock>

									</ui:fragment>

									<ui:fragment rendered="#{widget.type == 'WIDGET_RSSFEED'}">

										<viewerForms:inputFormBlock title="#{msg.general}"
											languageSelector="#{widget}">
											<!-- TITLE -->
											<viewerForms:textInputField value="#{widget.title.text}"
												label="#{msg.label__cms_page_title}" required="#{widget.isDefaultLocaleSelected()}"
												helpText="#{msg.help__cms_page_title}" />
										</viewerForms:inputFormBlock>

										<viewerForms:inputFormBlock title="#{msg.settings}">

											<viewerForms:singleSelectField label="#{msg.sortBy}"
												required="true" value="#{widget.sortField}"
												selectValues="#{cmsBean.getPossibleSortFields()}"
												var="field" itemValue="#{field}" itemLabel="#{msg[field]}"
												helpText="#{msg.cms_widget__solr_sortfield__help}" />

											<viewerForms:textInputField
												label="#{msg.admin_widgets__filter_query__label}"
												required="false" value="#{widget.filterQuery}"
												helpText="#{msg.cms_widget__filter_query__help}" />

											<viewerForms:singleSelectField label="#{msg.cms_itemCount}"
												required="false" value="#{widget.numEntries}"
												selectValues="#{[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]}"
												helpText="#{msg.cms_widget__solrfield__help}" />

											<viewerForms:booleanSelectField
												label="#{msg.cms_sidebarElement_sortDescending}"
												value="#{widget.descendingSorting}"
												helpText="#{msg.cms_widget__sort_descending__help}" />

										</viewerForms:inputFormBlock>

									</ui:fragment>

									<viewerForms:inputFormBlock title="#{msg.settings}">

										<viewerForms:textInputField
											label="#{msg.cms__edit_widget__style__label}"
											required="false" value="#{widget.styleClass}"
											helpText="#{msg.cms__edit_widget__style__help}" />

										<viewerForms:booleanSelectField
											label="#{msg.cms__edit_widget__collapsed__label}"
											value="#{widget.collapsed}"
											helpText="#{msg.cms__edit_widget__collapsed__help}" />

									</viewerForms:inputFormBlock>

								</ui:fragment>

								<div
									class="row no-gutters justify-content-end admin__final-actions">
									<a class="btn btn--cancel"
										href="#{customWidgetEditBean.returnUrl}">#{msg.button__abort}
									</a>
									<button class="btn btn--success"
										jsf:action="#{customWidgetEditBean.save()}">#{msg.button__save}</button>
								</div>
								
							</div>
							
							<div class="admin__content-side">
								<ui:fragment rendered="#{widget != null}">
									<div class="admin__default-block">
										<h:panelGroup binding="#{customWidgetEditBean.previewGroup}" />
									</div>
								</ui:fragment>
							</div>
							
						</div>

					</div>

				</h:form>
			</h:panelGroup>
		</div>

	</ui:define>

</ui:composition>


