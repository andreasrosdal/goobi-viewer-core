<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:composite="http://xmlns.jcp.org/jsf/composite">
    
	<composite:interface />

    <composite:implementation>
        <h:panelGroup
            rendered="#{userBean.loggedIn and activeDocumentBean.recordLoaded and (userBean.user.superuser or (configurationBean.transkribusEnabled and activeDocumentBean.viewManager.topDocument.sourceDocFormat == 'METS') or userBean.user.hasPrivilegesForTemplate('templateOverviewPage'))}">
            <div id="widgetUserInteractions" class="widget widget-user-interactions">
                <h:form id="widgetUserInteractionsStandardForm" prependId="false">
                    <h3>#{msg.menuUser_workInteractions}</h3>

                    <ul>
                        <h:panelGroup rendered="#{userBean.user.maySetRepresentativeImage and activeDocumentBean.viewManager.hasPages}">
                            <li>
                                <h:commandLink
                                    action="#{adminBean.setRepresantativeImageAction(activeDocumentBean.viewManager.pi, activeDocumentBean.topDocument.dataRepository, activeDocumentBean.viewManager.currentPage.fileIdRoot)}">
                                        #{msg.setRepresentativeImage}
                                    </h:commandLink>
                            </li>
                        </h:panelGroup>

                        <!-- TODO rendered=#{docstruct in allowed doctypes} -->
                        <!-- TODO record already added to Transkribus -->
                        <h:panelGroup rendered="#{configurationBean.transkribusEnabled and activeDocumentBean.viewManager.topDocument.sourceDocFormat == 'METS'}">
                            <li>
                                <a href="#" data-toggle="modal" data-target="#transkribusModal"> #{msg.transkribus_add} </a>

                                <!-- TRANSKRIBUS MODAL -->
                                <div class="modal fade" id="transkribusModal" tabindex="-1" role="dialog" aria-labelledby="transkribusModalLabel">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="transkribusModalLabel">#{msg.transkribus_add}</h4>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">
                                                        <h:outputText value="&amp;times;" escape="false" />
                                                    </span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="form-group">
                                                    <p>#{msg.transkribus_addDisclaimer}</p>
                                                </div>
                                                <h:panelGroup rendered="#{userBean.user.transkribusSession == null}">
                                                    <div class="form-group">
                                                        <label for="transkribusEmail">#{msg.email}</label>
                                                        <h:inputText class="form-control" id="transkribusEmail" value="#{userBean.transkribusUserName}" />
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="transkribusPassword">#{msg.password}</label>
                                                        <h:inputSecret class="form-control" id="transkribusPassword" value="#{userBean.transkribusPassword}" />
                                                    </div>
                                                </h:panelGroup>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn" data-dismiss="modal">#{msg.cancel}</button>
                                                <h:commandButton rendered="#{userBean.user.transkribusSession == null}" type="submit" styleClass="btn btn--success"
                                                    value="#{msg.transkribus_add}" action="#{activeDocumentBean.viewManager.addToTranskribusAction(true)}" />
                                                <h:commandButton rendered="#{userBean.user.transkribusSession != null}" type="submit" styleClass="btn btn--success"
                                                    value="#{msg.transkribus_add}" action="#{activeDocumentBean.viewManager.addToTranskribusAction(false)}" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </h:panelGroup>

                        <!-- RE-INDEX RECORD -->
                        <h:panelGroup rendered="#{userBean.admin}">
                            <li>
                                <h:commandLink action="#{activeDocumentBean.reIndexRecordAction}">
                                    #{msg.reIndexRecord}
                                </h:commandLink>
                            </li>
                        </h:panelGroup>
                        
                        <!-- CREATE CMS PAGE -->
                         <h:panelGroup rendered="#{userBean.user.hasPrivilegesForTemplate('templateOverviewPage')}">
                            <li>
                                <h:commandLink
                                    action="#{cmsBean.createAndOpenNewPage('templateOverviewPage', msg.overviewPage, activeDocumentBean.viewManager.pi)}">
                                        #{msg.action__create_linked_cms_page__label}
                                    </h:commandLink>
                            </li>
                        </h:panelGroup>
                        
                    </ul>

                    <!-- DELETE RECORD -->
                    <ui:fragment rendered="#{userBean.admin and !activeDocumentBean.viewManager.hasVolumes}">
                        <div class="widget-user-interactions__delete-record">
                            <!-- HAS NO URNS -->
                            <ui:fragment rendered="#{!activeDocumentBean.viewManager.hasUrns}">
                                <div class="widget-user-interactions__delete-record-action has-no-urn">
                                    <h:commandLink 
                                        styleClass="btn btn--link" 
                                        role="button"
                                        onclick="if ( !confirm( &quot;#{msg.deleteRecord_confirmationText}&quot; ) ) { return false };"
                                        action="#{activeDocumentBean.deleteRecordAction(false)}">
                                        #{msg.deleteRecord}
                                    </h:commandLink>
                                </div>
                            </ui:fragment>

                            <!-- HAS URNS -->
                            <ui:fragment rendered="#{activeDocumentBean.viewManager.hasUrns}">
                                <div class="custom-control custom-control--select">
                                    <h:selectOneMenu value="#{activeDocumentBean.deleteRecordKeepTrace}">
                                        <f:selectItem itemLabel="#{msg.select}" itemValue="#{null}" />
                                        <f:selectItem itemLabel="#{msg.deleteRecord_select_delete}" itemValue="#{true}" />
                                        <f:selectItem itemLabel="#{msg.deleteRecord_select_purge}" itemValue="#{false}" />
                                        <f:passThroughAttribute name="aria-label" value="#{msg.select}"/>
                                        <f:ajax render="@form" />
                                    </h:selectOneMenu>
                                </div>

                                <!-- ACTION -->
                                <ui:fragment rendered="#{activeDocumentBean.deleteRecordKeepTrace != null}">
                                    <div class="widget-user-interactions__delete-record-action has-urn">
                                        <h:commandLink styleClass="btn btn--danger" role="button"
                                            onclick="if ( !confirm( &quot;#{msg.deleteRecord_confirmationText}&quot; ) ) { return false };"
                                            action="#{activeDocumentBean.deleteRecordAction(activeDocumentBean.deleteRecordKeepTrace)}">
                                            #{msg.button__delete}
                                        </h:commandLink>
                                    </div>
                                </ui:fragment>
                            </ui:fragment>
                        </div>
                        
                    </ui:fragment>

                    <!-- CANNOT DELETE ANCHOR DUE TO VOLUMES PRESENT -->
                    <ui:fragment rendered="#{userBean.admin and activeDocumentBean.viewManager.hasVolumes}">
                        <div class="widget-user-interactions__delete-record-message">
                            <span>#{msg.deleteRecord_failure_volumes_present}</span>
                        </div>
                    </ui:fragment>
                    <!-- CANNOT DELETE ANCHOR DUE TO VOLUMES PRESENT -->
                    <ui:fragment rendered="#{userBean.admin and activeDocumentBean.viewManager.hasVolumes}">
                        <!-- TODO Marc -->
<!--                         <h:outputText value="#{msg.deleteRecord_failure_volumes_present}" /> --> 
                    </ui:fragment>
                </h:form>
            </div>
        </h:panelGroup>
    </composite:implementation>
</ui:composition>